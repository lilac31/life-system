import{r as c,a as bt,R as yt}from"./react-wGySg1uH.js";import{r as vt,s as We,b as Ne,a as de,c as ue,d as jt,D as Ye,U as Xe,f as _,e as Le,p as ae,P as wt,X as me,C as Qe,g as Nt,i as Re,h as ke,j as kt,F as St,R as qe,k as Ce,A as Tt,l as Ie,m as De,n as Ct,o as It,q as Ae,t as Dt,u as $t,v as Mt,w as Ke,x as Ot,y as Fe,z as be,B as Et,E as Pt,G as Wt,H as _e,T as He,I as Lt,J as Rt,S as At,K as Ft,L as _t,M as Ht,W as ze,N as Ge,O as $e,Q as Je}from"./utils-CfO8uWVk.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const g of i.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&r(g)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();var Ze={exports:{}},ye={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zt=c,Gt=Symbol.for("react.element"),Jt=Symbol.for("react.fragment"),Ut=Object.prototype.hasOwnProperty,Vt=zt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Bt={key:!0,ref:!0,__self:!0,__source:!0};function et(o,t,n){var r,a={},i=null,g=null;n!==void 0&&(i=""+n),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(g=t.ref);for(r in t)Ut.call(t,r)&&!Bt.hasOwnProperty(r)&&(a[r]=t[r]);if(o&&o.defaultProps)for(r in t=o.defaultProps,t)a[r]===void 0&&(a[r]=t[r]);return{$$typeof:Gt,type:o,key:i,ref:g,props:a,_owner:Vt.current}}ye.Fragment=Jt;ye.jsx=et;ye.jsxs=et;Ze.exports=ye;var e=Ze.exports,Me={},Ue=bt;Me.createRoot=Ue.createRoot,Me.hydrateRoot=Ue.hydrateRoot;const Yt=()=>e.jsxs("div",{className:"p-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"测试页面"}),e.jsx("p",{children:"如果您能看到这个页面，说明基本设置是正常的。"})]});function Xt(o,t,n){vt(2,arguments);var r=We(o,n),a=We(t,n);return r.getTime()===a.getTime()}var Qt={lessThanXSeconds:{one:"不到 1 秒",other:"不到 {{count}} 秒"},xSeconds:{one:"1 秒",other:"{{count}} 秒"},halfAMinute:"半分钟",lessThanXMinutes:{one:"不到 1 分钟",other:"不到 {{count}} 分钟"},xMinutes:{one:"1 分钟",other:"{{count}} 分钟"},xHours:{one:"1 小时",other:"{{count}} 小时"},aboutXHours:{one:"大约 1 小时",other:"大约 {{count}} 小时"},xDays:{one:"1 天",other:"{{count}} 天"},aboutXWeeks:{one:"大约 1 个星期",other:"大约 {{count}} 个星期"},xWeeks:{one:"1 个星期",other:"{{count}} 个星期"},aboutXMonths:{one:"大约 1 个月",other:"大约 {{count}} 个月"},xMonths:{one:"1 个月",other:"{{count}} 个月"},aboutXYears:{one:"大约 1 年",other:"大约 {{count}} 年"},xYears:{one:"1 年",other:"{{count}} 年"},overXYears:{one:"超过 1 年",other:"超过 {{count}} 年"},almostXYears:{one:"将近 1 年",other:"将近 {{count}} 年"}},qt=function(t,n,r){var a,i=Qt[t];return typeof i=="string"?a=i:n===1?a=i.one:a=i.other.replace("{{count}}",String(n)),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?a+"内":a+"前":a},Kt={full:"y'年'M'月'd'日' EEEE",long:"y'年'M'月'd'日'",medium:"yyyy-MM-dd",short:"yy-MM-dd"},Zt={full:"zzzz a h:mm:ss",long:"z a h:mm:ss",medium:"a h:mm:ss",short:"a h:mm"},es={full:"{{date}} {{time}}",long:"{{date}} {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},ts={date:Ne({formats:Kt,defaultWidth:"full"}),time:Ne({formats:Zt,defaultWidth:"full"}),dateTime:Ne({formats:es,defaultWidth:"full"})};function Ve(o,t,n){var r="eeee p";return Xt(o,t,n)?r:o.getTime()>t.getTime()?"'下个'"+r:"'上个'"+r}var ss={lastWeek:Ve,yesterday:"'昨天' p",today:"'今天' p",tomorrow:"'明天' p",nextWeek:Ve,other:"PP p"},rs=function(t,n,r,a){var i=ss[t];return typeof i=="function"?i(n,r,a):i},as={narrow:["前","公元"],abbreviated:["前","公元"],wide:["公元前","公元"]},ns={narrow:["1","2","3","4"],abbreviated:["第一季","第二季","第三季","第四季"],wide:["第一季度","第二季度","第三季度","第四季度"]},os={narrow:["一","二","三","四","五","六","七","八","九","十","十一","十二"],abbreviated:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],wide:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]},ls={narrow:["日","一","二","三","四","五","六"],short:["日","一","二","三","四","五","六"],abbreviated:["周日","周一","周二","周三","周四","周五","周六"],wide:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"]},is={narrow:{am:"上",pm:"下",midnight:"凌晨",noon:"午",morning:"早",afternoon:"下午",evening:"晚",night:"夜"},abbreviated:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"},wide:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"}},cs={narrow:{am:"上",pm:"下",midnight:"凌晨",noon:"午",morning:"早",afternoon:"下午",evening:"晚",night:"夜"},abbreviated:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"},wide:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"}},ds=function(t,n){var r=Number(t);switch(n==null?void 0:n.unit){case"date":return r.toString()+"日";case"hour":return r.toString()+"时";case"minute":return r.toString()+"分";case"second":return r.toString()+"秒";default:return"第 "+r.toString()}},us={ordinalNumber:ds,era:de({values:as,defaultWidth:"wide"}),quarter:de({values:ns,defaultWidth:"wide",argumentCallback:function(t){return t-1}}),month:de({values:os,defaultWidth:"wide"}),day:de({values:ls,defaultWidth:"wide"}),dayPeriod:de({values:is,defaultWidth:"wide",formattingValues:cs,defaultFormattingWidth:"wide"})},ms=/^(第\s*)?\d+(日|时|分|秒)?/i,xs=/\d+/i,gs={narrow:/^(前)/i,abbreviated:/^(前)/i,wide:/^(公元前|公元)/i},hs={any:[/^(前)/i,/^(公元)/i]},ps={narrow:/^[1234]/i,abbreviated:/^第[一二三四]刻/i,wide:/^第[一二三四]刻钟/i},fs={any:[/(1|一)/i,/(2|二)/i,/(3|三)/i,/(4|四)/i]},bs={narrow:/^(一|二|三|四|五|六|七|八|九|十[二一])/i,abbreviated:/^(一|二|三|四|五|六|七|八|九|十[二一]|\d|1[12])月/i,wide:/^(一|二|三|四|五|六|七|八|九|十[二一])月/i},ys={narrow:[/^一/i,/^二/i,/^三/i,/^四/i,/^五/i,/^六/i,/^七/i,/^八/i,/^九/i,/^十(?!(一|二))/i,/^十一/i,/^十二/i],any:[/^一|1/i,/^二|2/i,/^三|3/i,/^四|4/i,/^五|5/i,/^六|6/i,/^七|7/i,/^八|8/i,/^九|9/i,/^十(?!(一|二))|10/i,/^十一|11/i,/^十二|12/i]},vs={narrow:/^[一二三四五六日]/i,short:/^[一二三四五六日]/i,abbreviated:/^周[一二三四五六日]/i,wide:/^星期[一二三四五六日]/i},js={any:[/日/i,/一/i,/二/i,/三/i,/四/i,/五/i,/六/i]},ws={any:/^(上午?|下午?|午夜|[中正]午|早上?|下午|晚上?|凌晨|)/i},Ns={any:{am:/^上午?/i,pm:/^下午?/i,midnight:/^午夜/i,noon:/^[中正]午/i,morning:/^早上/i,afternoon:/^下午/i,evening:/^晚上?/i,night:/^凌晨/i}},ks={ordinalNumber:jt({matchPattern:ms,parsePattern:xs,valueCallback:function(t){return parseInt(t,10)}}),era:ue({matchPatterns:gs,defaultMatchWidth:"wide",parsePatterns:hs,defaultParseWidth:"any"}),quarter:ue({matchPatterns:ps,defaultMatchWidth:"wide",parsePatterns:fs,defaultParseWidth:"any",valueCallback:function(t){return t+1}}),month:ue({matchPatterns:bs,defaultMatchWidth:"wide",parsePatterns:ys,defaultParseWidth:"any"}),day:ue({matchPatterns:vs,defaultMatchWidth:"wide",parsePatterns:js,defaultParseWidth:"any"}),dayPeriod:ue({matchPatterns:ws,defaultMatchWidth:"any",parsePatterns:Ns,defaultParseWidth:"any"})},xe={code:"zh-CN",formatDistance:qt,formatLong:ts,formatRelative:rs,localize:us,match:ks,options:{weekStartsOn:1,firstWeekContainsDate:4}};const Ss=({value:o,color:t,completed:n=!1,onChange:r,onColorChange:a,className:i=""})=>{const[g,h]=c.useState(!1),p=c.useRef(null),y=c.useRef(null),v=[{name:"红色",value:"red",bg:"bg-red-500",text:"text-red-600",letter:"M"},{name:"橙色",value:"orange",bg:"bg-orange-500",text:"text-orange-600",letter:"T"},{name:"粉色",value:"pink",bg:"bg-pink-500",text:"text-pink-600",letter:"I"},{name:"绿色",value:"green",bg:"bg-green-500",text:"text-green-600",letter:"R"},{name:"紫色",value:"purple",bg:"bg-purple-500",text:"text-purple-600",letter:"C"},{name:"蓝色",value:"blue",bg:"bg-blue-500",text:"text-blue-600",letter:"E"},{name:"黄色",value:"yellow",bg:"bg-yellow-500",text:"text-yellow-600",letter:"X"},{name:"靛蓝色",value:"indigo",bg:"bg-indigo-500",text:"text-indigo-600",letter:"B"},{name:"腾讯蓝",value:"tencent",bg:"bg-[#0066FF]",text:"text-[#0066FF]",letter:"F"}],W=v.find(b=>b.value===t)||v[0],j=(()=>{const b=[];for(let $=0;$<24;$++)for(let G=0;G<60;G+=15){const N=`${$.toString().padStart(2,"0")}:${G.toString().padStart(2,"0")}`;b.push(N)}return b})();c.useEffect(()=>{const b=$=>{p.current&&!p.current.contains($.target)&&y.current&&!y.current.contains($.target)&&h(!1)};return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[]),c.useEffect(()=>{if(g&&p.current){const b=setTimeout(()=>{if(p.current){const $=p.current.querySelector('button[data-time="10:00"]');if($)$.scrollIntoView({behavior:"instant",block:"center"});else{const G=j.findIndex(N=>N==="10:00");G!==-1&&(p.current.scrollTop=G*28-80)}}},50);return()=>clearTimeout(b)}},[g,j]);const u=b=>{r(b),setTimeout(()=>h(!1),100)},T=()=>{r(""),a(""),h(!1)},m=b=>{a(b)};return e.jsxs("div",{className:`relative ${i}`,children:[e.jsx("button",{ref:y,onClick:()=>h(!g),className:`w-12 h-6 text-left text-xs px-1 py-0.5 hover:bg-gray-100 focus:outline-none transition-colors ${o?t?n?`${W.text} font-medium opacity-70 line-through`:`${W.text} font-medium`:n?"text-gray-600 font-bold opacity-70 line-through":"text-gray-900 font-bold":n?"text-gray-500":"text-gray-400"}`,title:o?`${o}`:"点击选择时间",children:o||""}),g&&e.jsxs("div",{ref:p,className:"fixed bg-white border border-gray-200 rounded-md shadow-lg z-[9999] flex",style:{top:y.current?Math.min(y.current.getBoundingClientRect().bottom+4,window.innerHeight-280):"auto",left:y.current?Math.max(4,Math.min(y.current.getBoundingClientRect().left,window.innerWidth-100)):"auto"},children:[e.jsxs("div",{className:"w-20 p-2 border-r border-gray-200",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1.5 text-center",children:"颜色"}),e.jsx("div",{className:"flex flex-col gap-1.5 items-center",children:v.map(b=>e.jsx("button",{onClick:()=>m(b.value),className:`w-6 h-4 rounded-sm ${b.bg} hover:scale-105 transition-transform flex items-center justify-center text-white text-xs font-bold ${t===b.value?"ring-1 ring-gray-400 ring-offset-0":""}`,title:`${b.name} (${b.letter})`,children:e.jsx("span",{className:"text-[10px] font-bold",children:b.letter})},b.value))})]}),e.jsxs("div",{className:"w-20 max-h-56 overflow-y-auto",children:[e.jsx("button",{onClick:T,className:"w-full text-left px-2 py-1 text-xs text-gray-400 hover:bg-gray-50 border-b border-gray-100",children:"清除"}),j.map(b=>e.jsx("button",{"data-time":b,onClick:()=>u(b),className:`w-full text-left px-2 py-1 text-xs hover:bg-blue-50 transition-colors ${o===b?"bg-blue-50 text-blue-600":"text-gray-700"}`,children:b},b))]})]})]})},Oe=({currentView:o,onViewChange:t})=>{const n=[{id:"week",name:"周视图"},{id:"year",name:"年视图"},{id:"management",name:"管理界面"}];return e.jsx("nav",{className:"flex items-center space-x-1 bg-gray-100 rounded-lg p-1",children:n.map(r=>e.jsx("button",{onClick:()=>t(r.id),className:`px-3 py-1 text-sm font-medium rounded-md transition-colors ${o===r.id?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:r.name},r.id))})},Ts=({isOpen:o,onClose:t,totalTime:n,onSave:r})=>{const[a,i]=c.useState(0),[g,h]=c.useState("");c.useEffect(()=>{if(o){const v=Math.floor(n);i(v),h(v.toString())}},[o,n]);const p=()=>{const v=parseInt(g,10);!isNaN(v)&&v>0&&(r(v),t())},y=v=>{v.key==="Enter"?p():v.key==="Escape"&&t()};return o?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-80",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"修改每周工作时间"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"每周工作时间（小时）"}),e.jsx("input",{type:"number",value:g,onChange:v=>h(v.target.value),onKeyDown:y,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"1",max:"168",placeholder:"输入每周工作时间",autoFocus:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"取消"}),e.jsx("button",{onClick:p,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"保存"})]})]})}):null},Ee=({onImport:o,className:t=""})=>{const n=c.useRef(null),r=()=>{const g=JSON.parse(localStorage.getItem("weeklyImportantTasks")||"{}"),h=JSON.parse(localStorage.getItem("quickTasks")||"{}"),p=JSON.parse(localStorage.getItem("taskTimeRecords")||"{}"),y=localStorage.getItem("totalWorkingHours")||"40",v={weeklyImportantTasks:g,quickTasks:h,taskTimeRecords:p,totalWorkingHours:parseInt(y,10),exportDate:new Date().toISOString(),version:"1.0"},W=JSON.stringify(v,null,2),O=new Blob([W],{type:"application/json"}),j=document.createElement("a");j.href=URL.createObjectURL(O),j.download=`life-system-data-${_(new Date,"yyyy-MM-dd-HHmm")}.json`,document.body.appendChild(j),j.click(),document.body.removeChild(j),URL.revokeObjectURL(j.href)},a=g=>{const h=g.target.files[0];if(!h)return;const p=new FileReader;p.onload=y=>{try{const v=JSON.parse(y.target.result);if(!v.version){alert("无效的数据文件格式");return}v.weeklyImportantTasks&&localStorage.setItem("weeklyImportantTasks",JSON.stringify(v.weeklyImportantTasks)),v.quickTasks&&localStorage.setItem("quickTasks",JSON.stringify(v.quickTasks)),v.taskTimeRecords&&localStorage.setItem("taskTimeRecords",JSON.stringify(v.taskTimeRecords)),v.totalWorkingHours&&localStorage.setItem("totalWorkingHours",v.totalWorkingHours.toString()),o&&o(v),alert("数据导入成功！页面将刷新以加载新数据。"),window.location.reload()}catch(v){console.error("导入数据失败:",v),alert("导入数据失败，请检查文件格式是否正确")}},p.readAsText(h),g.target.value=""},i=()=>{var g;(g=n.current)==null||g.click()};return e.jsxs("div",{className:`flex items-center space-x-2 ${t}`,children:[e.jsxs("button",{onClick:r,className:"btn-secondary text-xs px-2 py-0.5 flex items-center space-x-1",title:"导出数据",children:[e.jsx(Ye,{className:"w-3 h-3"}),e.jsx("span",{children:"导出"})]}),e.jsxs("button",{onClick:i,className:"btn-secondary text-xs px-2 py-0.5 flex items-center space-x-1",title:"导入数据",children:[e.jsx(Xe,{className:"w-3 h-3"}),e.jsx("span",{children:"导入"})]}),e.jsx("input",{ref:n,type:"file",accept:".json",onChange:a,className:"hidden"})]})},Cs=()=>{const[o,t]=c.useState([]),[n,r]=c.useState(!1),[a,i]=c.useState({title:"",date:"",color:"red"}),[g,h]=c.useState(null),[p,y]=c.useState([]),[v,W]=c.useState(!1),[O,j]=c.useState(null),[u,T]=c.useState({title:"",date:"",color:"red"});new Date().getFullYear();const m=new Date(2025,9,1),b=new Date,$=Array.from({length:13},(d,I)=>{const E=Le(m,I);return{date:E,name:_(E,"M月",{locale:xe}),fullName:_(E,"yyyy年M月",{locale:xe})}}),G=[{value:"red",name:"红色",class:"bg-red-500"},{value:"orange",name:"橙色",class:"bg-orange-500"},{value:"pink",name:"粉色",class:"bg-pink-500"},{value:"green",name:"绿色",class:"bg-green-500"},{value:"purple",name:"紫色",class:"bg-purple-500"},{value:"blue",name:"蓝色",class:"bg-blue-500"},{value:"yellow",name:"黄色",class:"bg-yellow-500"},{value:"indigo",name:"靛蓝色",class:"bg-indigo-500"}];c.useEffect(()=>{const d=localStorage.getItem("yearGoals");if(d)try{t(JSON.parse(d))}catch(I){console.error("Failed to parse yearGoals:",I)}},[]);const N=d=>{t(d),localStorage.setItem("yearGoals",JSON.stringify(d))},L=()=>{if(!a.title||!a.date)return;const d=ae(a.date);if(!Re(d))return;d<b&&(W(!0),setTimeout(()=>W(!1),3e3));const E={id:Date.now().toString(),title:a.title,date:a.date,color:a.color},B=[...o,E].sort((Y,X)=>new Date(Y.date)-new Date(X.date));N(B),i({title:"",date:"",color:"red"}),r(!1)},J=(d,I)=>{I.stopPropagation(),N(o.filter(E=>E.id!==d))},V=(d,I)=>{I.stopPropagation(),j(d.id),T({title:d.title,date:d.date,color:d.color})},A=()=>{if(!u.title||!u.date)return;const d=ae(u.date);if(!Re(d))return;const I=o.map(E=>E.id===O?{...E,title:u.title,date:u.date,color:u.color}:E).sort((E,B)=>new Date(E.date)-new Date(B.date));N(I),j(null),T({title:"",date:"",color:"red"})},K=()=>{j(null),T({title:"",date:"",color:"red"})},ee=d=>{const I=ae(d),E=ke(I,m),B=ke(Le(m,13),m);return E/B*100},Q=d=>{const I=ae(d);return ke(I,b)},oe=d=>{const I=ae(d);return kt(I,b)},le=()=>o.filter(I=>Q(I.date)>0).sort((I,E)=>Q(I.date)-Q(E.date))[0],H=d=>{const I=d.currentTarget.getBoundingClientRect(),E=d.clientX-I.left,B=E/I.width*100,Y=o.filter(X=>{const q=ee(X.date);return Math.abs(q-B)<=3});Y.length>0?(h({x:E,goals:Y}),y(Y)):(h(null),y([]))};return le(),e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg p-4 border border-purple-200 mb-4",children:[n&&e.jsxs("div",{className:"bg-white rounded border border-gray-200 p-3 mb-3",children:[v&&e.jsx("div",{className:"mb-2 p-2 bg-yellow-50 border border-yellow-200 rounded text-xs text-yellow-800",children:"⚠️ 注意：您选择的是过去的日期，目标已添加但显示为已过期状态"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsx("input",{type:"text",placeholder:"目标名称",value:a.title,onChange:d=>i({...a,title:d.target.value}),className:"col-span-2 text-xs px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-purple-500"}),e.jsx("input",{type:"date",value:a.date,onChange:d=>i({...a,date:d.target.value}),min:"1900-01-01",max:"2099-12-31",className:"text-xs px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-purple-500"}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("select",{value:a.color,onChange:d=>i({...a,color:d.target.value}),className:"flex-1 text-xs px-1 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-purple-500",children:G.map(d=>e.jsx("option",{value:d.value,children:d.name},d.value))}),e.jsx("button",{onClick:L,className:"text-xs bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600",children:"✓"}),e.jsx("button",{onClick:()=>r(!1),className:"text-xs bg-gray-500 text-white px-2 py-1 rounded hover:bg-gray-600",children:"✕"})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex justify-between items-center mb-2",children:$.map((d,I)=>e.jsx("div",{className:"text-xs text-gray-600 text-center",children:d.name},I))}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative h-6 bg-gray-100 rounded-full mb-2 cursor-pointer flex-1",onMouseMove:H,onMouseLeave:()=>{h(null),y([])},children:[e.jsx("div",{className:"absolute top-0 w-0.5 h-full bg-red-500 rounded-full z-10",style:{left:`${ee(_(b,"yyyy-MM-dd"))}%`},title:`今天 ${_(b,"M月d日")}`}),o.map(d=>{var q;const I=ee(d.date),E=((q=G.find(R=>R.value===d.color))==null?void 0:q.class)||"bg-blue-500",B=Q(d.date),Y=B<0,X=p.some(R=>R.id===d.id);return e.jsx("div",{className:"absolute top-0 h-full flex items-center z-20",style:{left:`${I}%`},children:e.jsx("div",{className:`w-3 h-3 ${E} border-2 border-white cursor-pointer transition-all duration-200 ${Y?"opacity-50":""} ${X?"scale-125 shadow-lg":"hover:scale-110"}`,title:`${d.title} - ${_(ae(d.date),"M月d日")} ${Y?"(已过期)":`(还有${B}天)`}`})},d.id)})]}),e.jsx("button",{onClick:()=>r(!n),className:"w-6 h-6 bg-purple-500 text-white rounded-full hover:bg-purple-600 transition-colors flex items-center justify-center flex-shrink-0 mb-2",title:"添加目标",children:e.jsx(wt,{className:"w-3 h-3"})})]}),g&&p.length>0&&e.jsxs("div",{className:"absolute z-30 bg-white border border-gray-300 rounded-lg shadow-lg p-3 min-w-64",style:{left:`${Math.min(Math.max(g.x-128,0),400)}px`,top:"-120px"},children:[e.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-full",children:e.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-300"})}),e.jsx("div",{className:"space-y-2",children:p.map((d,I)=>{var q;const E=((q=G.find(R=>R.value===d.color))==null?void 0:q.class)||"bg-blue-500",B=Q(d.date),Y=oe(d.date),X=B<0;return e.jsxs("div",{className:"flex items-center justify-between group",children:[e.jsxs("div",{className:"flex items-center space-x-2 flex-1",children:[e.jsx("div",{className:`w-2 h-2 ${E} flex-shrink-0`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:d.title}),e.jsxs("div",{className:"text-xs text-gray-500",children:[_(ae(d.date),"yyyy年M月d日"),!X&&e.jsxs("span",{className:"ml-2 text-purple-600 font-medium",children:["还有 ",B," 天 (",Y," 周)"]}),X&&e.jsxs("span",{className:"ml-2 text-red-500",children:["已过期 ",Math.abs(B)," 天"]})]})]})]}),e.jsx("button",{onClick:R=>J(d.id,R),className:"opacity-0 group-hover:opacity-100 text-gray-400 hover:text-red-500 ml-2 transition-opacity",children:e.jsx(me,{className:"w-3 h-3"})})]},d.id)})})]}),o.length>0&&e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:o.sort((d,I)=>new Date(d.date)-new Date(I.date)).map(d=>{var X,q;const I=((X=G.find(R=>R.value===d.color))==null?void 0:X.class)||"bg-red-500",E=Q(d.date),B=E<0;return O===d.id?e.jsxs("div",{className:"flex items-center space-x-2 bg-blue-50 border border-blue-200 rounded px-2 py-1",children:[e.jsx("div",{className:`w-3 h-3 ${((q=G.find(R=>R.value===u.color))==null?void 0:q.class)||"bg-red-500"} flex-shrink-0`}),e.jsx("input",{type:"text",value:u.title,onChange:R=>T({...u,title:R.target.value}),className:"text-xs px-1 py-0.5 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 w-20",placeholder:"目标名称"}),e.jsx("input",{type:"date",value:u.date,onChange:R=>T({...u,date:R.target.value}),min:"1900-01-01",max:"2099-12-31",className:"text-xs px-1 py-0.5 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"}),e.jsx("select",{value:u.color,onChange:R=>T({...u,color:R.target.value}),className:"text-xs px-1 py-0.5 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",children:G.map(R=>e.jsx("option",{value:R.value,children:R.name},R.value))}),e.jsx("button",{onClick:A,className:"text-green-600 hover:text-green-800 transition-colors",title:"保存",children:e.jsx(Qe,{className:"w-3 h-3"})}),e.jsx("button",{onClick:K,className:"text-gray-400 hover:text-red-500 transition-colors",title:"取消",children:e.jsx(me,{className:"w-3 h-3"})})]},d.id):e.jsxs("div",{className:`group flex items-center space-x-2 text-xs ${B?"opacity-50":""} hover:bg-gray-50 rounded px-2 py-1 transition-colors`,children:[e.jsx("div",{className:`w-3 h-3 ${I} flex-shrink-0`}),e.jsx("span",{className:"text-gray-700 font-medium",children:d.title}),e.jsx("span",{className:"text-gray-500",children:_(ae(d.date),"M/d")}),!B&&e.jsxs("span",{className:"text-purple-600 font-medium",children:["(",E,"天)"]}),e.jsx("button",{onClick:R=>V(d,R),className:"opacity-0 group-hover:opacity-100 text-gray-400 hover:text-blue-500 ml-1 transition-opacity",title:"编辑目标",children:e.jsx(Nt,{className:"w-3 h-3"})}),e.jsx("button",{onClick:R=>J(d.id,R),className:"opacity-0 group-hover:opacity-100 text-gray-400 hover:text-red-500 ml-1 transition-opacity",title:"删除目标",children:e.jsx(me,{className:"w-3 h-3"})})]},d.id)})})})]})]})},Is=({onRecover:o})=>{const[t,n]=c.useState("checking"),[r,a]=c.useState({}),[i,g]=c.useState(!1);c.useEffect(()=>{h()},[]);const h=()=>{n("checking");const j=localStorage.getItem("weeklyImportantTasks"),u=localStorage.getItem("quickTasks"),T=localStorage.getItem("taskTimeRecords"),m=localStorage.getItem("totalWorkingHours"),b=localStorage.getItem("yearGoals"),$={weeklyImportantTasks:j?JSON.parse(j):null,quickTasks:u?JSON.parse(u):null,taskTimeRecords:T?JSON.parse(T):null,totalWorkingHours:m?parseInt(m):null,yearGoals:b?JSON.parse(b):null};a($);const G=$.weeklyImportantTasks&&Object.keys($.weeklyImportantTasks).length>0,N=$.quickTasks&&Object.keys($.quickTasks).length>0,L=$.taskTimeRecords&&Object.keys($.taskTimeRecords).length>0,J=$.yearGoals&&$.yearGoals.length>0;n(G||N||L||J?"found":"empty")},p=()=>{let j=[];if(r.weeklyImportantTasks){const u=Object.keys(r.weeklyImportantTasks).length;u>0&&j.push(`${u}周的重要任务`)}if(r.quickTasks){const u=Object.keys(r.quickTasks).length;let T=0;Object.values(r.quickTasks).forEach(m=>{Object.values(m).forEach(b=>{T+=b.filter($=>$.text||$.time).length})}),T>0&&j.push(`${u}天共${T}个任务`)}if(r.taskTimeRecords){const u=Object.keys(r.taskTimeRecords).length;u>0&&j.push(`${u}个时间记录`)}return r.yearGoals&&r.yearGoals.length>0&&j.push(`${r.yearGoals.length}个年度目标`),j},y=()=>{try{o&&o(r),alert("数据恢复成功！"),window.location.reload()}catch(j){console.error("恢复数据失败:",j),alert("恢复数据失败，请重试。")}},v=()=>{confirm("确定要清空所有数据重新开始吗？此操作不可恢复！")&&(localStorage.clear(),window.location.reload())},W=()=>{const j={...r,exportDate:new Date().toISOString(),version:"1.0"},u=JSON.stringify(j,null,2),T=new Blob([u],{type:"application/json"}),m=document.createElement("a");m.href=URL.createObjectURL(T),m.download=`backup-data-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(m.href)},O=()=>{const j=document.createElement("input");j.type="file",j.accept=".json",j.onchange=u=>{const T=u.target.files[0];if(T){const m=new FileReader;m.onload=b=>{try{const $=JSON.parse(b.target.result);o&&o($),alert("数据导入成功！"),window.location.reload()}catch{alert("文件格式错误，请选择正确的备份文件")}},m.readAsText(T)}},j.click()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(St,{className:"w-5 h-5 text-blue-500"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"数据管理中心"})]}),t==="checking"&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx(qe,{className:"w-8 h-8 animate-spin mx-auto mb-2 text-blue-500"}),e.jsx("p",{children:"正在扫描本地数据..."})]}),t==="found"&&e.jsxs("div",{children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Ce,{className:"w-5 h-5 text-green-600"}),e.jsx("h4",{className:"font-medium text-green-800",children:"找到你的数据了！"})]}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("p",{className:"mb-2",children:"在本地存储中发现以下数据："}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:p().map((j,u)=>e.jsx("li",{children:j},u))})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:y,className:"w-full bg-blue-500 text-white px-4 py-3 rounded-lg hover:bg-blue-600 transition-colors flex items-center justify-center space-x-2 font-medium",children:[e.jsx(Ce,{className:"w-4 h-4"}),e.jsx("span",{children:"恢复我的数据"})]}),e.jsxs("button",{onClick:W,className:"w-full bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors flex items-center justify-center space-x-2",children:[e.jsx(Ye,{className:"w-4 h-4"}),e.jsx("span",{children:"先备份数据到文件"})]}),e.jsxs("button",{onClick:()=>g(!i),className:"w-full bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors",children:[i?"隐藏":"查看","数据详情"]}),i&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-xs space-y-2",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"重要任务:"})," ",r.weeklyImportantTasks?Object.keys(r.weeklyImportantTasks).length+"周":"无"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"日常任务:"})," ",r.quickTasks?Object.keys(r.quickTasks).length+"天":"无"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"时间记录:"})," ",r.taskTimeRecords?Object.keys(r.taskTimeRecords).length+"条":"无"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"年度目标:"})," ",r.yearGoals?r.yearGoals.length+"个":"无"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"工作时间设置:"})," ",r.totalWorkingHours||40,"小时/周"]})]}),e.jsx("div",{className:"border-t pt-3",children:e.jsx("button",{onClick:v,className:"w-full bg-red-100 text-red-600 px-4 py-2 rounded-lg hover:bg-red-200 transition-colors text-sm",children:"清空所有数据重新开始"})})]})]}),t==="empty"&&e.jsxs("div",{children:[e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Tt,{className:"w-5 h-5 text-yellow-600"}),e.jsx("h4",{className:"font-medium text-yellow-800",children:"没有找到数据"})]}),e.jsx("p",{className:"text-sm text-yellow-700",children:"本地存储中没有发现任何数据。如果你之前有数据，可能是因为："}),e.jsxs("ul",{className:"list-disc list-inside text-sm text-yellow-700 mt-2 space-y-1",children:[e.jsx("li",{children:"浏览器缓存被清理"}),e.jsx("li",{children:"使用了隐私模式"}),e.jsx("li",{children:"更换了浏览器或设备"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("h5",{className:"font-medium text-blue-800 mb-2",children:"如果你有备份文件："}),e.jsx("p",{className:"text-sm text-blue-700 mb-2",children:'点击下面的"导入数据"按钮，选择之前导出的JSON文件'}),e.jsxs("button",{onClick:O,className:"w-full bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors flex items-center justify-center space-x-2",children:[e.jsx(Xe,{className:"w-4 h-4"}),e.jsx("span",{children:"导入备份数据"})]})]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"w-full bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors",children:"开始使用（创建新数据）"})]})]})]})})};let Se="";const Te="https://api.jsonbin.io/v3",ne={SCHEDULE_DATA:"schedule_data",USER_ID:"user_id",SYNC_STATUS:"sync_status",LAST_SYNC:"last_sync"};class Ds{constructor(){this.userId=this.getUserId(),this.binId=null}getUserId(){let t=localStorage.getItem(ne.USER_ID);return t?console.log("使用现有用户ID:",t):(t="life_system_user_2025",localStorage.setItem(ne.USER_ID,t),console.log("创建新的用户ID:",t)),t}getLocalData(){const t=localStorage.getItem(ne.SCHEDULE_DATA);return t?JSON.parse(t):this.getDefaultData()}getDefaultData(){return{weeks:{},importantTasks:[],quickTasks:{},timeRecords:[],settings:{weekStart:1,timeTrackingEnabled:!0,theme:"light"}}}saveLocalData(t){localStorage.setItem(ne.SCHEDULE_DATA,JSON.stringify(t)),this.setSyncStatus("pending")}setSyncStatus(t){localStorage.setItem(ne.SYNC_STATUS,t),localStorage.setItem(ne.LAST_SYNC,new Date().toISOString())}getSyncStatus(){return{status:localStorage.getItem(ne.SYNC_STATUS)||"pending",lastSync:localStorage.getItem(ne.LAST_SYNC)}}getApiKey(){if(Se)return Se;const t=localStorage.getItem("jsonbin_api_key");if(t)return Se=t,t;throw new Error("No API key configured")}async uploadToCloud(t){try{const r={"Content-Type":"application/json","X-Master-Key":this.getApiKey(),"X-Bin-Meta":'{"name":"life-system-data"}'};let a;if(this.binId?a=await fetch(`${Te}/b/${this.binId}`,{method:"PUT",headers:r,body:JSON.stringify({data:t,userId:this.userId,lastUpdated:new Date().toISOString()})}):a=await fetch(`${Te}/b`,{method:"POST",headers:r,body:JSON.stringify({data:t,userId:this.userId,lastUpdated:new Date().toISOString()})}),!a.ok){const g=await a.text();throw new Error(`Failed to upload data to cloud: ${a.status} ${g}`)}const i=await a.json();return this.binId||(this.binId=i.id,localStorage.setItem("bin_id",i.id)),this.setSyncStatus("success"),i}catch(n){throw console.error("Cloud upload failed:",n),this.setSyncStatus("error"),n}}async downloadFromCloud(){try{const t=this.getApiKey(),n=localStorage.getItem("bin_id");if(!n)throw new Error("No cloud data found");const r=await fetch(`${Te}/b/${n}/latest`,{headers:{"X-Master-Key":t,"X-Access-Key":t}});if(!r.ok){const i=await r.text();throw new Error(`Failed to download data from cloud: ${r.status} ${i}`)}const a=await r.json();if(a.record&&a.record.userId===this.userId)return this.setSyncStatus("success"),a.record.data;throw new Error("Data does not belong to current user")}catch(t){throw console.error("Cloud download failed:",t),this.setSyncStatus("error"),t}}mergeData(t,n){const r={...t};if(Object.keys(n.weeks||{}).forEach(a=>{if(!t.weeks[a])r.weeks[a]=n.weeks[a];else{const i=t.weeks[a],g=n.weeks[a];Object.keys(g.days||{}).forEach(h=>{i.days[h]||(i.days[h]=g.days[h])})}}),n.importantTasks&&n.importantTasks.length>0){const a=t.importantTasks.map(g=>g.id),i=n.importantTasks.filter(g=>!a.includes(g.id));r.importantTasks=[...t.importantTasks,...i]}return Object.keys(n.quickTasks||{}).forEach(a=>{t.quickTasks[a]||(r.quickTasks[a]=n.quickTasks[a])}),r}async syncData(){try{console.log("开始同步数据...");const t=this.getLocalData();console.log("本地数据:",t);try{console.log("尝试从云端获取数据...");const n=await this.downloadFromCloud();console.log("云端数据:",n);const r=this.mergeData(t,n);return this.saveLocalData(r),console.log("上传合并后的数据..."),await this.uploadToCloud(r),{success:!0,data:r,source:"merged"}}catch(n){return console.warn("云端数据获取失败，只上传本地数据:",n),console.log("只上传本地数据:",t),await this.uploadToCloud(t),{success:!0,data:t,source:"local"}}}catch(t){return console.error("同步完全失败:",t),{success:!1,error:t.message}}}needsSync(){const{lastSync:t}=this.getSyncStatus();if(!t)return!0;const n=new Date(t).getTime(),r=new Date().getTime(),a=60*1e3;return r-n>a}}const z=new Ds,tt=()=>{const[o,t]=c.useState(navigator.onLine),[n,r]=c.useState("pending"),[a,i]=c.useState(null);return c.useEffect(()=>{const h=()=>t(!0),p=()=>t(!1);return window.addEventListener("online",h),window.addEventListener("offline",p),()=>{window.removeEventListener("online",h),window.removeEventListener("offline",p)}},[]),c.useEffect(()=>{if(!o)return;const h=setInterval(async()=>{if(z.needsSync()){r("syncing");try{await z.syncData(),r("success"),i(new Date)}catch{r("error")}}},6e4);return()=>clearInterval(h)},[o]),{isOnline:o,syncStatus:n,lastSync:a,manualSync:async()=>{if(!o){alert("请检查网络连接");return}r("syncing");try{const h=await z.syncData();return r("success"),i(new Date),h}catch(h){throw r("error"),h}},needsSync:z.needsSync()}},te={getAllData:()=>z.getLocalData(),saveData:o=>{z.saveLocalData(o),navigator.onLine&&z.uploadToCloud(o).catch(t=>{console.warn("Background sync failed, will retry later")})},getWeekData:o=>z.getLocalData().weeks[o]||{days:{},weekNumber:parseInt(o.split("-")[1]),year:parseInt(o.split("-")[0])},saveWeekData:(o,t)=>{const n=z.getLocalData();n.weeks[o]=t,z.saveLocalData(n),navigator.onLine&&z.uploadToCloud(n).catch(r=>{console.warn("Background sync failed, will retry later")})},addImportantTask:o=>{const t=z.getLocalData();t.importantTasks||(t.importantTasks=[]),t.importantTasks.push(o),z.saveLocalData(t),navigator.onLine&&z.uploadToCloud(t).catch(n=>{console.warn("Background sync failed, will retry later")})},updateImportantTask:(o,t)=>{const n=z.getLocalData(),r=n.importantTasks.findIndex(a=>a.id===o);r!==-1&&(n.importantTasks[r]={...n.importantTasks[r],...t},z.saveLocalData(n),navigator.onLine&&z.uploadToCloud(n).catch(a=>{console.warn("Background sync failed, will retry later")}))},deleteImportantTask:o=>{const t=z.getLocalData();t.importantTasks=t.importantTasks.filter(n=>n.id!==o),z.saveLocalData(t),navigator.onLine&&z.uploadToCloud(t).catch(n=>{console.warn("Background sync failed, will retry later")})}},st=()=>{const[o,t]=c.useState(null),[n,r]=c.useState(!0),{isOnline:a,syncStatus:i,manualSync:g,lastSync:h}=tt(),p=c.useCallback(()=>{try{const m=te.getAllData();t(m),r(!1)}catch(m){console.error("Failed to load schedule data:",m),r(!1)}},[]),y=c.useCallback((m,b=!1)=>{try{te.saveData(m),t(m),a&&!b&&setTimeout(()=>{g().catch($=>{console.warn("自动同步失败:",$)})},1e3)}catch($){console.error("Failed to save schedule data:",$)}},[a,g]),v=c.useCallback(m=>o?te.getWeekData(m):null,[o]),W=c.useCallback((m,b)=>{const $={...o};$.weeks[m]=b,y($)},[o,y]),O=c.useCallback(m=>{te.addImportantTask(m),p()},[p]),j=c.useCallback((m,b)=>{te.updateImportantTask(m,b),p()},[p]),u=c.useCallback(m=>{te.deleteImportantTask(m),p()},[p]),T=c.useCallback(m=>{try{te.saveData(m),t(m),a&&g().catch(b=>{console.warn("立即同步失败:",b)})}catch(b){console.error("Failed to save schedule data:",b)}},[a,g]);return c.useEffect(()=>{p()},[p]),c.useEffect(()=>{const m=()=>{a&&i!=="success"&&g().then(()=>{p()})};return window.addEventListener("online",m),()=>window.removeEventListener("online",m)},[a,i,g,p]),{data:o,loading:n,isOnline:a,syncStatus:i,manualSync:g,lastSync:h,loadData:p,saveData:y,saveDataWithImmediateSync:T,getWeekData:v,saveWeekData:W,addImportantTask:O,updateImportantTask:j,deleteImportantTask:u}},Be=({tasks:o,onAddTask:t,onUpdateTask:n,currentView:r,onViewChange:a})=>{const{isOnline:i,lastSync:g}=st(),[h,p]=c.useState(new Date),[y,v]=c.useState(!1),W=null,[O,j]=c.useState({}),[u,T]=c.useState({}),[m,b]=c.useState(null),[$,G]=c.useState(null),[N,L]=c.useState(null),[J,V]=c.useState({}),[A,K]=c.useState(null),[ee,Q]=c.useState(!1),[oe,le]=c.useState(!1),[H,d]=c.useState(40),[I,E]=c.useState(null),[B,Y]=c.useState(!1),X=()=>{const s=Ie(h,{weekStartsOn:1});return _(s,"yyyy-MM-dd")},q=()=>{const s=X();return!O[s]||O[s].length===0?[{id:"important-1",text:""},{id:"important-2",text:""},{id:"important-3",text:""}]:O[s]},R=s=>{d(s),localStorage.setItem("totalWorkingHours",s.toString())},Pe=s=>{s.weeklyImportantTasks&&j(s.weeklyImportantTasks),s.quickTasks&&T(s.quickTasks),s.totalWorkingHours&&d(s.totalWorkingHours)},rt=(s,l=!1)=>({red:l?"rgba(239, 68, 68, 0.1)":"rgba(239, 68, 68, 0.2)",orange:l?"rgba(249, 115, 22, 0.1)":"rgba(249, 115, 22, 0.2)",pink:l?"rgba(236, 72, 153, 0.1)":"rgba(236, 72, 153, 0.2)",green:l?"rgba(34, 197, 94, 0.1)":"rgba(34, 197, 94, 0.2)",purple:l?"rgba(168, 85, 247, 0.1)":"rgba(168, 85, 247, 0.2)",blue:l?"rgba(59, 130, 246, 0.1)":"rgba(59, 130, 246, 0.2)",yellow:l?"rgba(234, 179, 8, 0.1)":"rgba(234, 179, 8, 0.2)",indigo:l?"rgba(99, 102, 241, 0.1)":"rgba(99, 102, 241, 0.2)",tencent:l?"rgba(0, 102, 255, 0.1)":"rgba(0, 102, 255, 0.2)"})[s]||"transparent",ve=Ie(h,{weekStartsOn:1}),ge=Array.from({length:7},(s,l)=>De(ve,l)),je=[{id:"morning",name:"早上",time:"06:00-12:00",color:"bg-yellow-50 border-yellow-200"},{id:"noon",name:"中午",time:"12:00-14:00",color:"bg-orange-50 border-orange-200"},{id:"afternoon",name:"下午",time:"14:00-18:00",color:"bg-blue-50 border-blue-200"},{id:"evening",name:"晚上",time:"18:00-24:00",color:"bg-purple-50 border-purple-200"}];c.useEffect(()=>{const s=localStorage.getItem("weeklyImportantTasks");if(s)try{j(JSON.parse(s))}catch(w){console.error("Failed to parse weeklyImportantTasks:",w)}const l=localStorage.getItem("quickTasks");if(l)try{T(JSON.parse(l))}catch(w){console.error("Failed to parse quickTasks:",w)}const f=localStorage.getItem("taskTimeRecords");if(f)try{V(JSON.parse(f))}catch(w){console.error("Failed to parse taskTimeRecords:",w)}const k=localStorage.getItem("totalWorkingHours");k&&d(parseInt(k,10)),Q(!0)},[]),c.useEffect(()=>{if(!ee)return;const s={...u};ge.forEach(l=>{const f=_(l,"yyyy-MM-dd");s[f]||(s[f]={}),je.forEach(k=>{(!s[f][k.id]||s[f][k.id].length===0)&&(s[f][k.id]=[{id:`${f}-${k.id}-${Date.now()}-0`,text:"",time:"",color:"",completed:!1}])})}),JSON.stringify(s)!==JSON.stringify(u)&&T(s)},[h,ee,u]),c.useEffect(()=>{const s=l=>{l.key==="Escape"&&(K(null),L(null))};return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[]);const ie=c.useRef(!1),F=c.useRef(null);c.useRef(null);const at=(s,l)=>{const f=X(),w=q().map((C,D)=>D===s?{...C,text:l}:C);j(C=>({...C,[f]:w})),localStorage.setItem("weeklyImportantTasks",JSON.stringify({...O,[f]:w}))},we=(s,l,f,k,w)=>{const C={...u,[s]:{...u[s],[l]:u[s][l].map((P,M)=>M===f?{...P,[k]:w}:P)}},D=C[s][l],S=f===D.length-1,x=D[f],U=x.text||x.time;S&&U&&(C[s][l]=[...D,{id:`${s}-${l}-${Date.now()}`,text:"",time:"",color:"",completed:!1}]),T(C),localStorage.setItem("quickTasks",JSON.stringify(C)),localStorage.setItem("weeklyImportantTasks",JSON.stringify(O))},nt=(s,l,f)=>{const w=u[s][l].filter((D,S)=>S!==f);(w.length===0||w.every(D=>D.text||D.time))&&w.push({id:`${s}-${l}-${Date.now()}`,text:"",time:"",color:"",completed:!1});const C={...u,[s]:{...u[s],[l]:w}};T(C),localStorage.setItem("quickTasks",JSON.stringify(C)),localStorage.setItem("weeklyImportantTasks",JSON.stringify(O))},ot=(s,l,f,k)=>{const w=u[s][l][f],C=w.completed,D={...u,[s]:{...u[s],[l]:u[s][l].map((S,x)=>x===f?{...S,completed:!S.completed}:S)}};if(T(D),localStorage.setItem("quickTasks",JSON.stringify(D)),!C&&k){const S=k.target.getBoundingClientRect(),x=l==="evening"?-35:25;L({taskId:w.id,x:S.left-10,y:S.top+x,dayKey:s,slotId:l,taskIndex:f,taskColor:w.color||"green"})}},lt=(s,l,f,k)=>{const w=u[l][f][k];!w.text&&!w.time||(b({task:w,sourceDayKey:l,sourceSlotId:f,sourceTaskIndex:k}),s.dataTransfer.effectAllowed="move",s.dataTransfer.setData("text/plain",""),s.target.style.opacity="0.5")},it=s=>{s.target.style.opacity="1"},ct=(s,l,f)=>{s.preventDefault(),s.dataTransfer.dropEffect="move",G(`${l}-${f}`)},dt=()=>{G(null)},ut=(s,l,f)=>{var fe;if(s.preventDefault(),G(null),!m)return;const{task:k,sourceDayKey:w,sourceSlotId:C,sourceTaskIndex:D}=m;if(w===l&&C===f){b(null);return}const S={...k,id:`${l}-${f}-${Date.now()}`,completed:!1},x=u[w][C].filter((ce,ft)=>ft!==D);(x.length===0||x.every(ce=>ce.text||ce.time))&&x.push({id:`${w}-${C}-${Date.now()}-empty`,text:"",time:"",color:"",completed:!1});const U=((fe=u[l])==null?void 0:fe[f])||[],P=U.findLastIndex(ce=>ce.text||ce.time),M=P>=0?P+1:0,Z=[...U];Z.splice(M,0,S);const re={...u,[w]:{...u[w],[C]:x},[l]:{...u[l],[f]:Z}};T(re),localStorage.setItem("quickTasks",JSON.stringify(re)),b(null)},mt=(s,l)=>o.filter(f=>{if(!Ae(new Date(f.date),s))return!1;const k=f.time;if(!k)return!1;const w=parseInt(k.split(":")[0]);switch(l){case"morning":return w>=6&&w<12;case"noon":return w>=12&&w<14;case"afternoon":return w>=14&&w<18;case"evening":return w>=18||w<6;default:return!1}}),he=(s,l)=>{const f={...J,[s]:(J[s]||0)+l};V(f),L(null),localStorage.setItem("taskTimeRecords",JSON.stringify(f))},xt=s=>{const l={...J};delete l[s],V(l),L(null),localStorage.setItem("taskTimeRecords",JSON.stringify(l))},gt=(s,l,f)=>{const w={...u[s][l][f],id:`${s}-${l}-${Date.now()}-copy`,completed:!1},C={...u,[s]:{...u[s],[l]:[...u[s][l],w]}};T(C),localStorage.setItem("quickTasks",JSON.stringify(C)),K(null)},pe=s=>{const l={red:{bg:"bg-red-500",border:"border-red-500",hover:"hover:bg-red-50",text:"text-red-500"},orange:{bg:"bg-orange-500",border:"border-orange-500",hover:"hover:bg-orange-50",text:"text-orange-500"},pink:{bg:"bg-pink-500",border:"border-pink-500",hover:"hover:bg-pink-50",text:"text-pink-500"},green:{bg:"bg-green-500",border:"border-green-500",hover:"hover:bg-green-50",text:"text-green-500"},purple:{bg:"bg-purple-500",border:"border-purple-500",hover:"hover:bg-purple-50",text:"text-purple-500"},blue:{bg:"bg-blue-500",border:"border-blue-500",hover:"hover:bg-blue-50",text:"text-blue-500"},yellow:{bg:"bg-yellow-500",border:"border-yellow-500",hover:"hover:bg-yellow-50",text:"text-yellow-500"},indigo:{bg:"bg-indigo-500",border:"border-indigo-500",hover:"hover:bg-indigo-50",text:"text-indigo-500"},tencent:{bg:"bg-[#0066FF]",border:"border-[#0066FF]",hover:"hover:bg-[#f0f7ff]",text:"text-[#0066FF]"}};return!s||typeof s!="string"?l.green:l[s]||l.green},se=s=>J[s]||0,ht=s=>{if(s<60)return`${s}分钟`;const l=Math.floor(s/60),f=s%60;return f>0?`${l}小时${f}分钟`:`${l}小时`},pt=()=>{const s={},l={};ge.forEach(C=>{const D=_(C,"yyyy-MM-dd");je.forEach(S=>{var U;(((U=u[D])==null?void 0:U[S.id])||[]).forEach(P=>{if(P.color&&(P.text||P.time))if(P.completed){const M=se(P.id),Z=M>0?M/60:.5;l[P.color]=(l[P.color]||0)+Z}else s[P.color]=(s[P.color]||0)+1})})});const f=["red","orange","pink","green","purple","blue","yellow","indigo","tencent"],k={},w={};return f.forEach(C=>{s[C]&&(k[C]=s[C]),l[C]&&(w[C]=l[C])}),{plannedColorStats:k,actualColorStats:w,totalWorkingHours:H}};return e.jsxs("div",{className:"space-y-3",onClick:()=>{K(null),E(null)},children:[B&&e.jsx(Is,{onRecover:s=>{Pe(s),Y(!1)}}),e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"人生系统设计"}),e.jsxs("p",{className:"text-gray-500 text-sm",children:[_(ve,"yyyy年MM月dd日",{locale:xe})," - ",_(De(ve,6),"MM月dd日",{locale:xe})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[i?y?e.jsxs("div",{className:"flex items-center space-x-1 text-blue-500",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-xs text-blue-500",children:"同步中"})]}):e.jsxs("div",{className:"flex items-center space-x-1 text-green-500",children:[e.jsx(Ct,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs text-green-500",children:g?`已同步 ${_(g,"HH:mm")}`:"已同步"})]}):e.jsxs("div",{className:"flex items-center space-x-1 text-gray-500",children:[e.jsx(It,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs text-gray-500",children:"离线"})]}),W]}),e.jsx(Oe,{currentView:r,onViewChange:a}),e.jsx(Ee,{onImport:Pe}),e.jsx("button",{onClick:()=>Y(!0),className:"btn-secondary text-xs px-2 py-0.5 text-blue-600 hover:text-blue-700",title:"数据管理：备份、恢复、导入导出",children:"数据管理"}),e.jsx("button",{onClick:()=>p(new Date),className:"btn-secondary text-xs px-2 py-0.5",children:"本周"})]})]}),e.jsx(Cs,{}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg px-4 py-2 border border-blue-200",children:e.jsx("div",{className:"flex items-center gap-3",children:q().map((s,l)=>e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex bg-white rounded border border-blue-200 focus-within:ring-1 focus-within:ring-blue-500 focus-within:border-transparent transition-all overflow-hidden",children:[e.jsxs("div",{className:"bg-yellow-400 text-white px-2 py-1.5 text-xs font-bold flex items-center justify-center min-w-10",children:["TOP",l+1]}),e.jsx("input",{type:"text",value:s.text,onChange:f=>at(l,f.target.value),className:"flex-1 px-2 py-1.5 text-sm bg-transparent border-none focus:outline-none"})]})},s.id))})}),e.jsxs("div",{className:"flex bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden w-full",children:[e.jsxs("div",{className:"flex-1 min-w-0 w-full",children:[e.jsxs("div",{className:"grid border-b border-gray-200",style:{gridTemplateColumns:"100px repeat(7, 1fr)"},children:[e.jsxs("div",{className:"p-2 bg-gray-50 font-medium text-gray-900 text-lg border-r border-gray-200 flex items-center justify-center h-full",children:[_(h,"MM"),"月"]}),ge.map((s,l)=>{const f=Ae(s,new Date),k=l===5||l===6;return e.jsx("div",{className:`p-2 text-center font-medium border-l border-gray-200 ${f?"bg-blue-50 text-blue-900":k?"bg-gray-100 text-gray-700":"bg-gray-50 text-gray-900"}`,children:e.jsxs("div",{className:"flex items-center justify-center space-x-1 text-sm",children:[e.jsx("span",{className:`text-lg font-bold ${f?"text-blue-600":""}`,children:_(s,"dd")}),e.jsx("span",{className:"text-gray-400 text-xs",children:"·"}),e.jsx("span",{className:"text-gray-600 text-xs",children:["一","二","三","四","五","六","日"][l]})]})},s.toString())})]}),je.map(s=>e.jsxs("div",{className:"grid border-b border-gray-200 min-h-24",style:{gridTemplateColumns:"100px repeat(7, 1fr)"},children:[e.jsx("div",{className:`p-2 ${s.color} border-r border-gray-200 flex flex-col justify-center items-center`,children:e.jsx("div",{className:"font-medium text-gray-900 text-sm",children:s.name})}),ge.map((l,f)=>{var S;const k=_(l,"yyyy-MM-dd"),w=mt(l,s.id),C=((S=u[k])==null?void 0:S[s.id])||[],D=f===5||f===6;return e.jsxs("div",{className:`p-2 border-l border-gray-200 space-y-1 min-h-24 overflow-hidden relative ${D?"bg-gray-25":""} ${$===`${k}-${s.id}`?"bg-blue-100 border-blue-400 border-2 border-dashed":""} ${m?"transition-all duration-200":""} ${m&&$!==`${k}-${s.id}`?"hover:bg-blue-50 hover:border-blue-200 hover:border-dashed":""}`,style:D?{backgroundColor:"#fafafa"}:{},onDragOver:x=>ct(x,k,s.id),onDragLeave:dt,onDrop:x=>ut(x,k,s.id),children:[w.map(x=>e.jsxs("div",{className:"text-xs p-2 bg-blue-100 text-blue-800 rounded border border-blue-200 cursor-pointer hover:bg-blue-200 transition-colors",onClick:()=>n(x.id,x),children:[e.jsx("div",{className:"font-medium break-words overflow-hidden text-ellipsis",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:x.title}),x.time&&e.jsx("div",{className:"text-blue-600 mt-0.5",children:x.time})]},x.id)),C.map((x,U)=>{const P=x.text||x.time;return e.jsxs("div",{className:`flex items-center mb-1 group rounded p-1 ${P?"cursor-move hover:shadow-sm hover:bg-gray-50":""} ${I&&x.color===I?`ring-2 ring-opacity-50 ${pe(I).text.replace("text-","ring-")}`:x.completed?"opacity-60":""} ${m&&m.task.id===x.id?"opacity-50":""}`,draggable:P,onDragStart:M=>lt(M,k,s.id,U),onDragEnd:it,title:P?"拖拽任务到其他时间段":"",onContextMenu:M=>{P&&(M.preventDefault(),K({taskId:x.id,x:M.clientX,y:M.clientY,dayKey:k,slotId:s.id,taskIndex:U,taskData:x}))},style:{backgroundColor:x.time&&x.color?rt(x.color,I&&x.color===I?!1:x.completed):"transparent",position:"relative",transition:"all 0.2s ease"},children:[P&&e.jsx("div",{className:"relative mr-1 flex-shrink-0",children:e.jsx("input",{type:"checkbox",checked:x.completed||!1,onChange:M=>{M.stopPropagation(),K(null),ot(k,s.id,U,M)},onMouseEnter:M=>{if(x.completed){F.current&&(clearTimeout(F.current),F.current=null),ie.current=!0;const Z=M.currentTarget.getBoundingClientRect(),re=s.id==="evening"?-35:25;L({taskId:x.id,x:Z.left-10,y:Z.top+re,dayKey:k,slotId:s.id,taskIndex:U,taskColor:x.color||"green"})}},onMouseLeave:()=>{ie.current=!1,F.current=setTimeout(()=>{ie.current||L(null)},300)},className:`w-3 h-3 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 cursor-pointer z-10 ${x.completed?"opacity-80":""}`,title:x.completed?"悬停记录用时":"点击完成任务"})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Ss,{value:x.time,color:x.color,completed:x.completed,onChange:M=>we(k,s.id,U,"time",M),onColorChange:M=>we(k,s.id,U,"color",M)})}),!x.time&&e.jsx("div",{className:`w-px h-4 ml-1 mr-2 flex-shrink-0 ${x.completed?"bg-gray-300":"bg-gray-200"}`}),e.jsx("div",{className:"flex-1 flex items-start overflow-hidden",children:e.jsx("textarea",{value:x.text,onChange:M=>{we(k,s.id,U,"text",M.target.value)},className:`flex-1 text-xs p-1 border-none focus:outline-none bg-transparent resize-none overflow-hidden break-words ${I&&x.color===I?"text-gray-700":x.completed?"line-through text-gray-500":"text-gray-700"}`,onClick:M=>M.stopPropagation(),rows:1,style:{minHeight:"20px",maxHeight:"60px",width:"100%",boxSizing:"border-box"},onInput:M=>{M.target.style.height="auto",M.target.style.height=`${M.target.scrollHeight}px`}})}),I&&x.color===I&&se(x.id)>0&&e.jsx("div",{className:"absolute right-1 top-1/2 transform -translate-y-1/2 text-xs font-medium text-gray-700 bg-white bg-opacity-80 px-1 rounded",children:se(x.id)>=60?`${(se(x.id)/60).toFixed(se(x.id)%60===0?0:1)}h`:`${se(x.id)}m`})]},x.id)})]},`${k}-${s.id}`)})]},s.id))]}),e.jsxs("div",{className:"w-8 border-l border-gray-200 flex flex-col",children:[e.jsx("div",{className:"flex-1 bg-gray-50 hover:bg-blue-50 cursor-pointer flex items-center justify-center group transition-colors border-b border-gray-200",onClick:()=>p($t(h,1)),title:"上一周",children:e.jsx(Dt,{className:"w-4 h-4 text-gray-400 group-hover:text-blue-600"})}),e.jsx("div",{className:"flex-1 bg-gray-50 hover:bg-blue-50 cursor-pointer flex items-center justify-center group transition-colors",onClick:()=>p(Ke(h,1)),title:"下一周",children:e.jsx(Mt,{className:"w-4 h-4 text-gray-400 group-hover:text-blue-600"})})]})]}),N&&(()=>{const s=pe(N.taskColor),l=240,f=100,k=typeof window<"u"?window.innerWidth:1920,w=typeof window<"u"?window.innerHeight:1080,C=Math.max(10,Math.min(N.x,k-l-10)),D=Math.max(10,Math.min(N.y,w-f-10));return e.jsxs("div",{className:"time-tracking-popup fixed bg-white border border-gray-200 rounded shadow-lg p-2 z-[9999]",style:{left:`${C}px`,top:`${D}px`},onMouseEnter:()=>{F.current&&(clearTimeout(F.current),F.current=null),ie.current=!0},onMouseLeave:()=>{ie.current=!1,F.current=setTimeout(()=>{ie.current||L(null)},200)},children:[e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{onClick:S=>{S.preventDefault(),S.stopPropagation(),F.current&&(clearTimeout(F.current),F.current=null),he(N.taskId,30)},className:`flex items-center justify-center w-6 h-6 ${s.hover} rounded`,title:"30分钟",children:e.jsx("div",{className:`w-3 h-3 border ${s.border} rounded-full relative`,children:e.jsx("div",{className:`absolute inset-0 ${s.bg} rounded-full`,style:{clipPath:"polygon(50% 0%, 100% 0%, 100% 100%, 50% 100%)"}})})}),e.jsx("button",{onClick:S=>{S.preventDefault(),S.stopPropagation(),F.current&&(clearTimeout(F.current),F.current=null),he(N.taskId,60)},className:`flex items-center justify-center w-6 h-6 ${s.hover} rounded`,title:"1小时",children:e.jsx("div",{className:`w-3 h-3 ${s.bg} rounded-full`})}),e.jsx("button",{onClick:S=>{S.preventDefault(),S.stopPropagation(),F.current&&(clearTimeout(F.current),F.current=null),he(N.taskId,120)},className:`flex items-center justify-center w-6 h-6 ${s.hover} rounded`,title:"2小时",children:e.jsxs("div",{className:"flex space-x-0.5",children:[e.jsx("div",{className:`w-2 h-2 ${s.bg} rounded-full`}),e.jsx("div",{className:`w-2 h-2 ${s.bg} rounded-full`})]})}),e.jsx("button",{onClick:S=>{S.preventDefault(),S.stopPropagation(),F.current&&(clearTimeout(F.current),F.current=null),he(N.taskId,180)},className:`flex items-center justify-center w-6 h-6 ${s.hover} rounded`,title:"3小时",children:e.jsxs("div",{className:"flex space-x-0.5",children:[e.jsx("div",{className:`w-1.5 h-1.5 ${s.bg} rounded-full`}),e.jsx("div",{className:`w-1.5 h-1.5 ${s.bg} rounded-full`}),e.jsx("div",{className:`w-1.5 h-1.5 ${s.bg} rounded-full`})]})}),se(N.taskId)>0&&e.jsx("button",{onClick:S=>{S.preventDefault(),S.stopPropagation(),F.current&&(clearTimeout(F.current),F.current=null),xt(N.taskId)},className:"flex items-center justify-center w-6 h-6 hover:bg-red-50 rounded border border-red-200",title:"清空时间记录",children:e.jsx("svg",{className:"w-3 h-3 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),se(N.taskId)>0&&e.jsx("div",{className:"mt-1 pt-1 border-t border-gray-200 text-xs text-gray-500 text-center",children:ht(se(N.taskId))})]})})(),A&&(()=>{const f=typeof window<"u"?window.innerWidth:1920,k=typeof window<"u"?window.innerHeight:1080,w=f-120,C=k-60,D=Math.min(A.x,w),S=Math.min(A.y,C);return e.jsx("div",{className:"fixed bg-white border border-gray-200 rounded shadow-lg p-2 z-50",style:{left:`${D}px`,top:`${S}px`},onClick:x=>x.stopPropagation(),children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>gt(A.dayKey,A.slotId,A.taskIndex),className:"flex items-center space-x-1 px-2 py-1 text-xs bg-blue-50 text-blue-600 rounded hover:bg-blue-100 transition-colors",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),e.jsx("span",{children:"复制"})]}),e.jsxs("button",{onClick:()=>{nt(A.dayKey,A.slotId,A.taskIndex),K(null)},className:"flex items-center space-x-1 px-2 py-1 text-xs bg-red-50 text-red-600 rounded hover:bg-red-100 transition-colors",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),e.jsx("span",{children:"删除"})]})]})})})(),(()=>{const{plannedColorStats:s,actualColorStats:l}=pt(),f=new Set([...Object.keys(s),...Object.keys(l)]),k=Object.values(s).reduce((D,S)=>D+S,0),w=Object.values(l).reduce((D,S)=>D+S,0),C=k+w;return e.jsxs("div",{className:"mt-4 bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"本周时间分配"}),e.jsxs("div",{className:"text-xs text-gray-500 cursor-pointer hover:text-blue-600 hover:underline",onClick:()=>le(!0),title:"点击修改总工作时间",children:["计划: ",k.toFixed(1),"h | 完成: ",w.toFixed(1),"h | 总计: ",H,"h (",(C/H*100).toFixed(1),"%)"]})]}),e.jsxs("div",{className:"flex h-6 bg-gray-100 rounded overflow-hidden",children:[Array.from(f).map(D=>{const S=s[D]||0,x=l[D]||0,U=S+x,P=U/H*100,M=x/H*100,Z=S/H*100,re=pe(D||"gray"),fe={red:"Meeting",orange:"Think",pink:"Interview",green:"Run",purple:"Coach",blue:"English",yellow:"XinLi",indigo:"Book",tencent:"Free"};return e.jsxs("div",{className:"relative flex items-center justify-center text-white text-xs font-medium cursor-pointer hover:opacity-80 transition-opacity",style:{width:`${P}%`},title:`${fe[D]}: 计划${S.toFixed(1)}h + 完成${x.toFixed(1)}h = ${U.toFixed(1)}h (${P.toFixed(1)}%)`,onMouseEnter:()=>E(D),onMouseLeave:()=>E(null),children:[x>0&&e.jsx("div",{className:`absolute left-0 top-0 h-full ${re.bg}`,style:{width:`${M/P*100}%`}}),S>0&&e.jsx("div",{className:`absolute right-0 top-0 h-full ${re.bg} opacity-40`,style:{width:`${Z/P*100}%`}}),e.jsx("span",{className:"relative z-10",children:P>=5?`${U.toFixed(1)}h`:""})]},D)}),C<H&&e.jsx("div",{className:"bg-gray-200 flex items-center justify-center text-gray-500 text-xs",style:{width:`${(H-C)/H*100}%`},title:`剩余: ${(H-C).toFixed(1)}小时 (${((H-C)/H*100).toFixed(1)}%)`,children:(H-C)/H>=.05?`${(H-C).toFixed(1)}h`:""})]}),e.jsx("div",{className:"flex flex-wrap gap-3 mt-3 text-xs",children:Array.from(f).map(D=>{const S=s[D]||0,x=l[D]||0,P=(S+x)/H*100,M=pe(D),Z=D?M.text.replace("bg-","text-"):"text-gray-600",re={red:"Meeting",orange:"Think",pink:"Interview",green:"Run",purple:"Coach",blue:"English",yellow:"XinLi",indigo:"Book",tencent:"Free"};return e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-3 h-3 ${M.bg} rounded`}),S>0&&e.jsx("div",{className:`w-3 h-3 ${M.bg} opacity-40 rounded ml-0.5`})]}),e.jsxs("span",{className:"text-gray-600",children:[re[D],":",x>0&&e.jsxs("span",{className:"font-medium",children:[" 完成",x.toFixed(1),"h"]}),S>0&&e.jsxs("span",{className:"text-gray-500",children:[" 计划",S.toFixed(1),"h"]}),e.jsxs("span",{className:`font-bold ${Z}`,children:[" (",P.toFixed(1),"%)"]})]})]},D)})})]})})(),m&&e.jsxs("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-blue-500 text-white px-4 py-2 rounded-lg text-sm z-50 shadow-lg flex items-center space-x-2",children:[e.jsx("span",{children:"🚀"}),e.jsxs("span",{children:["正在移动任务: ",m.task.text||m.task.time||"未命名任务"]}),e.jsx("span",{className:"text-blue-200 text-xs",children:"拖拽到目标时间段"})]}),e.jsx(Ts,{isOpen:oe,onClose:()=>le(!1),totalTime:H,onSave:R})]})},$s=({currentView:o,onViewChange:t})=>{const{data:n,saveData:r}=st(),[a,i]=c.useState(new Date),g=new Date,[h,p]=c.useState([g.getMonth()]),[y,v]=c.useState({});c.useEffect(()=>{n&&n.importantTasks&&v(n.importantTasks)},[n]);const W=N=>{N.importantTasks&&(v(N.importantTasks),r({...n,importantTasks:N.importantTasks}))},O=N=>{const L=new Date(N,0,1),J=new Date(N,11,31),V=[];let A=Ie(L,{weekStartsOn:1});for(;A<=J;)V.push(new Date(A)),A=Ke(A,1);return V},j=N=>{const L=O(N),J=[];for(let V=0;V<12;V++){const A=new Date(N,V,1),K=Wt(A),ee=L.filter(Q=>De(Q,6)>=A&&Q<=K);J.push({month:V,monthName:_(A,"MMMM",{locale:xe}),weeks:ee})}return J},u=N=>{const L=_(N,"yyyy-MM-dd");return y[L]||[{id:"important-1",text:""},{id:"important-2",text:""},{id:"important-3",text:""}]},T=N=>{p(L=>L.includes(N)?L.filter(J=>J!==N):[...L,N])},m=()=>{const N=j(a.getFullYear());p(N.map((L,J)=>J))},b=()=>{p([])},$=j(a.getFullYear()),G=new Date().getMonth();return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"人生系统设计"}),e.jsxs("p",{className:"text-gray-500 text-sm",children:[a.getFullYear(),"年全年视图"]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Oe,{currentView:o,onViewChange:t}),e.jsx(Ee,{onImport:W})]})]}),e.jsxs("div",{className:"p-4 bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>i(N=>new Date(N.getFullYear()-1,0,1)),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(Ot,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:[a.getFullYear(),"年"]}),e.jsx("button",{onClick:()=>i(N=>new Date(N.getFullYear()+1,0,1)),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(Fe,{className:"w-5 h-5 text-gray-600"})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:m,className:"px-3 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:"展开所有"}),e.jsx("button",{onClick:b,className:"px-3 py-1 text-sm bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition-colors",children:"收起所有"})]})]}),e.jsx("div",{className:"space-y-4",children:$.map((N,L)=>{const J=h.includes(L),V=L===G;return e.jsxs("div",{className:`border rounded-lg overflow-hidden ${V?"border-blue-300 bg-blue-50":"border-gray-200"}`,children:[e.jsxs("div",{className:`flex items-center justify-between p-3 cursor-pointer ${V?"bg-blue-100":"bg-gray-50"} hover:bg-opacity-80 transition-colors`,onClick:()=>T(L),children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(be,{className:`w-5 h-5 ${V?"text-blue-600":"text-gray-600"}`}),e.jsx("h2",{className:`text-lg font-semibold ${V?"text-blue-900":"text-gray-900"}`,children:N.monthName}),e.jsxs("span",{className:`text-sm px-2 py-1 rounded ${V?"bg-blue-200 text-blue-800":"bg-gray-200 text-gray-700"}`,children:[N.weeks.length,"周"]})]}),e.jsx("div",{className:`transform transition-transform ${J?"rotate-90":""}`,children:e.jsx(Fe,{className:"w-5 h-5 text-gray-600"})})]}),J&&e.jsx("div",{className:"p-4 bg-white",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 2xl:grid-cols-6 gap-4",children:N.weeks.map((A,K)=>{const ee=_(A,"yyyy-MM-dd"),Q=u(A),oe=Et(A),le=Pt(A,new Date,{weekStartsOn:1});return e.jsxs("div",{className:`border rounded-lg p-3 ${le?"border-blue-300 bg-blue-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["第",oe,"周"]}),e.jsx("span",{className:"text-xs text-gray-500",children:_(A,"MM/dd")})]}),e.jsx("div",{className:"space-y-1",children:Q.map((H,d)=>e.jsxs("div",{className:"flex items-start space-x-1",children:[e.jsxs("div",{className:`text-xs font-bold ${d===0?"text-yellow-600":d===1?"text-gray-500":"text-orange-600"}`,children:["TOP",d+1]}),e.jsx("div",{className:"flex-1 text-xs text-gray-700 truncate",children:H.text||e.jsx("span",{className:"text-gray-400 italic",children:"未填写"})})]},H.id))})]},ee)})})})]},L)})})]})]})},Ms=({currentView:o,onViewChange:t})=>{const[n,r]=c.useState("overview"),a=h=>{console.log("数据已导入:",h)},i=[{id:"overview",name:"总览",icon:_e},{id:"goals",name:"目标管理",icon:He},{id:"schedule",name:"日程设置",icon:be},{id:"profile",name:"个人资料",icon:Lt},{id:"notifications",name:"通知设置",icon:Rt},{id:"settings",name:"系统设置",icon:At}],g=()=>{var h;switch(n){case"overview":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-blue-50 p-6 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-600 text-sm font-medium",children:"本周完成任务"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:"12/18"})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(be,{className:"w-6 h-6 text-white"})})]})}),e.jsx("div",{className:"bg-green-50 p-6 rounded-lg border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-600 text-sm font-medium",children:"年度目标进度"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:"3/5"})]}),e.jsx("div",{className:"w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center",children:e.jsx(He,{className:"w-6 h-6 text-white"})})]})}),e.jsx("div",{className:"bg-purple-50 p-6 rounded-lg border border-purple-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-600 text-sm font-medium",children:"系统使用天数"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:"45天"})]}),e.jsx("div",{className:"w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center",children:e.jsx(_e,{className:"w-6 h-6 text-white"})})]})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"最近活动"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-700",children:'完成了"团队会议"任务'}),e.jsx("span",{className:"text-xs text-gray-500 ml-auto",children:"2小时前"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-700",children:"更新了年度健康目标"}),e.jsx("span",{className:"text-xs text-gray-500 ml-auto",children:"1天前"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-700",children:"创建了新的周计划"}),e.jsx("span",{className:"text-xs text-gray-500 ml-auto",children:"3天前"})]})]})]})]});case"goals":return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"目标类别管理"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"事业发展权重"}),e.jsx("input",{type:"range",min:"0",max:"100",defaultValue:"30",className:"w-full"}),e.jsx("span",{className:"text-sm text-gray-500",children:"30%"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"健康管理权重"}),e.jsx("input",{type:"range",min:"0",max:"100",defaultValue:"25",className:"w-full"}),e.jsx("span",{className:"text-sm text-gray-500",children:"25%"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"人际关系权重"}),e.jsx("input",{type:"range",min:"0",max:"100",defaultValue:"20",className:"w-full"}),e.jsx("span",{className:"text-sm text-gray-500",children:"20%"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"学习成长权重"}),e.jsx("input",{type:"range",min:"0",max:"100",defaultValue:"25",className:"w-full"}),e.jsx("span",{className:"text-sm text-gray-500",children:"25%"})]})]})]})});case"schedule":return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"时间段设置"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-yellow-50 rounded-lg border border-yellow-200",children:[e.jsx("span",{className:"font-medium",children:"早上时段"}),e.jsx("input",{type:"text",defaultValue:"06:00-12:00",className:"px-3 py-1 border border-gray-300 rounded text-sm"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-orange-50 rounded-lg border border-orange-200",children:[e.jsx("span",{className:"font-medium",children:"中午时段"}),e.jsx("input",{type:"text",defaultValue:"12:00-14:00",className:"px-3 py-1 border border-gray-300 rounded text-sm"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("span",{className:"font-medium",children:"下午时段"}),e.jsx("input",{type:"text",defaultValue:"14:00-18:00",className:"px-3 py-1 border border-gray-300 rounded text-sm"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsx("span",{className:"font-medium",children:"晚上时段"}),e.jsx("input",{type:"text",defaultValue:"18:00-24:00",className:"px-3 py-1 border border-gray-300 rounded text-sm"})]})]})]})});default:return e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:(h=i.find(p=>p.id===n))==null?void 0:h.name}),e.jsx("p",{className:"text-gray-600",children:"此功能正在开发中..."})]})}};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"人生系统设计"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"系统管理与配置中心"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Oe,{currentView:o,onViewChange:t}),e.jsx(Ee,{onImport:a})]})]}),e.jsx("div",{className:"flex space-x-1 bg-gray-100 rounded-lg p-1",children:i.map(h=>{const p=h.icon;return e.jsxs("button",{onClick:()=>r(h.id),className:`flex items-center space-x-2 px-3 py-2 text-sm font-medium rounded-md transition-colors ${n===h.id?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(p,{className:"w-4 h-4"}),e.jsx("span",{children:h.name})]},h.id)})}),e.jsx("div",{className:"min-h-96",children:g()})]})},Os=({onClose:o,onAddTask:t,selectedDate:n})=>{const[r,a]=c.useState({title:"",description:"",date:n?_(n,"yyyy-MM-dd"):_(new Date,"yyyy-MM-dd"),time:"",priority:"medium",category:"work"}),[i,g]=c.useState({}),h=y=>{y.preventDefault();const v={};if(r.title.trim()||(v.title="请输入任务标题"),r.date||(v.date="请选择日期"),Object.keys(v).length>0){g(v);return}const W={...r,date:new Date(r.date),title:r.title.trim(),description:r.description.trim()};t(W),o()},p=(y,v)=>{a(W=>({...W,[y]:v})),i[y]&&g(W=>({...W,[y]:""}))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"添加新任务"}),e.jsx("button",{onClick:o,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(me,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:h,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"任务标题 *"}),e.jsx("input",{type:"text",value:r.title,onChange:y=>p("title",y.target.value),className:`input ${i.title?"border-red-500 focus:ring-red-500":""}`,placeholder:"输入任务标题..."}),i.title&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"任务描述"}),e.jsx("textarea",{value:r.description,onChange:y=>p("description",y.target.value),rows:3,className:"input resize-none",placeholder:"输入任务描述..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(be,{className:"w-4 h-4 inline mr-1"}),"日期 *"]}),e.jsx("input",{type:"date",value:r.date,onChange:y=>p("date",y.target.value),className:`input ${i.date?"border-red-500 focus:ring-red-500":""}`}),i.date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.date})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Ft,{className:"w-4 h-4 inline mr-1"}),"时间"]}),e.jsx("input",{type:"time",value:r.time,onChange:y=>p("time",y.target.value),className:"input"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(_t,{className:"w-4 h-4 inline mr-1"}),"优先级"]}),e.jsxs("select",{value:r.priority,onChange:y=>p("priority",y.target.value),className:"input",children:[e.jsx("option",{value:"low",children:"低优先级"}),e.jsx("option",{value:"medium",children:"中优先级"}),e.jsx("option",{value:"high",children:"高优先级"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Ht,{className:"w-4 h-4 inline mr-1"}),"分类"]}),e.jsxs("select",{value:r.category,onChange:y=>p("category",y.target.value),className:"input",children:[e.jsx("option",{value:"work",children:"工作"}),e.jsx("option",{value:"personal",children:"个人"}),e.jsx("option",{value:"health",children:"健康"}),e.jsx("option",{value:"study",children:"学习"})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:o,className:"btn-secondary",children:"取消"}),e.jsx("button",{type:"submit",className:"btn-primary",children:"添加任务"})]})]})]})})},Es=({className:o=""})=>{const{isOnline:t,syncStatus:n,lastSync:r,manualSync:a}=tt(),[i,g]=c.useState(!1),h=()=>{switch(n){case"syncing":return e.jsx(qe,{className:"animate-spin",size:16});case"success":return e.jsx(Ce,{size:16});case"error":return e.jsx($e,{size:16});default:return t?e.jsx(ze,{size:16}):e.jsx(Ge,{size:16})}},p=()=>{if(!t)return"离线";switch(n){case"syncing":return"同步中...";case"success":return"已同步";case"error":return"同步失败";default:return"等待同步"}},y=()=>{if(!t)return"text-gray-500";switch(n){case"syncing":return"text-blue-500";case"success":return"text-green-500";case"error":return"text-red-500";default:return"text-gray-500"}},v=()=>{if(!r)return"从未同步";const j=new Date-new Date(r),u=Math.floor(j/6e4);if(u<1)return"刚刚";if(u<60)return`${u}分钟前`;const T=Math.floor(u/60);return T<24?`${T}小时前`:`${Math.floor(T/24)}天前`},W=async()=>{if(n!=="syncing")try{await a(),setTimeout(()=>g(!1),2e3)}catch(O){console.error("手动同步失败:",O)}};return e.jsxs("div",{className:`relative ${o}`,children:[e.jsxs("button",{className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${y()} bg-gray-100 dark:bg-gray-800`,onClick:()=>g(!i),children:[h(),e.jsx("span",{children:p()})]}),i&&e.jsx("div",{className:"absolute right-0 mt-2 w-64 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 p-4 z-10",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"网络状态:"}),e.jsxs("div",{className:`flex items-center gap-1 ${t?"text-green-500":"text-red-500"}`,children:[t?e.jsx(ze,{size:14}):e.jsx(Ge,{size:14}),e.jsx("span",{className:"text-sm",children:t?"在线":"离线"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"同步状态:"}),e.jsxs("div",{className:`flex items-center gap-1 ${y()}`,children:[h(),e.jsx("span",{className:"text-sm",children:p()})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"上次同步:"}),e.jsx("span",{className:"text-sm text-gray-500",children:v()})]}),t&&e.jsx("button",{onClick:W,disabled:n==="syncing",className:"w-full py-2 px-4 bg-blue-500 text-white rounded-lg font-medium text-sm hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:n==="syncing"?"同步中...":"立即同步"}),e.jsx("div",{className:"pt-2 border-t border-gray-200 dark:border-gray-700",children:e.jsx("p",{className:"text-xs text-gray-500",children:"数据会自动同步到云端，确保在不同设备上访问时保持一致。"})})]})})]})},Ps=({isOpen:o,onClose:t})=>{const[n,r]=c.useState(""),[a,i]=c.useState(!1),[g,h]=c.useState(!1),[p,y]=c.useState("");c.useEffect(()=>{const O=localStorage.getItem("jsonbin_api_key");O&&(r(O),h(!0))},[]);const v=async()=>{if(!n.trim()){y("请输入API密钥");return}i(!0),y("");try{const O=await fetch("https://api.jsonbin.io/v3/b",{method:"POST",headers:{"Content-Type":"application/json","X-Master-Key":n},body:JSON.stringify({test:!0})});if(!O.ok)throw new Error("API密钥无效");localStorage.setItem("jsonbin_api_key",n);const j=await O.json();localStorage.setItem("bin_id",j.id),h(!0);try{await z.syncData()}catch(u){console.warn("Initial sync failed:",u)}}catch(O){y(O.message||"验证API密钥时出错")}finally{i(!1)}},W=()=>{localStorage.setItem("cloud_sync_enabled","false"),t()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-md mx-4 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{size:24,className:"text-blue-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"数据同步设置"})]}),e.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:e.jsx(me,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-100 dark:bg-blue-900/30 rounded-full",children:e.jsx(Je,{size:32,className:"text-blue-600 dark:text-blue-400"})}),e.jsx("h3",{className:"text-lg font-medium",children:"启用云端同步"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"设置JSONBin.io API密钥，在不同设备间同步数据"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx($e,{size:18,className:"text-blue-600 dark:text-blue-400 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-blue-900 dark:text-blue-100",children:"如何获取API密钥:"}),e.jsxs("ol",{className:"mt-1 space-y-1 text-blue-800 dark:text-blue-200 list-decimal list-inside",children:[e.jsxs("li",{children:["访问 ",e.jsx("a",{href:"https://jsonbin.io",target:"_blank",rel:"noopener noreferrer",className:"underline",children:"jsonbin.io"})]}),e.jsx("li",{children:"注册免费账户"}),e.jsx("li",{children:"在控制台中复制API密钥"}),e.jsx("li",{children:"将密钥粘贴到下方输入框"})]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"api-key",className:"block text-sm font-medium",children:"JSONBin.io API密钥"}),e.jsx("input",{id:"api-key",type:"password",value:n,onChange:O=>r(O.target.value),placeholder:"输入你的API密钥",className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:outline-none ${p?"border-red-500 focus:ring-red-500":g?"border-green-500 focus:ring-green-500":"border-gray-300 focus:ring-blue-500 dark:border-gray-700 dark:focus:ring-blue-500"} bg-white dark:bg-gray-800`}),p&&e.jsxs("p",{className:"text-sm text-red-600 dark:text-red-400 flex items-center gap-1",children:[e.jsx($e,{size:14}),p]}),g&&e.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400 flex items-center gap-1",children:[e.jsx(Qe,{size:14}),"API密钥已验证"]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:W,className:"flex-1 py-2 px-4 border border-gray-300 dark:border-gray-700 rounded-lg font-medium hover:bg-gray-50 dark:hover:bg-gray-700",children:"跳过（离线模式）"}),e.jsx("button",{onClick:v,disabled:a,className:"flex-1 py-2 px-4 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:a?"验证中...":"保存密钥"})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center pt-2 border-t border-gray-200 dark:border-gray-700",children:"数据将安全地存储在云端，你可以随时在设置中更改"})]})]})})};function Ws(){const[o,t]=c.useState([]),[n,r]=c.useState(!1),[a,i]=c.useState(new Date),[g,h]=c.useState("week"),[p,y]=c.useState(!1);c.useEffect(()=>{const j=localStorage.getItem("jsonbin_api_key"),u=localStorage.getItem("cloud_sync_enabled")==="false";!j&&!u?(console.log("未设置API密钥，显示设置界面"),y(!0)):j&&(console.log("已设置API密钥，尝试自动同步"),setTimeout(()=>{try{z.syncData().then(m=>{console.log("启动时同步结果:",m)}).catch(m=>{console.warn("启动时同步失败:",m)})}catch(m){console.warn("同步服务不可用:",m)}},2e3));const T=te.getAllData();if(console.log("加载本地数据:",T),!T.weeks||Object.keys(T.weeks).length===0){console.log("创建默认数据");const m=te.getAllData();te.saveData(m)}},[]);const v=j=>{const u={...j,id:Date.now(),completed:!1};t(T=>[...T,u])},W=(j,u)=>{t(T=>T.map(m=>m.id===j?{...m,...u}:m))},O=()=>{switch(g){case"test":return e.jsx(Yt,{});case"week":return e.jsx(Be,{tasks:o,onAddTask:v,onUpdateTask:W,currentView:g,onViewChange:h});case"year":return e.jsx($s,{currentView:g,onViewChange:h});case"management":return e.jsx(Ms,{currentView:g,onViewChange:h});default:return e.jsx(Be,{tasks:o,onAddTask:v,onUpdateTask:W,currentView:g,onViewChange:h})}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200 px-4 py-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"生活管理系统"}),e.jsx(Es,{})]})}),e.jsx("main",{className:"p-3",children:e.jsx("div",{className:"w-full max-w-full mx-auto px-4",children:O()})}),n&&e.jsx(Os,{onClose:()=>r(!1),onAddTask:v,selectedDate:a})]}),p&&e.jsx(Ps,{isOpen:p,onClose:()=>y(!1)})]})}window.addEventListener("error",function(o){console.error("Global error:",o.error);const t=document.createElement("div");t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(255, 255, 255, 0.9)",t.style.zIndex="9999",t.style.display="flex",t.style.flexDirection="column",t.style.justifyContent="center",t.style.alignItems="center",t.style.padding="20px",t.style.fontSize="16px",t.style.color="#333",t.style.fontFamily="Arial, sans-serif",t.innerHTML=`
    <div style="max-width: 500px; text-align: center;">
      <h2 style="color: #e53e3e; margin-bottom: 16px;">应用遇到了问题</h2>
      <p>抱歉，应用启动时遇到了错误。请尝试刷新页面。</p>
      <button onclick="window.location.reload()" style="
        margin-top: 16px;
        padding: 8px 16px;
        background-color: #4299e1;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      ">刷新页面</button>
      <details style="margin-top: 16px; text-align: left;">
        <summary style="cursor: pointer; padding: 8px 0;">错误详情</summary>
        <pre style="background-color: #f7fafc; padding: 12px; border-radius: 4px; overflow: auto; font-size: 12px;">
          ${o.error?o.error.toString():"未知错误"}
        </pre>
      </details>
    </div>
  `,document.body.appendChild(t)});window.addEventListener("unhandledrejection",function(o){console.error("Unhandled promise rejection:",o.reason)});Me.createRoot(document.getElementById("root")).render(e.jsx(yt.StrictMode,{children:e.jsx(Ws,{})}));
