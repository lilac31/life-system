import{r as c,a as ft,R as bt}from"./react-wGySg1uH.js";import{r as yt,s as Ee,b as Ne,a as de,c as ue,d as vt,D as Ve,U as Be,f as F,e as We,p as ne,P as jt,X as me,C as Ye,g as wt,i as _e,h as Se,j as kt,F as Nt,R as Xe,k as Te,A as St,l as Ie,m as Ce,n as Tt,o as It,q as Le,t as Ct,u as Dt,v as $t,w as Qe,x as Mt,y as Pe,z as ye,B as Ot,E as Et,G as Wt,H as Re,T as Ge,I as _t,J as Lt,S as qe,K as Pt,L as Rt,M as Gt,W as Ae,N as He,O as At,Q as be,V as Fe,Y as Ht}from"./utils-CoJNDuFW.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const m of o.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&s(m)}).observe(document,{childList:!0,subtree:!0});function a(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=a(n);fetch(n.href,o)}})();var Ze={exports:{}},ve={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ft=c,Ut=Symbol.for("react.element"),zt=Symbol.for("react.fragment"),Jt=Object.prototype.hasOwnProperty,Vt=Ft.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Bt={key:!0,ref:!0,__self:!0,__source:!0};function Ke(l,t,a){var s,n={},o=null,m=null;a!==void 0&&(o=""+a),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(m=t.ref);for(s in t)Jt.call(t,s)&&!Bt.hasOwnProperty(s)&&(n[s]=t[s]);if(l&&l.defaultProps)for(s in t=l.defaultProps,t)n[s]===void 0&&(n[s]=t[s]);return{$$typeof:Ut,type:l,key:o,ref:m,props:n,_owner:Vt.current}}ve.Fragment=zt;ve.jsx=Ke;ve.jsxs=Ke;Ze.exports=ve;var e=Ze.exports,De={},Ue=ft;De.createRoot=Ue.createRoot,De.hydrateRoot=Ue.hydrateRoot;const Yt=()=>e.jsxs("div",{className:"p-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"测试页面"}),e.jsx("p",{children:"如果您能看到这个页面，说明基本设置是正常的。"})]});function Xt(l,t,a){yt(2,arguments);var s=Ee(l,a),n=Ee(t,a);return s.getTime()===n.getTime()}var Qt={lessThanXSeconds:{one:"不到 1 秒",other:"不到 {{count}} 秒"},xSeconds:{one:"1 秒",other:"{{count}} 秒"},halfAMinute:"半分钟",lessThanXMinutes:{one:"不到 1 分钟",other:"不到 {{count}} 分钟"},xMinutes:{one:"1 分钟",other:"{{count}} 分钟"},xHours:{one:"1 小时",other:"{{count}} 小时"},aboutXHours:{one:"大约 1 小时",other:"大约 {{count}} 小时"},xDays:{one:"1 天",other:"{{count}} 天"},aboutXWeeks:{one:"大约 1 个星期",other:"大约 {{count}} 个星期"},xWeeks:{one:"1 个星期",other:"{{count}} 个星期"},aboutXMonths:{one:"大约 1 个月",other:"大约 {{count}} 个月"},xMonths:{one:"1 个月",other:"{{count}} 个月"},aboutXYears:{one:"大约 1 年",other:"大约 {{count}} 年"},xYears:{one:"1 年",other:"{{count}} 年"},overXYears:{one:"超过 1 年",other:"超过 {{count}} 年"},almostXYears:{one:"将近 1 年",other:"将近 {{count}} 年"}},qt=function(t,a,s){var n,o=Qt[t];return typeof o=="string"?n=o:a===1?n=o.one:n=o.other.replace("{{count}}",String(a)),s!=null&&s.addSuffix?s.comparison&&s.comparison>0?n+"内":n+"前":n},Zt={full:"y'年'M'月'd'日' EEEE",long:"y'年'M'月'd'日'",medium:"yyyy-MM-dd",short:"yy-MM-dd"},Kt={full:"zzzz a h:mm:ss",long:"z a h:mm:ss",medium:"a h:mm:ss",short:"a h:mm"},es={full:"{{date}} {{time}}",long:"{{date}} {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},ts={date:Ne({formats:Zt,defaultWidth:"full"}),time:Ne({formats:Kt,defaultWidth:"full"}),dateTime:Ne({formats:es,defaultWidth:"full"})};function ze(l,t,a){var s="eeee p";return Xt(l,t,a)?s:l.getTime()>t.getTime()?"'下个'"+s:"'上个'"+s}var ss={lastWeek:ze,yesterday:"'昨天' p",today:"'今天' p",tomorrow:"'明天' p",nextWeek:ze,other:"PP p"},rs=function(t,a,s,n){var o=ss[t];return typeof o=="function"?o(a,s,n):o},as={narrow:["前","公元"],abbreviated:["前","公元"],wide:["公元前","公元"]},ns={narrow:["1","2","3","4"],abbreviated:["第一季","第二季","第三季","第四季"],wide:["第一季度","第二季度","第三季度","第四季度"]},os={narrow:["一","二","三","四","五","六","七","八","九","十","十一","十二"],abbreviated:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],wide:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]},ls={narrow:["日","一","二","三","四","五","六"],short:["日","一","二","三","四","五","六"],abbreviated:["周日","周一","周二","周三","周四","周五","周六"],wide:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"]},is={narrow:{am:"上",pm:"下",midnight:"凌晨",noon:"午",morning:"早",afternoon:"下午",evening:"晚",night:"夜"},abbreviated:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"},wide:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"}},cs={narrow:{am:"上",pm:"下",midnight:"凌晨",noon:"午",morning:"早",afternoon:"下午",evening:"晚",night:"夜"},abbreviated:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"},wide:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"}},ds=function(t,a){var s=Number(t);switch(a==null?void 0:a.unit){case"date":return s.toString()+"日";case"hour":return s.toString()+"时";case"minute":return s.toString()+"分";case"second":return s.toString()+"秒";default:return"第 "+s.toString()}},us={ordinalNumber:ds,era:de({values:as,defaultWidth:"wide"}),quarter:de({values:ns,defaultWidth:"wide",argumentCallback:function(t){return t-1}}),month:de({values:os,defaultWidth:"wide"}),day:de({values:ls,defaultWidth:"wide"}),dayPeriod:de({values:is,defaultWidth:"wide",formattingValues:cs,defaultFormattingWidth:"wide"})},ms=/^(第\s*)?\d+(日|时|分|秒)?/i,xs=/\d+/i,gs={narrow:/^(前)/i,abbreviated:/^(前)/i,wide:/^(公元前|公元)/i},hs={any:[/^(前)/i,/^(公元)/i]},ps={narrow:/^[1234]/i,abbreviated:/^第[一二三四]刻/i,wide:/^第[一二三四]刻钟/i},fs={any:[/(1|一)/i,/(2|二)/i,/(3|三)/i,/(4|四)/i]},bs={narrow:/^(一|二|三|四|五|六|七|八|九|十[二一])/i,abbreviated:/^(一|二|三|四|五|六|七|八|九|十[二一]|\d|1[12])月/i,wide:/^(一|二|三|四|五|六|七|八|九|十[二一])月/i},ys={narrow:[/^一/i,/^二/i,/^三/i,/^四/i,/^五/i,/^六/i,/^七/i,/^八/i,/^九/i,/^十(?!(一|二))/i,/^十一/i,/^十二/i],any:[/^一|1/i,/^二|2/i,/^三|3/i,/^四|4/i,/^五|5/i,/^六|6/i,/^七|7/i,/^八|8/i,/^九|9/i,/^十(?!(一|二))|10/i,/^十一|11/i,/^十二|12/i]},vs={narrow:/^[一二三四五六日]/i,short:/^[一二三四五六日]/i,abbreviated:/^周[一二三四五六日]/i,wide:/^星期[一二三四五六日]/i},js={any:[/日/i,/一/i,/二/i,/三/i,/四/i,/五/i,/六/i]},ws={any:/^(上午?|下午?|午夜|[中正]午|早上?|下午|晚上?|凌晨|)/i},ks={any:{am:/^上午?/i,pm:/^下午?/i,midnight:/^午夜/i,noon:/^[中正]午/i,morning:/^早上/i,afternoon:/^下午/i,evening:/^晚上?/i,night:/^凌晨/i}},Ns={ordinalNumber:vt({matchPattern:ms,parsePattern:xs,valueCallback:function(t){return parseInt(t,10)}}),era:ue({matchPatterns:gs,defaultMatchWidth:"wide",parsePatterns:hs,defaultParseWidth:"any"}),quarter:ue({matchPatterns:ps,defaultMatchWidth:"wide",parsePatterns:fs,defaultParseWidth:"any",valueCallback:function(t){return t+1}}),month:ue({matchPatterns:bs,defaultMatchWidth:"wide",parsePatterns:ys,defaultParseWidth:"any"}),day:ue({matchPatterns:vs,defaultMatchWidth:"wide",parsePatterns:js,defaultParseWidth:"any"}),dayPeriod:ue({matchPatterns:ws,defaultMatchWidth:"any",parsePatterns:ks,defaultParseWidth:"any"})},xe={code:"zh-CN",formatDistance:qt,formatLong:ts,formatRelative:rs,localize:us,match:Ns,options:{weekStartsOn:1,firstWeekContainsDate:4}};const Ss=({value:l,color:t,completed:a=!1,onChange:s,onColorChange:n,className:o=""})=>{const[m,h]=c.useState(!1),f=c.useRef(null),v=c.useRef(null),y=[{name:"红色",value:"red",bg:"bg-red-500",text:"text-red-600",letter:"M"},{name:"橙色",value:"orange",bg:"bg-orange-500",text:"text-orange-600",letter:"T"},{name:"粉色",value:"pink",bg:"bg-pink-500",text:"text-pink-600",letter:"I"},{name:"绿色",value:"green",bg:"bg-green-500",text:"text-green-600",letter:"R"},{name:"紫色",value:"purple",bg:"bg-purple-500",text:"text-purple-600",letter:"C"},{name:"蓝色",value:"blue",bg:"bg-blue-500",text:"text-blue-600",letter:"E"},{name:"黄色",value:"yellow",bg:"bg-yellow-500",text:"text-yellow-600",letter:"X"},{name:"靛蓝色",value:"indigo",bg:"bg-indigo-500",text:"text-indigo-600",letter:"B"},{name:"腾讯蓝",value:"tencent",bg:"bg-[#0066FF]",text:"text-[#0066FF]",letter:"F"}],E=y.find(d=>d.value===t)||y[0],w=(()=>{const d=[];for(let j=0;j<24;j++)for(let _=0;_<60;_+=15){const N=`${j.toString().padStart(2,"0")}:${_.toString().padStart(2,"0")}`;d.push(N)}return d})();c.useEffect(()=>{const d=j=>{f.current&&!f.current.contains(j.target)&&v.current&&!v.current.contains(j.target)&&h(!1)};return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[]),c.useEffect(()=>{if(m&&f.current){const d=setTimeout(()=>{if(f.current){const j=f.current.querySelector('button[data-time="10:00"]');if(j)j.scrollIntoView({behavior:"instant",block:"center"});else{const _=w.findIndex(N=>N==="10:00");_!==-1&&(f.current.scrollTop=_*28-80)}}},50);return()=>clearTimeout(d)}},[m,w]);const x=d=>{s(d),setTimeout(()=>h(!1),100)},C=()=>{s(""),n(""),h(!1)},g=d=>{n(d)};return e.jsxs("div",{className:`relative ${o}`,children:[e.jsx("button",{ref:v,onClick:()=>h(!m),className:`w-12 h-6 text-left text-xs px-1 py-0.5 hover:bg-gray-100 focus:outline-none transition-colors ${l?t?a?`${E.text} font-medium opacity-70 line-through`:`${E.text} font-medium`:a?"text-gray-600 font-bold opacity-70 line-through":"text-gray-900 font-bold":a?"text-gray-500":"text-gray-400"}`,title:l?`${l}`:"点击选择时间",children:l||""}),m&&e.jsxs("div",{ref:f,className:"fixed bg-white border border-gray-200 rounded-md shadow-lg z-[9999] flex",style:{top:v.current?Math.min(v.current.getBoundingClientRect().bottom+4,window.innerHeight-280):"auto",left:v.current?Math.max(4,Math.min(v.current.getBoundingClientRect().left,window.innerWidth-100)):"auto"},children:[e.jsxs("div",{className:"w-20 p-2 border-r border-gray-200",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1.5 text-center",children:"颜色"}),e.jsx("div",{className:"flex flex-col gap-1.5 items-center",children:y.map(d=>e.jsx("button",{onClick:()=>g(d.value),className:`w-6 h-4 rounded-sm ${d.bg} hover:scale-105 transition-transform flex items-center justify-center text-white text-xs font-bold ${t===d.value?"ring-1 ring-gray-400 ring-offset-0":""}`,title:`${d.name} (${d.letter})`,children:e.jsx("span",{className:"text-[10px] font-bold",children:d.letter})},d.value))})]}),e.jsxs("div",{className:"w-20 max-h-56 overflow-y-auto",children:[e.jsx("button",{onClick:C,className:"w-full text-left px-2 py-1 text-xs text-gray-400 hover:bg-gray-50 border-b border-gray-100",children:"清除"}),w.map(d=>e.jsx("button",{"data-time":d,onClick:()=>x(d),className:`w-full text-left px-2 py-1 text-xs hover:bg-blue-50 transition-colors ${l===d?"bg-blue-50 text-blue-600":"text-gray-700"}`,children:d},d))]})]})]})},$e=({currentView:l,onViewChange:t})=>{const a=[{id:"week",name:"周视图"},{id:"year",name:"年视图"},{id:"management",name:"管理界面"}];return e.jsx("nav",{className:"flex items-center space-x-1 bg-gray-100 rounded-lg p-1",children:a.map(s=>e.jsx("button",{onClick:()=>t(s.id),className:`px-3 py-1 text-sm font-medium rounded-md transition-colors ${l===s.id?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:s.name},s.id))})},Ts=({isOpen:l,onClose:t,totalTime:a,onSave:s})=>{const[n,o]=c.useState(0),[m,h]=c.useState("");c.useEffect(()=>{if(l){const y=Math.floor(a);o(y),h(y.toString())}},[l,a]);const f=()=>{const y=parseInt(m,10);!isNaN(y)&&y>0&&(s(y),t())},v=y=>{y.key==="Enter"?f():y.key==="Escape"&&t()};return l?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-80",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"修改每周工作时间"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"每周工作时间（小时）"}),e.jsx("input",{type:"number",value:m,onChange:y=>h(y.target.value),onKeyDown:v,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"1",max:"168",placeholder:"输入每周工作时间",autoFocus:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"取消"}),e.jsx("button",{onClick:f,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"保存"})]})]})}):null},Me=({onImport:l,className:t=""})=>{const a=c.useRef(null),s=()=>{const m=JSON.parse(localStorage.getItem("weeklyImportantTasks")||"{}"),h=JSON.parse(localStorage.getItem("quickTasks")||"{}"),f=JSON.parse(localStorage.getItem("taskTimeRecords")||"{}"),v=localStorage.getItem("totalWorkingHours")||"40",y={weeklyImportantTasks:m,quickTasks:h,taskTimeRecords:f,totalWorkingHours:parseInt(v,10),exportDate:new Date().toISOString(),version:"1.0"},E=JSON.stringify(y,null,2),G=new Blob([E],{type:"application/json"}),w=document.createElement("a");w.href=URL.createObjectURL(G),w.download=`life-system-data-${F(new Date,"yyyy-MM-dd-HHmm")}.json`,document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(w.href)},n=m=>{const h=m.target.files[0];if(!h)return;const f=new FileReader;f.onload=v=>{try{const y=JSON.parse(v.target.result);if(!y.version){alert("无效的数据文件格式");return}y.weeklyImportantTasks&&localStorage.setItem("weeklyImportantTasks",JSON.stringify(y.weeklyImportantTasks)),y.quickTasks&&localStorage.setItem("quickTasks",JSON.stringify(y.quickTasks)),y.taskTimeRecords&&localStorage.setItem("taskTimeRecords",JSON.stringify(y.taskTimeRecords)),y.totalWorkingHours&&localStorage.setItem("totalWorkingHours",y.totalWorkingHours.toString()),l&&l(y),alert("数据导入成功！页面将刷新以加载新数据。"),window.location.reload()}catch(y){console.error("导入数据失败:",y),alert("导入数据失败，请检查文件格式是否正确")}},f.readAsText(h),m.target.value=""},o=()=>{var m;(m=a.current)==null||m.click()};return e.jsxs("div",{className:`flex items-center space-x-2 ${t}`,children:[e.jsxs("button",{onClick:s,className:"btn-secondary text-xs px-2 py-0.5 flex items-center space-x-1",title:"导出数据",children:[e.jsx(Ve,{className:"w-3 h-3"}),e.jsx("span",{children:"导出"})]}),e.jsxs("button",{onClick:o,className:"btn-secondary text-xs px-2 py-0.5 flex items-center space-x-1",title:"导入数据",children:[e.jsx(Be,{className:"w-3 h-3"}),e.jsx("span",{children:"导入"})]}),e.jsx("input",{ref:a,type:"file",accept:".json",onChange:n,className:"hidden"})]})},Is=()=>{const[l,t]=c.useState([]),[a,s]=c.useState(!1),[n,o]=c.useState({title:"",date:"",color:"red"}),[m,h]=c.useState(null),[f,v]=c.useState([]),[y,E]=c.useState(!1),[G,w]=c.useState(null),[x,C]=c.useState({title:"",date:"",color:"red"});new Date().getFullYear();const g=new Date(2025,9,1),d=new Date,j=Array.from({length:13},(u,D)=>{const O=We(g,D);return{date:O,name:F(O,"M月",{locale:xe}),fullName:F(O,"yyyy年M月",{locale:xe})}}),_=[{value:"red",name:"红色",class:"bg-red-500"},{value:"orange",name:"橙色",class:"bg-orange-500"},{value:"pink",name:"粉色",class:"bg-pink-500"},{value:"green",name:"绿色",class:"bg-green-500"},{value:"purple",name:"紫色",class:"bg-purple-500"},{value:"blue",name:"蓝色",class:"bg-blue-500"},{value:"yellow",name:"黄色",class:"bg-yellow-500"},{value:"indigo",name:"靛蓝色",class:"bg-indigo-500"}];c.useEffect(()=>{const u=localStorage.getItem("yearGoals");if(u)try{t(JSON.parse(u))}catch(D){console.error("Failed to parse yearGoals:",D)}},[]);const N=u=>{t(u),localStorage.setItem("yearGoals",JSON.stringify(u))},P=()=>{if(!n.title||!n.date)return;const u=ne(n.date);if(!_e(u))return;u<d&&(E(!0),setTimeout(()=>E(!1),3e3));const O={id:Date.now().toString(),title:n.title,date:n.date,color:n.color},B=[...l,O].sort((Y,X)=>new Date(Y.date)-new Date(X.date));N(B),o({title:"",date:"",color:"red"}),s(!1)},z=(u,D)=>{D.stopPropagation(),N(l.filter(O=>O.id!==u))},V=(u,D)=>{D.stopPropagation(),w(u.id),C({title:u.title,date:u.date,color:u.color})},A=()=>{if(!x.title||!x.date)return;const u=ne(x.date);if(!_e(u))return;const D=l.map(O=>O.id===G?{...O,title:x.title,date:x.date,color:x.color}:O).sort((O,B)=>new Date(O.date)-new Date(B.date));N(D),w(null),C({title:"",date:"",color:"red"})},Z=()=>{w(null),C({title:"",date:"",color:"red"})},ee=u=>{const D=ne(u),O=Se(D,g),B=Se(We(g,13),g);return O/B*100},Q=u=>{const D=ne(u);return Se(D,d)},oe=u=>{const D=ne(u);return kt(D,d)},le=()=>l.filter(D=>Q(D.date)>0).sort((D,O)=>Q(D.date)-Q(O.date))[0],U=u=>{const D=u.currentTarget.getBoundingClientRect(),O=u.clientX-D.left,B=O/D.width*100,Y=l.filter(X=>{const q=ee(X.date);return Math.abs(q-B)<=3});Y.length>0?(h({x:O,goals:Y}),v(Y)):(h(null),v([]))};return le(),e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg p-4 border border-purple-200 mb-4",children:[a&&e.jsxs("div",{className:"bg-white rounded border border-gray-200 p-3 mb-3",children:[y&&e.jsx("div",{className:"mb-2 p-2 bg-yellow-50 border border-yellow-200 rounded text-xs text-yellow-800",children:"⚠️ 注意：您选择的是过去的日期，目标已添加但显示为已过期状态"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsx("input",{type:"text",placeholder:"目标名称",value:n.title,onChange:u=>o({...n,title:u.target.value}),className:"col-span-2 text-xs px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-purple-500"}),e.jsx("input",{type:"date",value:n.date,onChange:u=>o({...n,date:u.target.value}),min:"1900-01-01",max:"2099-12-31",className:"text-xs px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-purple-500"}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("select",{value:n.color,onChange:u=>o({...n,color:u.target.value}),className:"flex-1 text-xs px-1 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-purple-500",children:_.map(u=>e.jsx("option",{value:u.value,children:u.name},u.value))}),e.jsx("button",{onClick:P,className:"text-xs bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600",children:"✓"}),e.jsx("button",{onClick:()=>s(!1),className:"text-xs bg-gray-500 text-white px-2 py-1 rounded hover:bg-gray-600",children:"✕"})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex justify-between items-center mb-2",children:j.map((u,D)=>e.jsx("div",{className:"text-xs text-gray-600 text-center",children:u.name},D))}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative h-6 bg-gray-100 rounded-full mb-2 cursor-pointer flex-1",onMouseMove:U,onMouseLeave:()=>{h(null),v([])},children:[e.jsx("div",{className:"absolute top-0 w-0.5 h-full bg-red-500 rounded-full z-10",style:{left:`${ee(F(d,"yyyy-MM-dd"))}%`},title:`今天 ${F(d,"M月d日")}`}),l.map(u=>{var q;const D=ee(u.date),O=((q=_.find(R=>R.value===u.color))==null?void 0:q.class)||"bg-blue-500",B=Q(u.date),Y=B<0,X=f.some(R=>R.id===u.id);return e.jsx("div",{className:"absolute top-0 h-full flex items-center z-20",style:{left:`${D}%`},children:e.jsx("div",{className:`w-3 h-3 ${O} border-2 border-white cursor-pointer transition-all duration-200 ${Y?"opacity-50":""} ${X?"scale-125 shadow-lg":"hover:scale-110"}`,title:`${u.title} - ${F(ne(u.date),"M月d日")} ${Y?"(已过期)":`(还有${B}天)`}`})},u.id)})]}),e.jsx("button",{onClick:()=>s(!a),className:"w-6 h-6 bg-purple-500 text-white rounded-full hover:bg-purple-600 transition-colors flex items-center justify-center flex-shrink-0 mb-2",title:"添加目标",children:e.jsx(jt,{className:"w-3 h-3"})})]}),m&&f.length>0&&e.jsxs("div",{className:"absolute z-30 bg-white border border-gray-300 rounded-lg shadow-lg p-3 min-w-64",style:{left:`${Math.min(Math.max(m.x-128,0),400)}px`,top:"-120px"},children:[e.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-full",children:e.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-300"})}),e.jsx("div",{className:"space-y-2",children:f.map((u,D)=>{var q;const O=((q=_.find(R=>R.value===u.color))==null?void 0:q.class)||"bg-blue-500",B=Q(u.date),Y=oe(u.date),X=B<0;return e.jsxs("div",{className:"flex items-center justify-between group",children:[e.jsxs("div",{className:"flex items-center space-x-2 flex-1",children:[e.jsx("div",{className:`w-2 h-2 ${O} flex-shrink-0`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:u.title}),e.jsxs("div",{className:"text-xs text-gray-500",children:[F(ne(u.date),"yyyy年M月d日"),!X&&e.jsxs("span",{className:"ml-2 text-purple-600 font-medium",children:["还有 ",B," 天 (",Y," 周)"]}),X&&e.jsxs("span",{className:"ml-2 text-red-500",children:["已过期 ",Math.abs(B)," 天"]})]})]})]}),e.jsx("button",{onClick:R=>z(u.id,R),className:"opacity-0 group-hover:opacity-100 text-gray-400 hover:text-red-500 ml-2 transition-opacity",children:e.jsx(me,{className:"w-3 h-3"})})]},u.id)})})]}),l.length>0&&e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:l.sort((u,D)=>new Date(u.date)-new Date(D.date)).map(u=>{var X,q;const D=((X=_.find(R=>R.value===u.color))==null?void 0:X.class)||"bg-red-500",O=Q(u.date),B=O<0;return G===u.id?e.jsxs("div",{className:"flex items-center space-x-2 bg-blue-50 border border-blue-200 rounded px-2 py-1",children:[e.jsx("div",{className:`w-3 h-3 ${((q=_.find(R=>R.value===x.color))==null?void 0:q.class)||"bg-red-500"} flex-shrink-0`}),e.jsx("input",{type:"text",value:x.title,onChange:R=>C({...x,title:R.target.value}),className:"text-xs px-1 py-0.5 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 w-20",placeholder:"目标名称"}),e.jsx("input",{type:"date",value:x.date,onChange:R=>C({...x,date:R.target.value}),min:"1900-01-01",max:"2099-12-31",className:"text-xs px-1 py-0.5 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"}),e.jsx("select",{value:x.color,onChange:R=>C({...x,color:R.target.value}),className:"text-xs px-1 py-0.5 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",children:_.map(R=>e.jsx("option",{value:R.value,children:R.name},R.value))}),e.jsx("button",{onClick:A,className:"text-green-600 hover:text-green-800 transition-colors",title:"保存",children:e.jsx(Ye,{className:"w-3 h-3"})}),e.jsx("button",{onClick:Z,className:"text-gray-400 hover:text-red-500 transition-colors",title:"取消",children:e.jsx(me,{className:"w-3 h-3"})})]},u.id):e.jsxs("div",{className:`group flex items-center space-x-2 text-xs ${B?"opacity-50":""} hover:bg-gray-50 rounded px-2 py-1 transition-colors`,children:[e.jsx("div",{className:`w-3 h-3 ${D} flex-shrink-0`}),e.jsx("span",{className:"text-gray-700 font-medium",children:u.title}),e.jsx("span",{className:"text-gray-500",children:F(ne(u.date),"M/d")}),!B&&e.jsxs("span",{className:"text-purple-600 font-medium",children:["(",O,"天)"]}),e.jsx("button",{onClick:R=>V(u,R),className:"opacity-0 group-hover:opacity-100 text-gray-400 hover:text-blue-500 ml-1 transition-opacity",title:"编辑目标",children:e.jsx(wt,{className:"w-3 h-3"})}),e.jsx("button",{onClick:R=>z(u.id,R),className:"opacity-0 group-hover:opacity-100 text-gray-400 hover:text-red-500 ml-1 transition-opacity",title:"删除目标",children:e.jsx(me,{className:"w-3 h-3"})})]},u.id)})})})]})]})},Cs=({onRecover:l})=>{const[t,a]=c.useState("checking"),[s,n]=c.useState({}),[o,m]=c.useState(!1);c.useEffect(()=>{h()},[]);const h=()=>{a("checking");const w=localStorage.getItem("weeklyImportantTasks"),x=localStorage.getItem("quickTasks"),C=localStorage.getItem("taskTimeRecords"),g=localStorage.getItem("totalWorkingHours"),d=localStorage.getItem("yearGoals"),j={weeklyImportantTasks:w?JSON.parse(w):null,quickTasks:x?JSON.parse(x):null,taskTimeRecords:C?JSON.parse(C):null,totalWorkingHours:g?parseInt(g):null,yearGoals:d?JSON.parse(d):null};n(j);const _=j.weeklyImportantTasks&&Object.keys(j.weeklyImportantTasks).length>0,N=j.quickTasks&&Object.keys(j.quickTasks).length>0,P=j.taskTimeRecords&&Object.keys(j.taskTimeRecords).length>0,z=j.yearGoals&&j.yearGoals.length>0;a(_||N||P||z?"found":"empty")},f=()=>{let w=[];if(s.weeklyImportantTasks){const x=Object.keys(s.weeklyImportantTasks).length;x>0&&w.push(`${x}周的重要任务`)}if(s.quickTasks){const x=Object.keys(s.quickTasks).length;let C=0;Object.values(s.quickTasks).forEach(g=>{Object.values(g).forEach(d=>{C+=d.filter(j=>j.text||j.time).length})}),C>0&&w.push(`${x}天共${C}个任务`)}if(s.taskTimeRecords){const x=Object.keys(s.taskTimeRecords).length;x>0&&w.push(`${x}个时间记录`)}return s.yearGoals&&s.yearGoals.length>0&&w.push(`${s.yearGoals.length}个年度目标`),w},v=()=>{try{l&&l(s),alert("数据恢复成功！"),window.location.reload()}catch(w){console.error("恢复数据失败:",w),alert("恢复数据失败，请重试。")}},y=()=>{confirm("确定要清空所有数据重新开始吗？此操作不可恢复！")&&(localStorage.clear(),window.location.reload())},E=()=>{const w={...s,exportDate:new Date().toISOString(),version:"1.0"},x=JSON.stringify(w,null,2),C=new Blob([x],{type:"application/json"}),g=document.createElement("a");g.href=URL.createObjectURL(C),g.download=`backup-data-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(g.href)},G=()=>{const w=document.createElement("input");w.type="file",w.accept=".json",w.onchange=x=>{const C=x.target.files[0];if(C){const g=new FileReader;g.onload=d=>{try{const j=JSON.parse(d.target.result);l&&l(j),alert("数据导入成功！"),window.location.reload()}catch{alert("文件格式错误，请选择正确的备份文件")}},g.readAsText(C)}},w.click()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(Nt,{className:"w-5 h-5 text-blue-500"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"数据管理中心"})]}),t==="checking"&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx(Xe,{className:"w-8 h-8 animate-spin mx-auto mb-2 text-blue-500"}),e.jsx("p",{children:"正在扫描本地数据..."})]}),t==="found"&&e.jsxs("div",{children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Te,{className:"w-5 h-5 text-green-600"}),e.jsx("h4",{className:"font-medium text-green-800",children:"找到你的数据了！"})]}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("p",{className:"mb-2",children:"在本地存储中发现以下数据："}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:f().map((w,x)=>e.jsx("li",{children:w},x))})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:v,className:"w-full bg-blue-500 text-white px-4 py-3 rounded-lg hover:bg-blue-600 transition-colors flex items-center justify-center space-x-2 font-medium",children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsx("span",{children:"恢复我的数据"})]}),e.jsxs("button",{onClick:E,className:"w-full bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors flex items-center justify-center space-x-2",children:[e.jsx(Ve,{className:"w-4 h-4"}),e.jsx("span",{children:"先备份数据到文件"})]}),e.jsxs("button",{onClick:()=>m(!o),className:"w-full bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors",children:[o?"隐藏":"查看","数据详情"]}),o&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-xs space-y-2",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"重要任务:"})," ",s.weeklyImportantTasks?Object.keys(s.weeklyImportantTasks).length+"周":"无"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"日常任务:"})," ",s.quickTasks?Object.keys(s.quickTasks).length+"天":"无"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"时间记录:"})," ",s.taskTimeRecords?Object.keys(s.taskTimeRecords).length+"条":"无"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"年度目标:"})," ",s.yearGoals?s.yearGoals.length+"个":"无"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"工作时间设置:"})," ",s.totalWorkingHours||40,"小时/周"]})]}),e.jsx("div",{className:"border-t pt-3",children:e.jsx("button",{onClick:y,className:"w-full bg-red-100 text-red-600 px-4 py-2 rounded-lg hover:bg-red-200 transition-colors text-sm",children:"清空所有数据重新开始"})})]})]}),t==="empty"&&e.jsxs("div",{children:[e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(St,{className:"w-5 h-5 text-yellow-600"}),e.jsx("h4",{className:"font-medium text-yellow-800",children:"没有找到数据"})]}),e.jsx("p",{className:"text-sm text-yellow-700",children:"本地存储中没有发现任何数据。如果你之前有数据，可能是因为："}),e.jsxs("ul",{className:"list-disc list-inside text-sm text-yellow-700 mt-2 space-y-1",children:[e.jsx("li",{children:"浏览器缓存被清理"}),e.jsx("li",{children:"使用了隐私模式"}),e.jsx("li",{children:"更换了浏览器或设备"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("h5",{className:"font-medium text-blue-800 mb-2",children:"如果你有备份文件："}),e.jsx("p",{className:"text-sm text-blue-700 mb-2",children:'点击下面的"导入数据"按钮，选择之前导出的JSON文件'}),e.jsxs("button",{onClick:G,className:"w-full bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors flex items-center justify-center space-x-2",children:[e.jsx(Be,{className:"w-4 h-4"}),e.jsx("span",{children:"导入备份数据"})]})]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"w-full bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors",children:"开始使用（创建新数据）"})]})]})]})})},te={SCHEDULE_DATA:"schedule_data",USER_ID:"user_id",SYNC_STATUS:"sync_status",LAST_SYNC:"last_sync"};class Ds{constructor(){this.userId=null,this.gistId=null,this.githubUsername=null}async getUserId(){if(this.userId&&this.userId.startsWith("github_user_"))return this.userId;try{const a=this.getApiKey(),s=await fetch("https://api.github.com/user",{headers:{Authorization:`token ${a}`,"Content-Type":"application/json"}});if(s.ok){const n=await s.json();this.githubUsername=n.login;const o=`github_user_${n.id}`;return localStorage.setItem(te.USER_ID,o),localStorage.setItem("github_username",n.login),console.log("获取GitHub用户ID:",o,"用户名:",n.login),this.userId=o,o}}catch(a){console.error("获取GitHub用户信息失败:",a)}let t=localStorage.getItem(te.USER_ID);return t||(t=`temp_user_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,localStorage.setItem(te.USER_ID,t),console.log("创建临时用户ID:",t)),this.userId=t,t}getLocalData(){const t=localStorage.getItem(te.SCHEDULE_DATA);return t?JSON.parse(t):this.getDefaultData()}getDefaultData(){return{weeks:{},importantTasks:[],quickTasks:{},timeRecords:[],settings:{weekStart:1,timeTrackingEnabled:!0,theme:"light"}}}saveLocalData(t){localStorage.setItem(te.SCHEDULE_DATA,JSON.stringify(t)),this.setSyncStatus("pending")}setSyncStatus(t){localStorage.setItem(te.SYNC_STATUS,t),localStorage.setItem(te.LAST_SYNC,new Date().toISOString())}getSyncStatus(){return{status:localStorage.getItem(te.SYNC_STATUS)||"pending",lastSync:localStorage.getItem(te.LAST_SYNC)}}getApiKey(){const t=localStorage.getItem("github_token");if(t)return t;throw new Error("No GitHub token configured")}async uploadToCloud(t){try{await this.getUserId();const a=this.getApiKey();console.log("开始上传数据到GitHub Gist，用户:",this.githubUsername),await this.findUserGist();const s={description:`Life System Schedule Data - ${this.githubUsername||"User"}`,public:!1,files:{"schedule-data.json":{content:JSON.stringify({data:t,userId:this.userId,githubUsername:this.githubUsername,lastUpdated:new Date().toISOString()})}}},n={Authorization:`token ${a}`,"Content-Type":"application/json"};let o;if(this.gistId?(console.log("更新现有Gist:",this.gistId),o=await fetch(`https://api.github.com/gists/${this.gistId}`,{method:"PATCH",headers:n,body:JSON.stringify(s)})):(console.log("创建新Gist"),o=await fetch("https://api.github.com/gists",{method:"POST",headers:n,body:JSON.stringify(s)})),!o.ok){const h=await o.text();throw console.error("上传请求失败:",o.status,h),new Error(`Failed to upload data to cloud: ${o.status} ${h}`)}const m=await o.json();return console.log("上传响应:",m),this.gistId=m.id,localStorage.setItem("gist_id",m.id),console.log("保存Gist ID:",m.id),this.setSyncStatus("success"),m}catch(a){throw console.error("Cloud upload failed:",a),this.setSyncStatus("error"),a}}async findUserGist(){await this.getUserId();const t=this.getApiKey();console.log("查找用户的Gist，用户:",this.githubUsername);const a=localStorage.getItem("gist_id");if(a){console.log("找到本地存储的Gist ID:",a);try{const s=await fetch(`https://api.github.com/gists/${a}`,{headers:{Authorization:`token ${t}`}});if(s.ok){const n=await s.json();if(n.description.includes(`Life System Schedule Data - ${this.githubUsername}`))return console.log("本地Gist有效且属于当前用户"),n}}catch(s){console.warn("验证本地Gist失败:",s)}}try{console.log("查找用户的Gists列表...");const s=await fetch("https://api.github.com/gists",{headers:{Authorization:`token ${t}`}});if(!s.ok)throw new Error("Failed to fetch user gists");const n=await s.json();console.log("获取到Gists列表:",n.length,"个");const o=n.find(m=>m.description&&m.description.includes(`Life System Schedule Data - ${this.githubUsername}`));return o?(console.log("找到用户的Gist:",o.id),localStorage.setItem("gist_id",o.id),this.gistId=o.id,o):(console.log("未找到用户的Gist，可能需要创建新的"),null)}catch(s){throw console.error("查找用户Gist失败:",s),s}}async downloadFromCloud(){var t;try{await this.getUserId();const a=this.getApiKey();console.log("尝试下载云端数据，用户:",this.githubUsername);const s=await this.findUserGist();if(!s)throw console.log("未找到用户的Gist，可能是首次使用"),new Error("No cloud data found");const n=(t=s.files["schedule-data.json"])==null?void 0:t.content;if(!n)throw new Error("No data file found in gist");const o=JSON.parse(n);if(console.log("下载到的Gist数据:",o),o.userId===this.userId)return this.setSyncStatus("success"),o.data;if(this.githubUsername&&o.githubUsername===this.githubUsername)return console.log("用户ID不匹配但用户名匹配，更新用户ID"),this.userId=o.userId,localStorage.setItem(te.USER_ID,o.userId),this.setSyncStatus("success"),o.data;throw console.log("数据不属于当前用户:",{local:{userId:this.userId,username:this.githubUsername},cloud:{userId:o.userId,username:o.githubUsername}}),new Error("Data does not belong to current user")}catch(a){throw console.error("Cloud download failed:",a),this.setSyncStatus("error"),a}}mergeData(t,a){const s={...t};if(Object.keys(a.weeks||{}).forEach(n=>{if(!t.weeks[n])s.weeks[n]=a.weeks[n];else{const o=t.weeks[n],m=a.weeks[n];Object.keys(m.days||{}).forEach(h=>{o.days[h]||(o.days[h]=m.days[h])})}}),a.importantTasks&&a.importantTasks.length>0){const n=t.importantTasks.map(m=>m.id),o=a.importantTasks.filter(m=>!n.includes(m.id));s.importantTasks=[...t.importantTasks,...o]}return Object.keys(a.quickTasks||{}).forEach(n=>{t.quickTasks[n]||(s.quickTasks[n]=a.quickTasks[n])}),s}async syncData(){try{await this.getUserId(),console.log("开始同步数据...用户:",this.githubUsername);const t=this.getLocalData();console.log("本地数据:",t);try{console.log("尝试从云端获取数据...");const a=await this.downloadFromCloud();console.log("云端数据:",a);const s=this.mergeData(t,a);return this.saveLocalData(s),console.log("上传合并后的数据..."),await this.uploadToCloud(s),{success:!0,data:s,source:"merged"}}catch(a){return console.warn("云端数据获取失败，只上传本地数据:",a),console.log("只上传本地数据:",t),await this.uploadToCloud(t),{success:!0,data:t,source:"local"}}}catch(t){return console.error("同步完全失败:",t),{success:!1,error:t.message}}}needsSync(){const{lastSync:t}=this.getSyncStatus();if(!t)return!0;const a=new Date(t).getTime(),s=new Date().getTime(),n=60*1e3;return s-a>n}}const W=new Ds,et=()=>{const[l,t]=c.useState(navigator.onLine),[a,s]=c.useState("pending"),[n,o]=c.useState(null);return c.useEffect(()=>{const h=()=>t(!0),f=()=>t(!1);return window.addEventListener("online",h),window.addEventListener("offline",f),()=>{window.removeEventListener("online",h),window.removeEventListener("offline",f)}},[]),c.useEffect(()=>{if(!l)return;const h=setInterval(async()=>{if(W.needsSync()){s("syncing");try{await W.syncData(),s("success"),o(new Date)}catch{s("error")}}},6e4);return()=>clearInterval(h)},[l]),{isOnline:l,syncStatus:a,lastSync:n,manualSync:async()=>{if(!l){alert("请检查网络连接");return}s("syncing");try{const h=await W.syncData();return s("success"),o(new Date),h}catch(h){throw s("error"),h}},needsSync:W.needsSync()}},se={getAllData:()=>W.getLocalData(),saveData:async l=>{if(W.saveLocalData(l),navigator.onLine)try{await W.getUserId(),W.uploadToCloud(l).catch(t=>{console.warn("Background sync failed, will retry later")})}catch(t){console.warn("无法获取用户信息，跳过同步:",t)}},getWeekData:l=>W.getLocalData().weeks[l]||{days:{},weekNumber:parseInt(l.split("-")[1]),year:parseInt(l.split("-")[0])},saveWeekData:async(l,t)=>{const a=W.getLocalData();if(a.weeks[l]=t,W.saveLocalData(a),navigator.onLine)try{await W.getUserId(),W.uploadToCloud(a).catch(s=>{console.warn("Background sync failed, will retry later")})}catch(s){console.warn("无法获取用户信息，跳过同步:",s)}},addImportantTask:async l=>{const t=W.getLocalData();if(t.importantTasks||(t.importantTasks=[]),t.importantTasks.push(l),W.saveLocalData(t),navigator.onLine)try{await W.getUserId(),W.uploadToCloud(t).catch(a=>{console.warn("Background sync failed, will retry later")})}catch(a){console.warn("无法获取用户信息，跳过同步:",a)}},updateImportantTask:async(l,t)=>{const a=W.getLocalData(),s=a.importantTasks.findIndex(n=>n.id===l);if(s!==-1&&(a.importantTasks[s]={...a.importantTasks[s],...t},W.saveLocalData(a),navigator.onLine))try{await W.getUserId(),W.uploadToCloud(a).catch(n=>{console.warn("Background sync failed, will retry later")})}catch(n){console.warn("无法获取用户信息，跳过同步:",n)}},deleteImportantTask:async l=>{const t=W.getLocalData();if(t.importantTasks=t.importantTasks.filter(a=>a.id!==l),W.saveLocalData(t),navigator.onLine)try{await W.getUserId(),W.uploadToCloud(t).catch(a=>{console.warn("Background sync failed, will retry later")})}catch(a){console.warn("无法获取用户信息，跳过同步:",a)}}},tt=()=>{const[l,t]=c.useState(null),[a,s]=c.useState(!0),{isOnline:n,syncStatus:o,manualSync:m,lastSync:h}=et(),f=c.useCallback(()=>{try{const g=se.getAllData();t(g),s(!1)}catch(g){console.error("Failed to load schedule data:",g),s(!1)}},[]),v=c.useCallback((g,d=!1)=>{try{se.saveData(g),t(g),n&&!d&&setTimeout(()=>{m().catch(j=>{console.warn("自动同步失败:",j)})},1e3)}catch(j){console.error("Failed to save schedule data:",j)}},[n,m]),y=c.useCallback(g=>l?se.getWeekData(g):null,[l]),E=c.useCallback((g,d)=>{const j={...l};j.weeks[g]=d,v(j)},[l,v]),G=c.useCallback(g=>{se.addImportantTask(g),f()},[f]),w=c.useCallback((g,d)=>{se.updateImportantTask(g,d),f()},[f]),x=c.useCallback(g=>{se.deleteImportantTask(g),f()},[f]),C=c.useCallback(g=>{try{se.saveData(g),t(g),n&&m().catch(d=>{console.warn("立即同步失败:",d)})}catch(d){console.error("Failed to save schedule data:",d)}},[n,m]);return c.useEffect(()=>{f()},[f]),c.useEffect(()=>{const g=()=>{n&&o!=="success"&&m().then(()=>{f()})};return window.addEventListener("online",g),()=>window.removeEventListener("online",g)},[n,o,m,f]),{data:l,loading:a,isOnline:n,syncStatus:o,manualSync:m,lastSync:h,loadData:f,saveData:v,saveDataWithImmediateSync:C,getWeekData:y,saveWeekData:E,addImportantTask:G,updateImportantTask:w,deleteImportantTask:x}},Je=({tasks:l,onAddTask:t,onUpdateTask:a,currentView:s,onViewChange:n})=>{const{isOnline:o,lastSync:m}=tt(),[h,f]=c.useState(new Date),[v,y]=c.useState(!1),E=null,[G,w]=c.useState({}),[x,C]=c.useState({}),[g,d]=c.useState(null),[j,_]=c.useState(null),[N,P]=c.useState(null),[z,V]=c.useState({}),[A,Z]=c.useState(null),[ee,Q]=c.useState(!1),[oe,le]=c.useState(!1),[U,u]=c.useState(40),[D,O]=c.useState(null),[B,Y]=c.useState(!1),X=()=>{const r=Ie(h,{weekStartsOn:1});return F(r,"yyyy-MM-dd")},q=()=>{const r=X();return!G[r]||G[r].length===0?[{id:"important-1",text:""},{id:"important-2",text:""},{id:"important-3",text:""}]:G[r]},R=r=>{u(r),localStorage.setItem("totalWorkingHours",r.toString())},Oe=r=>{r.weeklyImportantTasks&&w(r.weeklyImportantTasks),r.quickTasks&&C(r.quickTasks),r.totalWorkingHours&&u(r.totalWorkingHours)},st=(r,i=!1)=>({red:i?"rgba(239, 68, 68, 0.1)":"rgba(239, 68, 68, 0.2)",orange:i?"rgba(249, 115, 22, 0.1)":"rgba(249, 115, 22, 0.2)",pink:i?"rgba(236, 72, 153, 0.1)":"rgba(236, 72, 153, 0.2)",green:i?"rgba(34, 197, 94, 0.1)":"rgba(34, 197, 94, 0.2)",purple:i?"rgba(168, 85, 247, 0.1)":"rgba(168, 85, 247, 0.2)",blue:i?"rgba(59, 130, 246, 0.1)":"rgba(59, 130, 246, 0.2)",yellow:i?"rgba(234, 179, 8, 0.1)":"rgba(234, 179, 8, 0.2)",indigo:i?"rgba(99, 102, 241, 0.1)":"rgba(99, 102, 241, 0.2)",tencent:i?"rgba(0, 102, 255, 0.1)":"rgba(0, 102, 255, 0.2)"})[r]||"transparent",je=Ie(h,{weekStartsOn:1}),ge=Array.from({length:7},(r,i)=>Ce(je,i)),we=[{id:"morning",name:"早上",time:"06:00-12:00",color:"bg-yellow-50 border-yellow-200"},{id:"noon",name:"中午",time:"12:00-14:00",color:"bg-orange-50 border-orange-200"},{id:"afternoon",name:"下午",time:"14:00-18:00",color:"bg-blue-50 border-blue-200"},{id:"evening",name:"晚上",time:"18:00-24:00",color:"bg-purple-50 border-purple-200"}];c.useEffect(()=>{const r=localStorage.getItem("weeklyImportantTasks");if(r)try{w(JSON.parse(r))}catch(k){console.error("Failed to parse weeklyImportantTasks:",k)}const i=localStorage.getItem("quickTasks");if(i)try{C(JSON.parse(i))}catch(k){console.error("Failed to parse quickTasks:",k)}const b=localStorage.getItem("taskTimeRecords");if(b)try{V(JSON.parse(b))}catch(k){console.error("Failed to parse taskTimeRecords:",k)}const S=localStorage.getItem("totalWorkingHours");S&&u(parseInt(S,10)),Q(!0)},[]),c.useEffect(()=>{if(!ee)return;const r={...x};ge.forEach(i=>{const b=F(i,"yyyy-MM-dd");r[b]||(r[b]={}),we.forEach(S=>{(!r[b][S.id]||r[b][S.id].length===0)&&(r[b][S.id]=[{id:`${b}-${S.id}-${Date.now()}-0`,text:"",time:"",color:"",completed:!1}])})}),JSON.stringify(r)!==JSON.stringify(x)&&C(r)},[h,ee,x]),c.useEffect(()=>{const r=i=>{i.key==="Escape"&&(Z(null),P(null))};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[]);const ie=c.useRef(!1),H=c.useRef(null);c.useRef(null);const rt=(r,i)=>{const b=X(),k=q().map((I,$)=>$===r?{...I,text:i}:I);w(I=>({...I,[b]:k})),localStorage.setItem("weeklyImportantTasks",JSON.stringify({...G,[b]:k}))},ke=(r,i,b,S,k)=>{const I={...x,[r]:{...x[r],[i]:x[r][i].map((L,M)=>M===b?{...L,[S]:k}:L)}},$=I[r][i],T=b===$.length-1,p=$[b],J=p.text||p.time;T&&J&&(I[r][i]=[...$,{id:`${r}-${i}-${Date.now()}`,text:"",time:"",color:"",completed:!1}]),C(I),localStorage.setItem("quickTasks",JSON.stringify(I)),localStorage.setItem("weeklyImportantTasks",JSON.stringify(G))},at=(r,i,b)=>{const k=x[r][i].filter(($,T)=>T!==b);(k.length===0||k.every($=>$.text||$.time))&&k.push({id:`${r}-${i}-${Date.now()}`,text:"",time:"",color:"",completed:!1});const I={...x,[r]:{...x[r],[i]:k}};C(I),localStorage.setItem("quickTasks",JSON.stringify(I)),localStorage.setItem("weeklyImportantTasks",JSON.stringify(G))},nt=(r,i,b,S)=>{const k=x[r][i][b],I=k.completed,$={...x,[r]:{...x[r],[i]:x[r][i].map((T,p)=>p===b?{...T,completed:!T.completed}:T)}};if(C($),localStorage.setItem("quickTasks",JSON.stringify($)),!I&&S){const T=S.target.getBoundingClientRect(),p=i==="evening"?-35:25;P({taskId:k.id,x:T.left-10,y:T.top+p,dayKey:r,slotId:i,taskIndex:b,taskColor:k.color||"green"})}},ot=(r,i,b,S)=>{const k=x[i][b][S];!k.text&&!k.time||(d({task:k,sourceDayKey:i,sourceSlotId:b,sourceTaskIndex:S}),r.dataTransfer.effectAllowed="move",r.dataTransfer.setData("text/plain",""),r.target.style.opacity="0.5")},lt=r=>{r.target.style.opacity="1"},it=(r,i,b)=>{r.preventDefault(),r.dataTransfer.dropEffect="move",_(`${i}-${b}`)},ct=()=>{_(null)},dt=(r,i,b)=>{var fe;if(r.preventDefault(),_(null),!g)return;const{task:S,sourceDayKey:k,sourceSlotId:I,sourceTaskIndex:$}=g;if(k===i&&I===b){d(null);return}const T={...S,id:`${i}-${b}-${Date.now()}`,completed:!1},p=x[k][I].filter((ce,pt)=>pt!==$);(p.length===0||p.every(ce=>ce.text||ce.time))&&p.push({id:`${k}-${I}-${Date.now()}-empty`,text:"",time:"",color:"",completed:!1});const J=((fe=x[i])==null?void 0:fe[b])||[],L=J.findLastIndex(ce=>ce.text||ce.time),M=L>=0?L+1:0,K=[...J];K.splice(M,0,T);const ae={...x,[k]:{...x[k],[I]:p},[i]:{...x[i],[b]:K}};C(ae),localStorage.setItem("quickTasks",JSON.stringify(ae)),d(null)},ut=(r,i)=>l.filter(b=>{if(!Le(new Date(b.date),r))return!1;const S=b.time;if(!S)return!1;const k=parseInt(S.split(":")[0]);switch(i){case"morning":return k>=6&&k<12;case"noon":return k>=12&&k<14;case"afternoon":return k>=14&&k<18;case"evening":return k>=18||k<6;default:return!1}}),he=(r,i)=>{const b={...z,[r]:(z[r]||0)+i};V(b),P(null),localStorage.setItem("taskTimeRecords",JSON.stringify(b))},mt=r=>{const i={...z};delete i[r],V(i),P(null),localStorage.setItem("taskTimeRecords",JSON.stringify(i))},xt=(r,i,b)=>{const k={...x[r][i][b],id:`${r}-${i}-${Date.now()}-copy`,completed:!1},I={...x,[r]:{...x[r],[i]:[...x[r][i],k]}};C(I),localStorage.setItem("quickTasks",JSON.stringify(I)),Z(null)},pe=r=>{const i={red:{bg:"bg-red-500",border:"border-red-500",hover:"hover:bg-red-50",text:"text-red-500"},orange:{bg:"bg-orange-500",border:"border-orange-500",hover:"hover:bg-orange-50",text:"text-orange-500"},pink:{bg:"bg-pink-500",border:"border-pink-500",hover:"hover:bg-pink-50",text:"text-pink-500"},green:{bg:"bg-green-500",border:"border-green-500",hover:"hover:bg-green-50",text:"text-green-500"},purple:{bg:"bg-purple-500",border:"border-purple-500",hover:"hover:bg-purple-50",text:"text-purple-500"},blue:{bg:"bg-blue-500",border:"border-blue-500",hover:"hover:bg-blue-50",text:"text-blue-500"},yellow:{bg:"bg-yellow-500",border:"border-yellow-500",hover:"hover:bg-yellow-50",text:"text-yellow-500"},indigo:{bg:"bg-indigo-500",border:"border-indigo-500",hover:"hover:bg-indigo-50",text:"text-indigo-500"},tencent:{bg:"bg-[#0066FF]",border:"border-[#0066FF]",hover:"hover:bg-[#f0f7ff]",text:"text-[#0066FF]"}};return!r||typeof r!="string"?i.green:i[r]||i.green},re=r=>z[r]||0,gt=r=>{if(r<60)return`${r}分钟`;const i=Math.floor(r/60),b=r%60;return b>0?`${i}小时${b}分钟`:`${i}小时`},ht=()=>{const r={},i={};ge.forEach(I=>{const $=F(I,"yyyy-MM-dd");we.forEach(T=>{var J;(((J=x[$])==null?void 0:J[T.id])||[]).forEach(L=>{if(L.color&&(L.text||L.time))if(L.completed){const M=re(L.id),K=M>0?M/60:.5;i[L.color]=(i[L.color]||0)+K}else r[L.color]=(r[L.color]||0)+1})})});const b=["red","orange","pink","green","purple","blue","yellow","indigo","tencent"],S={},k={};return b.forEach(I=>{r[I]&&(S[I]=r[I]),i[I]&&(k[I]=i[I])}),{plannedColorStats:S,actualColorStats:k,totalWorkingHours:U}};return e.jsxs("div",{className:"space-y-3",onClick:()=>{Z(null),O(null)},children:[B&&e.jsx(Cs,{onRecover:r=>{Oe(r),Y(!1)}}),e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"人生系统设计"}),e.jsxs("p",{className:"text-gray-500 text-sm",children:[F(je,"yyyy年MM月dd日",{locale:xe})," - ",F(Ce(je,6),"MM月dd日",{locale:xe})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[o?v?e.jsxs("div",{className:"flex items-center space-x-1 text-blue-500",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-xs text-blue-500",children:"同步中"})]}):e.jsxs("div",{className:"flex items-center space-x-1 text-green-500",children:[e.jsx(Tt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs text-green-500",children:m?`已同步 ${F(m,"HH:mm")}`:"已同步"})]}):e.jsxs("div",{className:"flex items-center space-x-1 text-gray-500",children:[e.jsx(It,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs text-gray-500",children:"离线"})]}),E]}),e.jsx($e,{currentView:s,onViewChange:n}),e.jsx(Me,{onImport:Oe}),e.jsx("button",{onClick:()=>Y(!0),className:"btn-secondary text-xs px-2 py-0.5 text-blue-600 hover:text-blue-700",title:"数据管理：备份、恢复、导入导出",children:"数据管理"}),e.jsx("button",{onClick:()=>f(new Date),className:"btn-secondary text-xs px-2 py-0.5",children:"本周"})]})]}),e.jsx(Is,{}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg px-4 py-2 border border-blue-200",children:e.jsx("div",{className:"flex items-center gap-3",children:q().map((r,i)=>e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex bg-white rounded border border-blue-200 focus-within:ring-1 focus-within:ring-blue-500 focus-within:border-transparent transition-all overflow-hidden",children:[e.jsxs("div",{className:"bg-yellow-400 text-white px-2 py-1.5 text-xs font-bold flex items-center justify-center min-w-10",children:["TOP",i+1]}),e.jsx("input",{type:"text",value:r.text,onChange:b=>rt(i,b.target.value),className:"flex-1 px-2 py-1.5 text-sm bg-transparent border-none focus:outline-none"})]})},r.id))})}),e.jsxs("div",{className:"flex bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden w-full",children:[e.jsxs("div",{className:"flex-1 min-w-0 w-full",children:[e.jsxs("div",{className:"grid border-b border-gray-200",style:{gridTemplateColumns:"100px repeat(7, 1fr)"},children:[e.jsxs("div",{className:"p-2 bg-gray-50 font-medium text-gray-900 text-lg border-r border-gray-200 flex items-center justify-center h-full",children:[F(h,"MM"),"月"]}),ge.map((r,i)=>{const b=Le(r,new Date),S=i===5||i===6;return e.jsx("div",{className:`p-2 text-center font-medium border-l border-gray-200 ${b?"bg-blue-50 text-blue-900":S?"bg-gray-100 text-gray-700":"bg-gray-50 text-gray-900"}`,children:e.jsxs("div",{className:"flex items-center justify-center space-x-1 text-sm",children:[e.jsx("span",{className:`text-lg font-bold ${b?"text-blue-600":""}`,children:F(r,"dd")}),e.jsx("span",{className:"text-gray-400 text-xs",children:"·"}),e.jsx("span",{className:"text-gray-600 text-xs",children:["一","二","三","四","五","六","日"][i]})]})},r.toString())})]}),we.map(r=>e.jsxs("div",{className:"grid border-b border-gray-200 min-h-24",style:{gridTemplateColumns:"100px repeat(7, 1fr)"},children:[e.jsx("div",{className:`p-2 ${r.color} border-r border-gray-200 flex flex-col justify-center items-center`,children:e.jsx("div",{className:"font-medium text-gray-900 text-sm",children:r.name})}),ge.map((i,b)=>{var T;const S=F(i,"yyyy-MM-dd"),k=ut(i,r.id),I=((T=x[S])==null?void 0:T[r.id])||[],$=b===5||b===6;return e.jsxs("div",{className:`p-2 border-l border-gray-200 space-y-1 min-h-24 overflow-hidden relative ${$?"bg-gray-25":""} ${j===`${S}-${r.id}`?"bg-blue-100 border-blue-400 border-2 border-dashed":""} ${g?"transition-all duration-200":""} ${g&&j!==`${S}-${r.id}`?"hover:bg-blue-50 hover:border-blue-200 hover:border-dashed":""}`,style:$?{backgroundColor:"#fafafa"}:{},onDragOver:p=>it(p,S,r.id),onDragLeave:ct,onDrop:p=>dt(p,S,r.id),children:[k.map(p=>e.jsxs("div",{className:"text-xs p-2 bg-blue-100 text-blue-800 rounded border border-blue-200 cursor-pointer hover:bg-blue-200 transition-colors",onClick:()=>a(p.id,p),children:[e.jsx("div",{className:"font-medium break-words overflow-hidden text-ellipsis",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:p.title}),p.time&&e.jsx("div",{className:"text-blue-600 mt-0.5",children:p.time})]},p.id)),I.map((p,J)=>{const L=p.text||p.time;return e.jsxs("div",{className:`flex items-center mb-1 group rounded p-1 ${L?"cursor-move hover:shadow-sm hover:bg-gray-50":""} ${D&&p.color===D?`ring-2 ring-opacity-50 ${pe(D).text.replace("text-","ring-")}`:p.completed?"opacity-60":""} ${g&&g.task.id===p.id?"opacity-50":""}`,draggable:L,onDragStart:M=>ot(M,S,r.id,J),onDragEnd:lt,title:L?"拖拽任务到其他时间段":"",onContextMenu:M=>{L&&(M.preventDefault(),Z({taskId:p.id,x:M.clientX,y:M.clientY,dayKey:S,slotId:r.id,taskIndex:J,taskData:p}))},style:{backgroundColor:p.time&&p.color?st(p.color,D&&p.color===D?!1:p.completed):"transparent",position:"relative",transition:"all 0.2s ease"},children:[L&&e.jsx("div",{className:"relative mr-1 flex-shrink-0",children:e.jsx("input",{type:"checkbox",checked:p.completed||!1,onChange:M=>{M.stopPropagation(),Z(null),nt(S,r.id,J,M)},onMouseEnter:M=>{if(p.completed){H.current&&(clearTimeout(H.current),H.current=null),ie.current=!0;const K=M.currentTarget.getBoundingClientRect(),ae=r.id==="evening"?-35:25;P({taskId:p.id,x:K.left-10,y:K.top+ae,dayKey:S,slotId:r.id,taskIndex:J,taskColor:p.color||"green"})}},onMouseLeave:()=>{ie.current=!1,H.current=setTimeout(()=>{ie.current||P(null)},300)},className:`w-3 h-3 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 cursor-pointer z-10 ${p.completed?"opacity-80":""}`,title:p.completed?"悬停记录用时":"点击完成任务"})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Ss,{value:p.time,color:p.color,completed:p.completed,onChange:M=>ke(S,r.id,J,"time",M),onColorChange:M=>ke(S,r.id,J,"color",M)})}),!p.time&&e.jsx("div",{className:`w-px h-4 ml-1 mr-2 flex-shrink-0 ${p.completed?"bg-gray-300":"bg-gray-200"}`}),e.jsx("div",{className:"flex-1 flex items-start overflow-hidden",children:e.jsx("textarea",{value:p.text,onChange:M=>{ke(S,r.id,J,"text",M.target.value)},className:`flex-1 text-xs p-1 border-none focus:outline-none bg-transparent resize-none overflow-hidden break-words ${D&&p.color===D?"text-gray-700":p.completed?"line-through text-gray-500":"text-gray-700"}`,onClick:M=>M.stopPropagation(),rows:1,style:{minHeight:"20px",maxHeight:"60px",width:"100%",boxSizing:"border-box"},onInput:M=>{M.target.style.height="auto",M.target.style.height=`${M.target.scrollHeight}px`}})}),D&&p.color===D&&re(p.id)>0&&e.jsx("div",{className:"absolute right-1 top-1/2 transform -translate-y-1/2 text-xs font-medium text-gray-700 bg-white bg-opacity-80 px-1 rounded",children:re(p.id)>=60?`${(re(p.id)/60).toFixed(re(p.id)%60===0?0:1)}h`:`${re(p.id)}m`})]},p.id)})]},`${S}-${r.id}`)})]},r.id))]}),e.jsxs("div",{className:"w-8 border-l border-gray-200 flex flex-col",children:[e.jsx("div",{className:"flex-1 bg-gray-50 hover:bg-blue-50 cursor-pointer flex items-center justify-center group transition-colors border-b border-gray-200",onClick:()=>f(Dt(h,1)),title:"上一周",children:e.jsx(Ct,{className:"w-4 h-4 text-gray-400 group-hover:text-blue-600"})}),e.jsx("div",{className:"flex-1 bg-gray-50 hover:bg-blue-50 cursor-pointer flex items-center justify-center group transition-colors",onClick:()=>f(Qe(h,1)),title:"下一周",children:e.jsx($t,{className:"w-4 h-4 text-gray-400 group-hover:text-blue-600"})})]})]}),N&&(()=>{const r=pe(N.taskColor),i=240,b=100,S=typeof window<"u"?window.innerWidth:1920,k=typeof window<"u"?window.innerHeight:1080,I=Math.max(10,Math.min(N.x,S-i-10)),$=Math.max(10,Math.min(N.y,k-b-10));return e.jsxs("div",{className:"time-tracking-popup fixed bg-white border border-gray-200 rounded shadow-lg p-2 z-[9999]",style:{left:`${I}px`,top:`${$}px`},onMouseEnter:()=>{H.current&&(clearTimeout(H.current),H.current=null),ie.current=!0},onMouseLeave:()=>{ie.current=!1,H.current=setTimeout(()=>{ie.current||P(null)},200)},children:[e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{onClick:T=>{T.preventDefault(),T.stopPropagation(),H.current&&(clearTimeout(H.current),H.current=null),he(N.taskId,30)},className:`flex items-center justify-center w-6 h-6 ${r.hover} rounded`,title:"30分钟",children:e.jsx("div",{className:`w-3 h-3 border ${r.border} rounded-full relative`,children:e.jsx("div",{className:`absolute inset-0 ${r.bg} rounded-full`,style:{clipPath:"polygon(50% 0%, 100% 0%, 100% 100%, 50% 100%)"}})})}),e.jsx("button",{onClick:T=>{T.preventDefault(),T.stopPropagation(),H.current&&(clearTimeout(H.current),H.current=null),he(N.taskId,60)},className:`flex items-center justify-center w-6 h-6 ${r.hover} rounded`,title:"1小时",children:e.jsx("div",{className:`w-3 h-3 ${r.bg} rounded-full`})}),e.jsx("button",{onClick:T=>{T.preventDefault(),T.stopPropagation(),H.current&&(clearTimeout(H.current),H.current=null),he(N.taskId,120)},className:`flex items-center justify-center w-6 h-6 ${r.hover} rounded`,title:"2小时",children:e.jsxs("div",{className:"flex space-x-0.5",children:[e.jsx("div",{className:`w-2 h-2 ${r.bg} rounded-full`}),e.jsx("div",{className:`w-2 h-2 ${r.bg} rounded-full`})]})}),e.jsx("button",{onClick:T=>{T.preventDefault(),T.stopPropagation(),H.current&&(clearTimeout(H.current),H.current=null),he(N.taskId,180)},className:`flex items-center justify-center w-6 h-6 ${r.hover} rounded`,title:"3小时",children:e.jsxs("div",{className:"flex space-x-0.5",children:[e.jsx("div",{className:`w-1.5 h-1.5 ${r.bg} rounded-full`}),e.jsx("div",{className:`w-1.5 h-1.5 ${r.bg} rounded-full`}),e.jsx("div",{className:`w-1.5 h-1.5 ${r.bg} rounded-full`})]})}),re(N.taskId)>0&&e.jsx("button",{onClick:T=>{T.preventDefault(),T.stopPropagation(),H.current&&(clearTimeout(H.current),H.current=null),mt(N.taskId)},className:"flex items-center justify-center w-6 h-6 hover:bg-red-50 rounded border border-red-200",title:"清空时间记录",children:e.jsx("svg",{className:"w-3 h-3 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),re(N.taskId)>0&&e.jsx("div",{className:"mt-1 pt-1 border-t border-gray-200 text-xs text-gray-500 text-center",children:gt(re(N.taskId))})]})})(),A&&(()=>{const b=typeof window<"u"?window.innerWidth:1920,S=typeof window<"u"?window.innerHeight:1080,k=b-120,I=S-60,$=Math.min(A.x,k),T=Math.min(A.y,I);return e.jsx("div",{className:"fixed bg-white border border-gray-200 rounded shadow-lg p-2 z-50",style:{left:`${$}px`,top:`${T}px`},onClick:p=>p.stopPropagation(),children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>xt(A.dayKey,A.slotId,A.taskIndex),className:"flex items-center space-x-1 px-2 py-1 text-xs bg-blue-50 text-blue-600 rounded hover:bg-blue-100 transition-colors",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),e.jsx("span",{children:"复制"})]}),e.jsxs("button",{onClick:()=>{at(A.dayKey,A.slotId,A.taskIndex),Z(null)},className:"flex items-center space-x-1 px-2 py-1 text-xs bg-red-50 text-red-600 rounded hover:bg-red-100 transition-colors",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),e.jsx("span",{children:"删除"})]})]})})})(),(()=>{const{plannedColorStats:r,actualColorStats:i}=ht(),b=new Set([...Object.keys(r),...Object.keys(i)]),S=Object.values(r).reduce(($,T)=>$+T,0),k=Object.values(i).reduce(($,T)=>$+T,0),I=S+k;return e.jsxs("div",{className:"mt-4 bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"本周时间分配"}),e.jsxs("div",{className:"text-xs text-gray-500 cursor-pointer hover:text-blue-600 hover:underline",onClick:()=>le(!0),title:"点击修改总工作时间",children:["计划: ",S.toFixed(1),"h | 完成: ",k.toFixed(1),"h | 总计: ",U,"h (",(I/U*100).toFixed(1),"%)"]})]}),e.jsxs("div",{className:"flex h-6 bg-gray-100 rounded overflow-hidden",children:[Array.from(b).map($=>{const T=r[$]||0,p=i[$]||0,J=T+p,L=J/U*100,M=p/U*100,K=T/U*100,ae=pe($||"gray"),fe={red:"Meeting",orange:"Think",pink:"Interview",green:"Run",purple:"Coach",blue:"English",yellow:"XinLi",indigo:"Book",tencent:"Free"};return e.jsxs("div",{className:"relative flex items-center justify-center text-white text-xs font-medium cursor-pointer hover:opacity-80 transition-opacity",style:{width:`${L}%`},title:`${fe[$]}: 计划${T.toFixed(1)}h + 完成${p.toFixed(1)}h = ${J.toFixed(1)}h (${L.toFixed(1)}%)`,onMouseEnter:()=>O($),onMouseLeave:()=>O(null),children:[p>0&&e.jsx("div",{className:`absolute left-0 top-0 h-full ${ae.bg}`,style:{width:`${M/L*100}%`}}),T>0&&e.jsx("div",{className:`absolute right-0 top-0 h-full ${ae.bg} opacity-40`,style:{width:`${K/L*100}%`}}),e.jsx("span",{className:"relative z-10",children:L>=5?`${J.toFixed(1)}h`:""})]},$)}),I<U&&e.jsx("div",{className:"bg-gray-200 flex items-center justify-center text-gray-500 text-xs",style:{width:`${(U-I)/U*100}%`},title:`剩余: ${(U-I).toFixed(1)}小时 (${((U-I)/U*100).toFixed(1)}%)`,children:(U-I)/U>=.05?`${(U-I).toFixed(1)}h`:""})]}),e.jsx("div",{className:"flex flex-wrap gap-3 mt-3 text-xs",children:Array.from(b).map($=>{const T=r[$]||0,p=i[$]||0,L=(T+p)/U*100,M=pe($),K=$?M.text.replace("bg-","text-"):"text-gray-600",ae={red:"Meeting",orange:"Think",pink:"Interview",green:"Run",purple:"Coach",blue:"English",yellow:"XinLi",indigo:"Book",tencent:"Free"};return e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-3 h-3 ${M.bg} rounded`}),T>0&&e.jsx("div",{className:`w-3 h-3 ${M.bg} opacity-40 rounded ml-0.5`})]}),e.jsxs("span",{className:"text-gray-600",children:[ae[$],":",p>0&&e.jsxs("span",{className:"font-medium",children:[" 完成",p.toFixed(1),"h"]}),T>0&&e.jsxs("span",{className:"text-gray-500",children:[" 计划",T.toFixed(1),"h"]}),e.jsxs("span",{className:`font-bold ${K}`,children:[" (",L.toFixed(1),"%)"]})]})]},$)})})]})})(),g&&e.jsxs("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-blue-500 text-white px-4 py-2 rounded-lg text-sm z-50 shadow-lg flex items-center space-x-2",children:[e.jsx("span",{children:"🚀"}),e.jsxs("span",{children:["正在移动任务: ",g.task.text||g.task.time||"未命名任务"]}),e.jsx("span",{className:"text-blue-200 text-xs",children:"拖拽到目标时间段"})]}),e.jsx(Ts,{isOpen:oe,onClose:()=>le(!1),totalTime:U,onSave:R})]})},$s=({currentView:l,onViewChange:t})=>{const{data:a,saveData:s}=tt(),[n,o]=c.useState(new Date),m=new Date,[h,f]=c.useState([m.getMonth()]),[v,y]=c.useState({});c.useEffect(()=>{a&&a.importantTasks&&y(a.importantTasks)},[a]);const E=N=>{N.importantTasks&&(y(N.importantTasks),s({...a,importantTasks:N.importantTasks}))},G=N=>{const P=new Date(N,0,1),z=new Date(N,11,31),V=[];let A=Ie(P,{weekStartsOn:1});for(;A<=z;)V.push(new Date(A)),A=Qe(A,1);return V},w=N=>{const P=G(N),z=[];for(let V=0;V<12;V++){const A=new Date(N,V,1),Z=Wt(A),ee=P.filter(Q=>Ce(Q,6)>=A&&Q<=Z);z.push({month:V,monthName:F(A,"MMMM",{locale:xe}),weeks:ee})}return z},x=N=>{const P=F(N,"yyyy-MM-dd");return v[P]||[{id:"important-1",text:""},{id:"important-2",text:""},{id:"important-3",text:""}]},C=N=>{f(P=>P.includes(N)?P.filter(z=>z!==N):[...P,N])},g=()=>{const N=w(n.getFullYear());f(N.map((P,z)=>z))},d=()=>{f([])},j=w(n.getFullYear()),_=new Date().getMonth();return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"人生系统设计"}),e.jsxs("p",{className:"text-gray-500 text-sm",children:[n.getFullYear(),"年全年视图"]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx($e,{currentView:l,onViewChange:t}),e.jsx(Me,{onImport:E})]})]}),e.jsxs("div",{className:"p-4 bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>o(N=>new Date(N.getFullYear()-1,0,1)),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(Mt,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:[n.getFullYear(),"年"]}),e.jsx("button",{onClick:()=>o(N=>new Date(N.getFullYear()+1,0,1)),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(Pe,{className:"w-5 h-5 text-gray-600"})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:g,className:"px-3 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:"展开所有"}),e.jsx("button",{onClick:d,className:"px-3 py-1 text-sm bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition-colors",children:"收起所有"})]})]}),e.jsx("div",{className:"space-y-4",children:j.map((N,P)=>{const z=h.includes(P),V=P===_;return e.jsxs("div",{className:`border rounded-lg overflow-hidden ${V?"border-blue-300 bg-blue-50":"border-gray-200"}`,children:[e.jsxs("div",{className:`flex items-center justify-between p-3 cursor-pointer ${V?"bg-blue-100":"bg-gray-50"} hover:bg-opacity-80 transition-colors`,onClick:()=>C(P),children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ye,{className:`w-5 h-5 ${V?"text-blue-600":"text-gray-600"}`}),e.jsx("h2",{className:`text-lg font-semibold ${V?"text-blue-900":"text-gray-900"}`,children:N.monthName}),e.jsxs("span",{className:`text-sm px-2 py-1 rounded ${V?"bg-blue-200 text-blue-800":"bg-gray-200 text-gray-700"}`,children:[N.weeks.length,"周"]})]}),e.jsx("div",{className:`transform transition-transform ${z?"rotate-90":""}`,children:e.jsx(Pe,{className:"w-5 h-5 text-gray-600"})})]}),z&&e.jsx("div",{className:"p-4 bg-white",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 2xl:grid-cols-6 gap-4",children:N.weeks.map((A,Z)=>{const ee=F(A,"yyyy-MM-dd"),Q=x(A),oe=Ot(A),le=Et(A,new Date,{weekStartsOn:1});return e.jsxs("div",{className:`border rounded-lg p-3 ${le?"border-blue-300 bg-blue-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["第",oe,"周"]}),e.jsx("span",{className:"text-xs text-gray-500",children:F(A,"MM/dd")})]}),e.jsx("div",{className:"space-y-1",children:Q.map((U,u)=>e.jsxs("div",{className:"flex items-start space-x-1",children:[e.jsxs("div",{className:`text-xs font-bold ${u===0?"text-yellow-600":u===1?"text-gray-500":"text-orange-600"}`,children:["TOP",u+1]}),e.jsx("div",{className:"flex-1 text-xs text-gray-700 truncate",children:U.text||e.jsx("span",{className:"text-gray-400 italic",children:"未填写"})})]},U.id))})]},ee)})})})]},P)})})]})]})},Ms=({currentView:l,onViewChange:t})=>{const[a,s]=c.useState("overview"),n=h=>{console.log("数据已导入:",h)},o=[{id:"overview",name:"总览",icon:Re},{id:"goals",name:"目标管理",icon:Ge},{id:"schedule",name:"日程设置",icon:ye},{id:"profile",name:"个人资料",icon:_t},{id:"notifications",name:"通知设置",icon:Lt},{id:"settings",name:"系统设置",icon:qe}],m=()=>{var h;switch(a){case"overview":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-blue-50 p-6 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-600 text-sm font-medium",children:"本周完成任务"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:"12/18"})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(ye,{className:"w-6 h-6 text-white"})})]})}),e.jsx("div",{className:"bg-green-50 p-6 rounded-lg border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-600 text-sm font-medium",children:"年度目标进度"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:"3/5"})]}),e.jsx("div",{className:"w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center",children:e.jsx(Ge,{className:"w-6 h-6 text-white"})})]})}),e.jsx("div",{className:"bg-purple-50 p-6 rounded-lg border border-purple-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-600 text-sm font-medium",children:"系统使用天数"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:"45天"})]}),e.jsx("div",{className:"w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center",children:e.jsx(Re,{className:"w-6 h-6 text-white"})})]})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"最近活动"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-700",children:'完成了"团队会议"任务'}),e.jsx("span",{className:"text-xs text-gray-500 ml-auto",children:"2小时前"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-700",children:"更新了年度健康目标"}),e.jsx("span",{className:"text-xs text-gray-500 ml-auto",children:"1天前"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-700",children:"创建了新的周计划"}),e.jsx("span",{className:"text-xs text-gray-500 ml-auto",children:"3天前"})]})]})]})]});case"goals":return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"目标类别管理"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"事业发展权重"}),e.jsx("input",{type:"range",min:"0",max:"100",defaultValue:"30",className:"w-full"}),e.jsx("span",{className:"text-sm text-gray-500",children:"30%"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"健康管理权重"}),e.jsx("input",{type:"range",min:"0",max:"100",defaultValue:"25",className:"w-full"}),e.jsx("span",{className:"text-sm text-gray-500",children:"25%"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"人际关系权重"}),e.jsx("input",{type:"range",min:"0",max:"100",defaultValue:"20",className:"w-full"}),e.jsx("span",{className:"text-sm text-gray-500",children:"20%"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"学习成长权重"}),e.jsx("input",{type:"range",min:"0",max:"100",defaultValue:"25",className:"w-full"}),e.jsx("span",{className:"text-sm text-gray-500",children:"25%"})]})]})]})});case"schedule":return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"时间段设置"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-yellow-50 rounded-lg border border-yellow-200",children:[e.jsx("span",{className:"font-medium",children:"早上时段"}),e.jsx("input",{type:"text",defaultValue:"06:00-12:00",className:"px-3 py-1 border border-gray-300 rounded text-sm"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-orange-50 rounded-lg border border-orange-200",children:[e.jsx("span",{className:"font-medium",children:"中午时段"}),e.jsx("input",{type:"text",defaultValue:"12:00-14:00",className:"px-3 py-1 border border-gray-300 rounded text-sm"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("span",{className:"font-medium",children:"下午时段"}),e.jsx("input",{type:"text",defaultValue:"14:00-18:00",className:"px-3 py-1 border border-gray-300 rounded text-sm"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsx("span",{className:"font-medium",children:"晚上时段"}),e.jsx("input",{type:"text",defaultValue:"18:00-24:00",className:"px-3 py-1 border border-gray-300 rounded text-sm"})]})]})]})});default:return e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:(h=o.find(f=>f.id===a))==null?void 0:h.name}),e.jsx("p",{className:"text-gray-600",children:"此功能正在开发中..."})]})}};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"人生系统设计"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"系统管理与配置中心"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx($e,{currentView:l,onViewChange:t}),e.jsx(Me,{onImport:n})]})]}),e.jsx("div",{className:"flex space-x-1 bg-gray-100 rounded-lg p-1",children:o.map(h=>{const f=h.icon;return e.jsxs("button",{onClick:()=>s(h.id),className:`flex items-center space-x-2 px-3 py-2 text-sm font-medium rounded-md transition-colors ${a===h.id?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(f,{className:"w-4 h-4"}),e.jsx("span",{children:h.name})]},h.id)})}),e.jsx("div",{className:"min-h-96",children:m()})]})},Os=({onClose:l,onAddTask:t,selectedDate:a})=>{const[s,n]=c.useState({title:"",description:"",date:a?F(a,"yyyy-MM-dd"):F(new Date,"yyyy-MM-dd"),time:"",priority:"medium",category:"work"}),[o,m]=c.useState({}),h=v=>{v.preventDefault();const y={};if(s.title.trim()||(y.title="请输入任务标题"),s.date||(y.date="请选择日期"),Object.keys(y).length>0){m(y);return}const E={...s,date:new Date(s.date),title:s.title.trim(),description:s.description.trim()};t(E),l()},f=(v,y)=>{n(E=>({...E,[v]:y})),o[v]&&m(E=>({...E,[v]:""}))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"添加新任务"}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(me,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:h,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"任务标题 *"}),e.jsx("input",{type:"text",value:s.title,onChange:v=>f("title",v.target.value),className:`input ${o.title?"border-red-500 focus:ring-red-500":""}`,placeholder:"输入任务标题..."}),o.title&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"任务描述"}),e.jsx("textarea",{value:s.description,onChange:v=>f("description",v.target.value),rows:3,className:"input resize-none",placeholder:"输入任务描述..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ye,{className:"w-4 h-4 inline mr-1"}),"日期 *"]}),e.jsx("input",{type:"date",value:s.date,onChange:v=>f("date",v.target.value),className:`input ${o.date?"border-red-500 focus:ring-red-500":""}`}),o.date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.date})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Pt,{className:"w-4 h-4 inline mr-1"}),"时间"]}),e.jsx("input",{type:"time",value:s.time,onChange:v=>f("time",v.target.value),className:"input"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Rt,{className:"w-4 h-4 inline mr-1"}),"优先级"]}),e.jsxs("select",{value:s.priority,onChange:v=>f("priority",v.target.value),className:"input",children:[e.jsx("option",{value:"low",children:"低优先级"}),e.jsx("option",{value:"medium",children:"中优先级"}),e.jsx("option",{value:"high",children:"高优先级"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Gt,{className:"w-4 h-4 inline mr-1"}),"分类"]}),e.jsxs("select",{value:s.category,onChange:v=>f("category",v.target.value),className:"input",children:[e.jsx("option",{value:"work",children:"工作"}),e.jsx("option",{value:"personal",children:"个人"}),e.jsx("option",{value:"health",children:"健康"}),e.jsx("option",{value:"study",children:"学习"})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:l,className:"btn-secondary",children:"取消"}),e.jsx("button",{type:"submit",className:"btn-primary",children:"添加任务"})]})]})]})})},Es=({className:l=""})=>{const{isOnline:t,syncStatus:a,lastSync:s,manualSync:n}=et(),[o,m]=c.useState(!1),h=()=>{const g=localStorage.getItem("github_username"),d=localStorage.getItem("user_id");return{username:g,userId:d}},{username:f}=h(),v=()=>{switch(a){case"syncing":return e.jsx(Xe,{className:"animate-spin",size:16});case"success":return e.jsx(Te,{size:16});case"error":return e.jsx(be,{size:16});default:return t?e.jsx(Ae,{size:16}):e.jsx(He,{size:16})}},y=()=>{if(!t)return"离线";switch(a){case"syncing":return"同步中...";case"success":return"已同步";case"error":return"同步失败";default:return"等待同步"}},E=()=>{if(!t)return"text-gray-500";switch(a){case"syncing":return"text-blue-500";case"success":return"text-green-500";case"error":return"text-red-500";default:return"text-gray-500"}},G=()=>{if(!s)return"从未同步";const d=new Date-new Date(s),j=Math.floor(d/6e4);if(j<1)return"刚刚";if(j<60)return`${j}分钟前`;const _=Math.floor(j/60);return _<24?`${_}小时前`:`${Math.floor(_/24)}天前`},w=async()=>{if(a!=="syncing")try{await n(),setTimeout(()=>m(!1),2e3)}catch(g){console.error("手动同步失败:",g)}},x=()=>{confirm("确定要清除所有同步配置吗？这将删除云端同步令牌和相关数据，需要重新设置。")&&(localStorage.removeItem("github_token"),localStorage.removeItem("jsonbin_api_key"),localStorage.removeItem("gist_id"),localStorage.removeItem("bin_id"),localStorage.removeItem("sync_provider"),localStorage.removeItem("cloud_sync_enabled"),localStorage.removeItem("github_username"),localStorage.removeItem("github_user_id"),localStorage.removeItem("user_id"),localStorage.setItem("sync_status","pending"),window.location.reload())},C=()=>{m(!1),window.dispatchEvent(new CustomEvent("show-cloud-setup"))};return e.jsxs("div",{className:`relative ${l}`,children:[e.jsxs("button",{className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${E()} bg-gray-100 dark:bg-gray-800`,onClick:()=>m(!o),children:[v(),e.jsx("span",{children:y()})]}),o&&e.jsx("div",{className:"absolute right-0 mt-2 w-64 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 p-4 z-10",children:e.jsxs("div",{className:"space-y-3",children:[f&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"GitHub用户:"}),e.jsx("div",{className:"flex items-center gap-1 text-blue-600 dark:text-blue-400",children:e.jsx("span",{className:"text-sm",children:f})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"网络状态:"}),e.jsxs("div",{className:`flex items-center gap-1 ${t?"text-green-500":"text-red-500"}`,children:[t?e.jsx(Ae,{size:14}):e.jsx(He,{size:14}),e.jsx("span",{className:"text-sm",children:t?"在线":"离线"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"同步状态:"}),e.jsxs("div",{className:`flex items-center gap-1 ${E()}`,children:[v(),e.jsx("span",{className:"text-sm",children:y()})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"上次同步:"}),e.jsx("span",{className:"text-sm text-gray-500",children:G()})]}),t&&e.jsx("button",{onClick:w,disabled:a==="syncing",className:"w-full py-2 px-4 bg-blue-500 text-white rounded-lg font-medium text-sm hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:a==="syncing"?"同步中...":"立即同步"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:C,className:"py-2 px-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg font-medium text-sm hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors flex items-center justify-center gap-1",children:[e.jsx(qe,{size:14}),e.jsx("span",{children:"设置"})]}),e.jsxs("button",{onClick:x,className:"py-2 px-3 bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-400 rounded-lg font-medium text-sm hover:bg-red-200 dark:hover:bg-red-900/30 transition-colors flex items-center justify-center gap-1",children:[e.jsx(At,{size:14}),e.jsx("span",{children:"清除"})]})]}),e.jsx("div",{className:"pt-2 border-t border-gray-200 dark:border-gray-700",children:e.jsx("p",{className:"text-xs text-gray-500",children:"数据会自动同步到云端，确保在不同设备上访问时保持一致。如遇到问题，可清除后重新设置。"})})]})})]})},Ws=({isOpen:l,onClose:t})=>{const[a,s]=c.useState(""),[n,o]=c.useState(!1),[m,h]=c.useState(!1),[f,v]=c.useState(""),[y,E]=c.useState("github"),[G,w]=c.useState(null);c.useEffect(()=>{const d=localStorage.getItem("github_token");localStorage.getItem("jsonbin_api_key")&&(localStorage.removeItem("jsonbin_api_key"),localStorage.removeItem("bin_id")),d&&(s(d),h(!0));const _=localStorage.getItem("sync_provider")||"github";E(_)},[]);const x=async()=>{if(!a.trim()){v("请输入访问令牌");return}o(!0),v("");try{if(y==="github"){const d=await fetch("https://api.github.com/user",{headers:{Authorization:`token ${a}`,"Content-Type":"application/json"}});if(!d.ok)throw new Error("访问令牌无效");const j=await d.json();console.log("GitHub用户验证成功:",j),w(j),localStorage.removeItem("bin_id"),localStorage.removeItem("jsonbin_api_key"),localStorage.removeItem("gist_id"),localStorage.removeItem("user_id"),localStorage.setItem("github_token",a),localStorage.setItem("sync_provider","github"),localStorage.setItem("github_username",j.login),localStorage.setItem("github_user_id",j.id.toString()),v(""),h(!0),W.userId=`github_user_${j.id}`,W.githubUsername=j.login;try{await W.syncData(),console.log("初始同步成功")}catch(_){console.warn("初始同步失败:",_),v("验证成功，但初始同步失败，请稍后手动同步")}}}catch(d){v(d.message||"验证访问令牌时出错")}finally{o(!1)}},C=()=>{localStorage.setItem("cloud_sync_enabled","false"),localStorage.setItem("sync_provider","none"),t()},g=d=>{E(d),v(""),h(!1)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-md mx-4 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{size:24,className:"text-blue-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"数据同步设置"})]}),e.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:e.jsx(me,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-100 dark:bg-blue-900/30 rounded-full",children:e.jsx(Fe,{size:32,className:"text-blue-600 dark:text-blue-400"})}),e.jsx("h3",{className:"text-lg font-medium",children:"启用云端同步"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"选择同步服务，在不同设备间同步数据"}),G&&e.jsx("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800",children:e.jsxs("p",{className:"text-sm text-green-800 dark:text-green-200",children:["已验证为 GitHub 用户: ",e.jsx("span",{className:"font-semibold",children:G.login})]})}),!G&&(localStorage.getItem("github_token")||localStorage.getItem("jsonbin_api_key"))&&e.jsx("div",{className:"p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800",children:e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:"检测到之前的同步配置，可能是由于数据格式问题导致同步失败。 请重新配置您的访问令牌以解决此问题。"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"选择同步服务"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>g("github"),className:`p-3 rounded-lg border ${y==="github"?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-700"}`,children:[e.jsx(Ht,{size:20,className:"mx-auto mb-1"}),e.jsx("div",{className:"text-xs",children:"GitHub Gist"}),e.jsx("div",{className:"text-xs text-gray-500",children:"推荐"})]}),e.jsxs("button",{onClick:()=>g("jsonbin"),className:`p-3 rounded-lg border ${y==="jsonbin"?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-700"}`,children:[e.jsx("div",{className:"w-5 h-5 mx-auto mb-1 bg-purple-500 rounded"}),e.jsx("div",{className:"text-xs",children:"JSONBin.io"}),e.jsx("div",{className:"text-xs text-gray-500",children:"可能不稳定"})]})]})]}),y==="github"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(be,{size:18,className:"text-blue-600 dark:text-blue-400 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-blue-900 dark:text-blue-100",children:"如何获取GitHub访问令牌:"}),e.jsxs("ol",{className:"mt-1 space-y-1 text-blue-800 dark:text-blue-200 list-decimal list-inside",children:[e.jsxs("li",{children:["访问 ",e.jsx("a",{href:"https://github.com/settings/tokens",target:"_blank",rel:"noopener noreferrer",className:"underline",children:"GitHub令牌设置"})]}),e.jsx("li",{children:'点击"Generate new token (classic)"'}),e.jsx("li",{children:"输入令牌名称（如：生活管理系统）"}),e.jsx("li",{children:"选择过期时间（建议：90天）"}),e.jsx("li",{children:'勾选"gist"权限'}),e.jsx("li",{children:"生成并复制令牌"})]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"api-token",className:"block text-sm font-medium",children:"GitHub 访问令牌"}),e.jsx("input",{id:"api-token",type:"password",value:a,onChange:d=>s(d.target.value),placeholder:"输入你的访问令牌",className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:outline-none ${f?"border-red-500 focus:ring-red-500":m?"border-green-500 focus:ring-green-500":"border-gray-300 focus:ring-blue-500 dark:border-gray-700 dark:focus:ring-blue-500"} bg-white dark:bg-gray-800`}),f&&e.jsxs("p",{className:"text-sm text-red-600 dark:text-red-400 flex items-center gap-1",children:[e.jsx(be,{size:14}),f]}),m&&e.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400 flex items-center gap-1",children:[e.jsx(Ye,{size:14}),"访问令牌已验证"]})]})]}),y==="jsonbin"&&e.jsx("div",{className:"space-y-3",children:e.jsx("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(be,{size:18,className:"text-yellow-600 dark:text-yellow-400 mt-0.5"}),e.jsx("div",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:"JSONBin.io免费版可能不稳定，建议使用GitHub Gist"})]})})}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:C,className:"flex-1 py-2 px-4 border border-gray-300 dark:border-gray-700 rounded-lg font-medium hover:bg-gray-50 dark:hover:bg-gray-700",children:"跳过（离线模式）"}),e.jsx("button",{onClick:x,disabled:n,className:"flex-1 py-2 px-4 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:n?"验证中...":"保存令牌"})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center pt-2 border-t border-gray-200 dark:border-gray-700",children:"数据将安全地存储在云端，你可以随时在设置中更改"})]})]})})};function _s(){const[l,t]=c.useState([]),[a,s]=c.useState(!1),[n,o]=c.useState(new Date),[m,h]=c.useState("week"),[f,v]=c.useState(!1);c.useEffect(()=>{const w=localStorage.getItem("github_token"),x=localStorage.getItem("jsonbin_api_key"),C=localStorage.getItem("cloud_sync_enabled")==="false";!w&&!x&&!C?(console.log("未设置API密钥，显示设置界面"),v(!0)):(w||x)&&(console.log("已设置API密钥，获取用户信息并尝试自动同步"),W.getUserId().then(d=>{console.log("获取到用户ID:",d),setTimeout(()=>{try{W.syncData().then(j=>{console.log("启动时同步结果:",j)}).catch(j=>{console.warn("启动时同步失败:",j)})}catch(j){console.warn("同步服务不可用:",j)}},2e3)}).catch(d=>{console.error("获取用户信息失败:",d)}));const g=se.getAllData();if(console.log("加载本地数据:",g),!g.weeks||Object.keys(g.weeks).length===0){console.log("创建默认数据");const d=se.getAllData();se.saveData(d)}},[]),c.useEffect(()=>{const w=()=>{v(!0)};return window.addEventListener("show-cloud-setup",w),()=>{window.removeEventListener("show-cloud-setup",w)}},[]);const y=w=>{const x={...w,id:Date.now(),completed:!1};t(C=>[...C,x])},E=(w,x)=>{t(C=>C.map(g=>g.id===w?{...g,...x}:g))},G=()=>{switch(m){case"test":return e.jsx(Yt,{});case"week":return e.jsx(Je,{tasks:l,onAddTask:y,onUpdateTask:E,currentView:m,onViewChange:h});case"year":return e.jsx($s,{currentView:m,onViewChange:h});case"management":return e.jsx(Ms,{currentView:m,onViewChange:h});default:return e.jsx(Je,{tasks:l,onAddTask:y,onUpdateTask:E,currentView:m,onViewChange:h})}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200 px-4 py-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"生活管理系统"}),e.jsx(Es,{})]})}),e.jsx("main",{className:"p-3",children:e.jsx("div",{className:"w-full max-w-full mx-auto px-4",children:G()})}),a&&e.jsx(Os,{onClose:()=>s(!1),onAddTask:y,selectedDate:n})]}),f&&e.jsx(Ws,{isOpen:f,onClose:()=>v(!1)})]})}window.addEventListener("error",function(l){console.error("Global error:",l.error);const t=document.createElement("div");t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(255, 255, 255, 0.9)",t.style.zIndex="9999",t.style.display="flex",t.style.flexDirection="column",t.style.justifyContent="center",t.style.alignItems="center",t.style.padding="20px",t.style.fontSize="16px",t.style.color="#333",t.style.fontFamily="Arial, sans-serif",t.innerHTML=`
    <div style="max-width: 500px; text-align: center;">
      <h2 style="color: #e53e3e; margin-bottom: 16px;">应用遇到了问题</h2>
      <p>抱歉，应用启动时遇到了错误。请尝试刷新页面。</p>
      <button onclick="window.location.reload()" style="
        margin-top: 16px;
        padding: 8px 16px;
        background-color: #4299e1;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      ">刷新页面</button>
      <details style="margin-top: 16px; text-align: left;">
        <summary style="cursor: pointer; padding: 8px 0;">错误详情</summary>
        <pre style="background-color: #f7fafc; padding: 12px; border-radius: 4px; overflow: auto; font-size: 12px;">
          ${l.error?l.error.toString():"未知错误"}
        </pre>
      </details>
    </div>
  `,document.body.appendChild(t)});window.addEventListener("unhandledrejection",function(l){console.error("Unhandled promise rejection:",l.reason)});De.createRoot(document.getElementById("root")).render(e.jsx(bt.StrictMode,{children:e.jsx(_s,{})}));
