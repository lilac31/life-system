import{r as d,a as xt,R as gt}from"./react-wGySg1uH.js";import{r as ht,s as Me,b as je,a as de,c as ue,d as pt,D as Je,U as Ue,f as F,e as Oe,p as re,P as ft,X as me,C as Ve,g as bt,i as Ee,h as we,j as yt,F as vt,R as Be,k as Se,A as jt,l as Te,m as Ce,n as wt,o as Nt,q as fe,t as Pe,u as kt,v as St,w as Tt,x as Ye,y as Ct,z as We,B as be,E as It,G as Dt,H as $t,I as Re,T as Le,J as Mt,K as Ot,S as Et,L as Pt,M as Wt,N as Rt,W as Ae,O as Fe,Q as _e}from"./utils-BgFzi7pZ.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const p of i.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&a(p)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}})();var Xe={exports:{}},ye={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lt=d,At=Symbol.for("react.element"),Ft=Symbol.for("react.fragment"),_t=Object.prototype.hasOwnProperty,Ht=Lt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Gt={key:!0,ref:!0,__self:!0,__source:!0};function Qe(l,s,r){var a,n={},i=null,p=null;r!==void 0&&(i=""+r),s.key!==void 0&&(i=""+s.key),s.ref!==void 0&&(p=s.ref);for(a in s)_t.call(s,a)&&!Gt.hasOwnProperty(a)&&(n[a]=s[a]);if(l&&l.defaultProps)for(a in s=l.defaultProps,s)n[a]===void 0&&(n[a]=s[a]);return{$$typeof:At,type:l,key:i,ref:p,props:n,_owner:Ht.current}}ye.Fragment=Ft;ye.jsx=Qe;ye.jsxs=Qe;Xe.exports=ye;var e=Xe.exports,Ie={},He=xt;Ie.createRoot=He.createRoot,Ie.hydrateRoot=He.hydrateRoot;const zt=()=>e.jsxs("div",{className:"p-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"测试页面"}),e.jsx("p",{children:"如果您能看到这个页面，说明基本设置是正常的。"})]});function Jt(l,s,r){ht(2,arguments);var a=Me(l,r),n=Me(s,r);return a.getTime()===n.getTime()}var Ut={lessThanXSeconds:{one:"不到 1 秒",other:"不到 {{count}} 秒"},xSeconds:{one:"1 秒",other:"{{count}} 秒"},halfAMinute:"半分钟",lessThanXMinutes:{one:"不到 1 分钟",other:"不到 {{count}} 分钟"},xMinutes:{one:"1 分钟",other:"{{count}} 分钟"},xHours:{one:"1 小时",other:"{{count}} 小时"},aboutXHours:{one:"大约 1 小时",other:"大约 {{count}} 小时"},xDays:{one:"1 天",other:"{{count}} 天"},aboutXWeeks:{one:"大约 1 个星期",other:"大约 {{count}} 个星期"},xWeeks:{one:"1 个星期",other:"{{count}} 个星期"},aboutXMonths:{one:"大约 1 个月",other:"大约 {{count}} 个月"},xMonths:{one:"1 个月",other:"{{count}} 个月"},aboutXYears:{one:"大约 1 年",other:"大约 {{count}} 年"},xYears:{one:"1 年",other:"{{count}} 年"},overXYears:{one:"超过 1 年",other:"超过 {{count}} 年"},almostXYears:{one:"将近 1 年",other:"将近 {{count}} 年"}},Vt=function(s,r,a){var n,i=Ut[s];return typeof i=="string"?n=i:r===1?n=i.one:n=i.other.replace("{{count}}",String(r)),a!=null&&a.addSuffix?a.comparison&&a.comparison>0?n+"内":n+"前":n},Bt={full:"y'年'M'月'd'日' EEEE",long:"y'年'M'月'd'日'",medium:"yyyy-MM-dd",short:"yy-MM-dd"},Yt={full:"zzzz a h:mm:ss",long:"z a h:mm:ss",medium:"a h:mm:ss",short:"a h:mm"},Xt={full:"{{date}} {{time}}",long:"{{date}} {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},Qt={date:je({formats:Bt,defaultWidth:"full"}),time:je({formats:Yt,defaultWidth:"full"}),dateTime:je({formats:Xt,defaultWidth:"full"})};function Ge(l,s,r){var a="eeee p";return Jt(l,s,r)?a:l.getTime()>s.getTime()?"'下个'"+a:"'上个'"+a}var qt={lastWeek:Ge,yesterday:"'昨天' p",today:"'今天' p",tomorrow:"'明天' p",nextWeek:Ge,other:"PP p"},Kt=function(s,r,a,n){var i=qt[s];return typeof i=="function"?i(r,a,n):i},Zt={narrow:["前","公元"],abbreviated:["前","公元"],wide:["公元前","公元"]},es={narrow:["1","2","3","4"],abbreviated:["第一季","第二季","第三季","第四季"],wide:["第一季度","第二季度","第三季度","第四季度"]},ts={narrow:["一","二","三","四","五","六","七","八","九","十","十一","十二"],abbreviated:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],wide:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]},ss={narrow:["日","一","二","三","四","五","六"],short:["日","一","二","三","四","五","六"],abbreviated:["周日","周一","周二","周三","周四","周五","周六"],wide:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"]},as={narrow:{am:"上",pm:"下",midnight:"凌晨",noon:"午",morning:"早",afternoon:"下午",evening:"晚",night:"夜"},abbreviated:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"},wide:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"}},rs={narrow:{am:"上",pm:"下",midnight:"凌晨",noon:"午",morning:"早",afternoon:"下午",evening:"晚",night:"夜"},abbreviated:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"},wide:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"}},ns=function(s,r){var a=Number(s);switch(r==null?void 0:r.unit){case"date":return a.toString()+"日";case"hour":return a.toString()+"时";case"minute":return a.toString()+"分";case"second":return a.toString()+"秒";default:return"第 "+a.toString()}},os={ordinalNumber:ns,era:de({values:Zt,defaultWidth:"wide"}),quarter:de({values:es,defaultWidth:"wide",argumentCallback:function(s){return s-1}}),month:de({values:ts,defaultWidth:"wide"}),day:de({values:ss,defaultWidth:"wide"}),dayPeriod:de({values:as,defaultWidth:"wide",formattingValues:rs,defaultFormattingWidth:"wide"})},ls=/^(第\s*)?\d+(日|时|分|秒)?/i,is=/\d+/i,cs={narrow:/^(前)/i,abbreviated:/^(前)/i,wide:/^(公元前|公元)/i},ds={any:[/^(前)/i,/^(公元)/i]},us={narrow:/^[1234]/i,abbreviated:/^第[一二三四]刻/i,wide:/^第[一二三四]刻钟/i},ms={any:[/(1|一)/i,/(2|二)/i,/(3|三)/i,/(4|四)/i]},xs={narrow:/^(一|二|三|四|五|六|七|八|九|十[二一])/i,abbreviated:/^(一|二|三|四|五|六|七|八|九|十[二一]|\d|1[12])月/i,wide:/^(一|二|三|四|五|六|七|八|九|十[二一])月/i},gs={narrow:[/^一/i,/^二/i,/^三/i,/^四/i,/^五/i,/^六/i,/^七/i,/^八/i,/^九/i,/^十(?!(一|二))/i,/^十一/i,/^十二/i],any:[/^一|1/i,/^二|2/i,/^三|3/i,/^四|4/i,/^五|5/i,/^六|6/i,/^七|7/i,/^八|8/i,/^九|9/i,/^十(?!(一|二))|10/i,/^十一|11/i,/^十二|12/i]},hs={narrow:/^[一二三四五六日]/i,short:/^[一二三四五六日]/i,abbreviated:/^周[一二三四五六日]/i,wide:/^星期[一二三四五六日]/i},ps={any:[/日/i,/一/i,/二/i,/三/i,/四/i,/五/i,/六/i]},fs={any:/^(上午?|下午?|午夜|[中正]午|早上?|下午|晚上?|凌晨|)/i},bs={any:{am:/^上午?/i,pm:/^下午?/i,midnight:/^午夜/i,noon:/^[中正]午/i,morning:/^早上/i,afternoon:/^下午/i,evening:/^晚上?/i,night:/^凌晨/i}},ys={ordinalNumber:pt({matchPattern:ls,parsePattern:is,valueCallback:function(s){return parseInt(s,10)}}),era:ue({matchPatterns:cs,defaultMatchWidth:"wide",parsePatterns:ds,defaultParseWidth:"any"}),quarter:ue({matchPatterns:us,defaultMatchWidth:"wide",parsePatterns:ms,defaultParseWidth:"any",valueCallback:function(s){return s+1}}),month:ue({matchPatterns:xs,defaultMatchWidth:"wide",parsePatterns:gs,defaultParseWidth:"any"}),day:ue({matchPatterns:hs,defaultMatchWidth:"wide",parsePatterns:ps,defaultParseWidth:"any"}),dayPeriod:ue({matchPatterns:fs,defaultMatchWidth:"any",parsePatterns:bs,defaultParseWidth:"any"})},xe={code:"zh-CN",formatDistance:Vt,formatLong:Qt,formatRelative:Kt,localize:os,match:ys,options:{weekStartsOn:1,firstWeekContainsDate:4}};const vs=({value:l,color:s,completed:r=!1,onChange:a,onColorChange:n,className:i=""})=>{const[p,u]=d.useState(!1),b=d.useRef(null),c=d.useRef(null),h=[{name:"红色",value:"red",bg:"bg-red-500",text:"text-red-600",letter:"M"},{name:"橙色",value:"orange",bg:"bg-orange-500",text:"text-orange-600",letter:"T"},{name:"粉色",value:"pink",bg:"bg-pink-500",text:"text-pink-600",letter:"I"},{name:"绿色",value:"green",bg:"bg-green-500",text:"text-green-600",letter:"R"},{name:"紫色",value:"purple",bg:"bg-purple-500",text:"text-purple-600",letter:"C"},{name:"蓝色",value:"blue",bg:"bg-blue-500",text:"text-blue-600",letter:"E"},{name:"黄色",value:"yellow",bg:"bg-yellow-500",text:"text-yellow-600",letter:"X"},{name:"靛蓝色",value:"indigo",bg:"bg-indigo-500",text:"text-indigo-600",letter:"B"},{name:"腾讯蓝",value:"tencent",bg:"bg-[#0066FF]",text:"text-[#0066FF]",letter:"F"}],D=h.find(k=>k.value===s)||h[0],y=(()=>{const k=[];for(let O=0;O<24;O++)for(let L=0;L<60;L+=15){const T=`${O.toString().padStart(2,"0")}:${L.toString().padStart(2,"0")}`;k.push(T)}return k})();d.useEffect(()=>{const k=O=>{b.current&&!b.current.contains(O.target)&&c.current&&!c.current.contains(O.target)&&u(!1)};return document.addEventListener("mousedown",k),()=>document.removeEventListener("mousedown",k)},[]),d.useEffect(()=>{if(p&&b.current){const k=setTimeout(()=>{if(b.current){const O=b.current.querySelector('button[data-time="10:00"]');if(O)O.scrollIntoView({behavior:"instant",block:"center"});else{const L=y.findIndex(T=>T==="10:00");L!==-1&&(b.current.scrollTop=L*28-80)}}},50);return()=>clearTimeout(k)}},[p,y]);const x=k=>{a(k),setTimeout(()=>u(!1),100)},v=()=>{a(""),n(""),u(!1)},C=k=>{n(k)};return e.jsxs("div",{className:`relative ${i}`,children:[e.jsx("button",{ref:c,onClick:()=>u(!p),className:`w-12 h-6 text-left text-xs px-1 py-0.5 hover:bg-gray-100 focus:outline-none transition-colors ${l?s?r?`${D.text} font-medium opacity-70 line-through`:`${D.text} font-medium`:r?"text-gray-600 font-bold opacity-70 line-through":"text-gray-900 font-bold":r?"text-gray-500":"text-gray-400"}`,title:l?`${l}`:"点击选择时间",children:l||""}),p&&e.jsxs("div",{ref:b,className:"fixed bg-white border border-gray-200 rounded-md shadow-lg z-[9999] flex",style:{top:c.current?Math.min(c.current.getBoundingClientRect().bottom+4,window.innerHeight-280):"auto",left:c.current?Math.max(4,Math.min(c.current.getBoundingClientRect().left,window.innerWidth-100)):"auto"},children:[e.jsxs("div",{className:"w-20 p-2 border-r border-gray-200",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1.5 text-center",children:"颜色"}),e.jsx("div",{className:"flex flex-col gap-1.5 items-center",children:h.map(k=>e.jsx("button",{onClick:()=>C(k.value),className:`w-6 h-4 rounded-sm ${k.bg} hover:scale-105 transition-transform flex items-center justify-center text-white text-xs font-bold ${s===k.value?"ring-1 ring-gray-400 ring-offset-0":""}`,title:`${k.name} (${k.letter})`,children:e.jsx("span",{className:"text-[10px] font-bold",children:k.letter})},k.value))})]}),e.jsxs("div",{className:"w-20 max-h-56 overflow-y-auto",children:[e.jsx("button",{onClick:v,className:"w-full text-left px-2 py-1 text-xs text-gray-400 hover:bg-gray-50 border-b border-gray-100",children:"清除"}),y.map(k=>e.jsx("button",{"data-time":k,onClick:()=>x(k),className:`w-full text-left px-2 py-1 text-xs hover:bg-blue-50 transition-colors ${l===k?"bg-blue-50 text-blue-600":"text-gray-700"}`,children:k},k))]})]})]})},De=({currentView:l,onViewChange:s})=>{const r=[{id:"week",name:"周视图"},{id:"year",name:"年视图"},{id:"management",name:"管理界面"}];return e.jsx("nav",{className:"flex items-center space-x-1 bg-gray-100 rounded-lg p-1",children:r.map(a=>e.jsx("button",{onClick:()=>s(a.id),className:`px-3 py-1 text-sm font-medium rounded-md transition-colors ${l===a.id?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:a.name},a.id))})},js=({isOpen:l,onClose:s,totalTime:r,onSave:a})=>{const[n,i]=d.useState(0),[p,u]=d.useState("");d.useEffect(()=>{if(l){const h=Math.floor(r);i(h),u(h.toString())}},[l,r]);const b=()=>{const h=parseInt(p,10);!isNaN(h)&&h>0&&(a(h),s())},c=h=>{h.key==="Enter"?b():h.key==="Escape"&&s()};return l?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-80",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"修改每周工作时间"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"每周工作时间（小时）"}),e.jsx("input",{type:"number",value:p,onChange:h=>u(h.target.value),onKeyDown:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"1",max:"168",placeholder:"输入每周工作时间",autoFocus:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"取消"}),e.jsx("button",{onClick:b,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"保存"})]})]})}):null},$e=({onImport:l,className:s=""})=>{const r=d.useRef(null),a=()=>{const p=JSON.parse(localStorage.getItem("weeklyImportantTasks")||"{}"),u=JSON.parse(localStorage.getItem("quickTasks")||"{}"),b=JSON.parse(localStorage.getItem("taskTimeRecords")||"{}"),c=localStorage.getItem("totalWorkingHours")||"40",h={weeklyImportantTasks:p,quickTasks:u,taskTimeRecords:b,totalWorkingHours:parseInt(c,10),exportDate:new Date().toISOString(),version:"1.0"},D=JSON.stringify(h,null,2),E=new Blob([D],{type:"application/json"}),y=document.createElement("a");y.href=URL.createObjectURL(E),y.download=`life-system-data-${F(new Date,"yyyy-MM-dd-HHmm")}.json`,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(y.href)},n=p=>{const u=p.target.files[0];if(!u)return;const b=new FileReader;b.onload=c=>{try{const h=JSON.parse(c.target.result);if(!h.version){alert("无效的数据文件格式");return}h.weeklyImportantTasks&&localStorage.setItem("weeklyImportantTasks",JSON.stringify(h.weeklyImportantTasks)),h.quickTasks&&localStorage.setItem("quickTasks",JSON.stringify(h.quickTasks)),h.taskTimeRecords&&localStorage.setItem("taskTimeRecords",JSON.stringify(h.taskTimeRecords)),h.totalWorkingHours&&localStorage.setItem("totalWorkingHours",h.totalWorkingHours.toString()),l&&l(h),alert("数据导入成功！页面将刷新以加载新数据。"),window.location.reload()}catch(h){console.error("导入数据失败:",h),alert("导入数据失败，请检查文件格式是否正确")}},b.readAsText(u),p.target.value=""},i=()=>{var p;(p=r.current)==null||p.click()};return e.jsxs("div",{className:`flex items-center space-x-2 ${s}`,children:[e.jsxs("button",{onClick:a,className:"btn-secondary text-xs px-2 py-0.5 flex items-center space-x-1",title:"导出数据",children:[e.jsx(Je,{className:"w-3 h-3"}),e.jsx("span",{children:"导出"})]}),e.jsxs("button",{onClick:i,className:"btn-secondary text-xs px-2 py-0.5 flex items-center space-x-1",title:"导入数据",children:[e.jsx(Ue,{className:"w-3 h-3"}),e.jsx("span",{children:"导入"})]}),e.jsx("input",{ref:r,type:"file",accept:".json",onChange:n,className:"hidden"})]})},ws=()=>{const[l,s]=d.useState([]),[r,a]=d.useState(!1),[n,i]=d.useState({title:"",date:"",color:"red"}),[p,u]=d.useState(null),[b,c]=d.useState([]),[h,D]=d.useState(!1),[E,y]=d.useState(null),[x,v]=d.useState({title:"",date:"",color:"red"});new Date().getFullYear();const C=new Date(2025,9,1),k=new Date,O=Array.from({length:13},(m,$)=>{const P=Oe(C,$);return{date:P,name:F(P,"M月",{locale:xe}),fullName:F(P,"yyyy年M月",{locale:xe})}}),L=[{value:"red",name:"红色",class:"bg-red-500"},{value:"orange",name:"橙色",class:"bg-orange-500"},{value:"pink",name:"粉色",class:"bg-pink-500"},{value:"green",name:"绿色",class:"bg-green-500"},{value:"purple",name:"紫色",class:"bg-purple-500"},{value:"blue",name:"蓝色",class:"bg-blue-500"},{value:"yellow",name:"黄色",class:"bg-yellow-500"},{value:"indigo",name:"靛蓝色",class:"bg-indigo-500"}];d.useEffect(()=>{const m=localStorage.getItem("yearGoals");if(m)try{s(JSON.parse(m))}catch($){console.error("Failed to parse yearGoals:",$)}},[]);const T=m=>{s(m),localStorage.setItem("yearGoals",JSON.stringify(m))},_=()=>{if(!n.title||!n.date)return;const m=re(n.date);if(!Ee(m))return;m<k&&(D(!0),setTimeout(()=>D(!1),3e3));const P={id:Date.now().toString(),title:n.title,date:n.date,color:n.color},J=[...l,P].sort((q,X)=>new Date(q.date)-new Date(X.date));T(J),i({title:"",date:"",color:"red"}),a(!1)},B=(m,$)=>{$.stopPropagation(),T(l.filter(P=>P.id!==m))},Y=(m,$)=>{$.stopPropagation(),y(m.id),v({title:m.title,date:m.date,color:m.color})},V=()=>{if(!x.title||!x.date)return;const m=re(x.date);if(!Ee(m))return;const $=l.map(P=>P.id===E?{...P,title:x.title,date:x.date,color:x.color}:P).sort((P,J)=>new Date(P.date)-new Date(J.date));T($),y(null),v({title:"",date:"",color:"red"})},H=()=>{y(null),v({title:"",date:"",color:"red"})},K=m=>{const $=re(m),P=we($,C),J=we(Oe(C,13),C);return P/J*100},G=m=>{const $=re(m);return we($,k)},ae=m=>{const $=re(m);return yt($,k)},ce=()=>l.filter($=>G($.date)>0).sort(($,P)=>G($.date)-G(P.date))[0],oe=m=>{const $=m.currentTarget.getBoundingClientRect(),P=m.clientX-$.left,J=P/$.width*100,q=l.filter(X=>{const Q=K(X.date);return Math.abs(Q-J)<=3});q.length>0?(u({x:P,goals:q}),c(q)):(u(null),c([]))};return ce(),e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg p-4 border border-purple-200 mb-4",children:[r&&e.jsxs("div",{className:"bg-white rounded border border-gray-200 p-3 mb-3",children:[h&&e.jsx("div",{className:"mb-2 p-2 bg-yellow-50 border border-yellow-200 rounded text-xs text-yellow-800",children:"⚠️ 注意：您选择的是过去的日期，目标已添加但显示为已过期状态"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsx("input",{type:"text",placeholder:"目标名称",value:n.title,onChange:m=>i({...n,title:m.target.value}),className:"col-span-2 text-xs px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-purple-500"}),e.jsx("input",{type:"date",value:n.date,onChange:m=>i({...n,date:m.target.value}),min:"1900-01-01",max:"2099-12-31",className:"text-xs px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-purple-500"}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("select",{value:n.color,onChange:m=>i({...n,color:m.target.value}),className:"flex-1 text-xs px-1 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-purple-500",children:L.map(m=>e.jsx("option",{value:m.value,children:m.name},m.value))}),e.jsx("button",{onClick:_,className:"text-xs bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600",children:"✓"}),e.jsx("button",{onClick:()=>a(!1),className:"text-xs bg-gray-500 text-white px-2 py-1 rounded hover:bg-gray-600",children:"✕"})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex justify-between items-center mb-2",children:O.map((m,$)=>e.jsx("div",{className:"text-xs text-gray-600 text-center",children:m.name},$))}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative h-6 bg-gray-100 rounded-full mb-2 cursor-pointer flex-1",onMouseMove:oe,onMouseLeave:()=>{u(null),c([])},children:[e.jsx("div",{className:"absolute top-0 w-0.5 h-full bg-red-500 rounded-full z-10",style:{left:`${K(F(k,"yyyy-MM-dd"))}%`},title:`今天 ${F(k,"M月d日")}`}),l.map(m=>{var Q;const $=K(m.date),P=((Q=L.find(W=>W.value===m.color))==null?void 0:Q.class)||"bg-blue-500",J=G(m.date),q=J<0,X=b.some(W=>W.id===m.id);return e.jsx("div",{className:"absolute top-0 h-full flex items-center z-20",style:{left:`${$}%`},children:e.jsx("div",{className:`w-3 h-3 ${P} border-2 border-white cursor-pointer transition-all duration-200 ${q?"opacity-50":""} ${X?"scale-125 shadow-lg":"hover:scale-110"}`,title:`${m.title} - ${F(re(m.date),"M月d日")} ${q?"(已过期)":`(还有${J}天)`}`})},m.id)})]}),e.jsx("button",{onClick:()=>a(!r),className:"w-6 h-6 bg-purple-500 text-white rounded-full hover:bg-purple-600 transition-colors flex items-center justify-center flex-shrink-0 mb-2",title:"添加目标",children:e.jsx(ft,{className:"w-3 h-3"})})]}),p&&b.length>0&&e.jsxs("div",{className:"absolute z-30 bg-white border border-gray-300 rounded-lg shadow-lg p-3 min-w-64",style:{left:`${Math.min(Math.max(p.x-128,0),400)}px`,top:"-120px"},children:[e.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-full",children:e.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-300"})}),e.jsx("div",{className:"space-y-2",children:b.map((m,$)=>{var Q;const P=((Q=L.find(W=>W.value===m.color))==null?void 0:Q.class)||"bg-blue-500",J=G(m.date),q=ae(m.date),X=J<0;return e.jsxs("div",{className:"flex items-center justify-between group",children:[e.jsxs("div",{className:"flex items-center space-x-2 flex-1",children:[e.jsx("div",{className:`w-2 h-2 ${P} flex-shrink-0`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:m.title}),e.jsxs("div",{className:"text-xs text-gray-500",children:[F(re(m.date),"yyyy年M月d日"),!X&&e.jsxs("span",{className:"ml-2 text-purple-600 font-medium",children:["还有 ",J," 天 (",q," 周)"]}),X&&e.jsxs("span",{className:"ml-2 text-red-500",children:["已过期 ",Math.abs(J)," 天"]})]})]})]}),e.jsx("button",{onClick:W=>B(m.id,W),className:"opacity-0 group-hover:opacity-100 text-gray-400 hover:text-red-500 ml-2 transition-opacity",children:e.jsx(me,{className:"w-3 h-3"})})]},m.id)})})]}),l.length>0&&e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:l.sort((m,$)=>new Date(m.date)-new Date($.date)).map(m=>{var X,Q;const $=((X=L.find(W=>W.value===m.color))==null?void 0:X.class)||"bg-red-500",P=G(m.date),J=P<0;return E===m.id?e.jsxs("div",{className:"flex items-center space-x-2 bg-blue-50 border border-blue-200 rounded px-2 py-1",children:[e.jsx("div",{className:`w-3 h-3 ${((Q=L.find(W=>W.value===x.color))==null?void 0:Q.class)||"bg-red-500"} flex-shrink-0`}),e.jsx("input",{type:"text",value:x.title,onChange:W=>v({...x,title:W.target.value}),className:"text-xs px-1 py-0.5 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 w-20",placeholder:"目标名称"}),e.jsx("input",{type:"date",value:x.date,onChange:W=>v({...x,date:W.target.value}),min:"1900-01-01",max:"2099-12-31",className:"text-xs px-1 py-0.5 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"}),e.jsx("select",{value:x.color,onChange:W=>v({...x,color:W.target.value}),className:"text-xs px-1 py-0.5 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",children:L.map(W=>e.jsx("option",{value:W.value,children:W.name},W.value))}),e.jsx("button",{onClick:V,className:"text-green-600 hover:text-green-800 transition-colors",title:"保存",children:e.jsx(Ve,{className:"w-3 h-3"})}),e.jsx("button",{onClick:H,className:"text-gray-400 hover:text-red-500 transition-colors",title:"取消",children:e.jsx(me,{className:"w-3 h-3"})})]},m.id):e.jsxs("div",{className:`group flex items-center space-x-2 text-xs ${J?"opacity-50":""} hover:bg-gray-50 rounded px-2 py-1 transition-colors`,children:[e.jsx("div",{className:`w-3 h-3 ${$} flex-shrink-0`}),e.jsx("span",{className:"text-gray-700 font-medium",children:m.title}),e.jsx("span",{className:"text-gray-500",children:F(re(m.date),"M/d")}),!J&&e.jsxs("span",{className:"text-purple-600 font-medium",children:["(",P,"天)"]}),e.jsx("button",{onClick:W=>Y(m,W),className:"opacity-0 group-hover:opacity-100 text-gray-400 hover:text-blue-500 ml-1 transition-opacity",title:"编辑目标",children:e.jsx(bt,{className:"w-3 h-3"})}),e.jsx("button",{onClick:W=>B(m.id,W),className:"opacity-0 group-hover:opacity-100 text-gray-400 hover:text-red-500 ml-1 transition-opacity",title:"删除目标",children:e.jsx(me,{className:"w-3 h-3"})})]},m.id)})})})]})]})},Ns=({onRecover:l})=>{const[s,r]=d.useState("checking"),[a,n]=d.useState({}),[i,p]=d.useState(!1);d.useEffect(()=>{u()},[]);const u=()=>{r("checking");const y=localStorage.getItem("weeklyImportantTasks"),x=localStorage.getItem("quickTasks"),v=localStorage.getItem("taskTimeRecords"),C=localStorage.getItem("totalWorkingHours"),k=localStorage.getItem("yearGoals"),O={weeklyImportantTasks:y?JSON.parse(y):null,quickTasks:x?JSON.parse(x):null,taskTimeRecords:v?JSON.parse(v):null,totalWorkingHours:C?parseInt(C):null,yearGoals:k?JSON.parse(k):null};n(O);const L=O.weeklyImportantTasks&&Object.keys(O.weeklyImportantTasks).length>0,T=O.quickTasks&&Object.keys(O.quickTasks).length>0,_=O.taskTimeRecords&&Object.keys(O.taskTimeRecords).length>0,B=O.yearGoals&&O.yearGoals.length>0;r(L||T||_||B?"found":"empty")},b=()=>{let y=[];if(a.weeklyImportantTasks){const x=Object.keys(a.weeklyImportantTasks).length;x>0&&y.push(`${x}周的重要任务`)}if(a.quickTasks){const x=Object.keys(a.quickTasks).length;let v=0;Object.values(a.quickTasks).forEach(C=>{Object.values(C).forEach(k=>{v+=k.filter(O=>O.text||O.time).length})}),v>0&&y.push(`${x}天共${v}个任务`)}if(a.taskTimeRecords){const x=Object.keys(a.taskTimeRecords).length;x>0&&y.push(`${x}个时间记录`)}return a.yearGoals&&a.yearGoals.length>0&&y.push(`${a.yearGoals.length}个年度目标`),y},c=()=>{try{l&&l(a),alert("数据恢复成功！"),window.location.reload()}catch(y){console.error("恢复数据失败:",y),alert("恢复数据失败，请重试。")}},h=()=>{confirm("确定要清空所有数据重新开始吗？此操作不可恢复！")&&(localStorage.clear(),window.location.reload())},D=()=>{const y={...a,exportDate:new Date().toISOString(),version:"1.0"},x=JSON.stringify(y,null,2),v=new Blob([x],{type:"application/json"}),C=document.createElement("a");C.href=URL.createObjectURL(v),C.download=`backup-data-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(C.href)},E=()=>{const y=document.createElement("input");y.type="file",y.accept=".json",y.onchange=x=>{const v=x.target.files[0];if(v){const C=new FileReader;C.onload=k=>{try{const O=JSON.parse(k.target.result);l&&l(O),alert("数据导入成功！"),window.location.reload()}catch{alert("文件格式错误，请选择正确的备份文件")}},C.readAsText(v)}},y.click()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(vt,{className:"w-5 h-5 text-blue-500"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"数据管理中心"})]}),s==="checking"&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx(Be,{className:"w-8 h-8 animate-spin mx-auto mb-2 text-blue-500"}),e.jsx("p",{children:"正在扫描本地数据..."})]}),s==="found"&&e.jsxs("div",{children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Se,{className:"w-5 h-5 text-green-600"}),e.jsx("h4",{className:"font-medium text-green-800",children:"找到你的数据了！"})]}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("p",{className:"mb-2",children:"在本地存储中发现以下数据："}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:b().map((y,x)=>e.jsx("li",{children:y},x))})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:c,className:"w-full bg-blue-500 text-white px-4 py-3 rounded-lg hover:bg-blue-600 transition-colors flex items-center justify-center space-x-2 font-medium",children:[e.jsx(Se,{className:"w-4 h-4"}),e.jsx("span",{children:"恢复我的数据"})]}),e.jsxs("button",{onClick:D,className:"w-full bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors flex items-center justify-center space-x-2",children:[e.jsx(Je,{className:"w-4 h-4"}),e.jsx("span",{children:"先备份数据到文件"})]}),e.jsxs("button",{onClick:()=>p(!i),className:"w-full bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors",children:[i?"隐藏":"查看","数据详情"]}),i&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-xs space-y-2",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"重要任务:"})," ",a.weeklyImportantTasks?Object.keys(a.weeklyImportantTasks).length+"周":"无"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"日常任务:"})," ",a.quickTasks?Object.keys(a.quickTasks).length+"天":"无"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"时间记录:"})," ",a.taskTimeRecords?Object.keys(a.taskTimeRecords).length+"条":"无"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"年度目标:"})," ",a.yearGoals?a.yearGoals.length+"个":"无"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"工作时间设置:"})," ",a.totalWorkingHours||40,"小时/周"]})]}),e.jsx("div",{className:"border-t pt-3",children:e.jsx("button",{onClick:h,className:"w-full bg-red-100 text-red-600 px-4 py-2 rounded-lg hover:bg-red-200 transition-colors text-sm",children:"清空所有数据重新开始"})})]})]}),s==="empty"&&e.jsxs("div",{children:[e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(jt,{className:"w-5 h-5 text-yellow-600"}),e.jsx("h4",{className:"font-medium text-yellow-800",children:"没有找到数据"})]}),e.jsx("p",{className:"text-sm text-yellow-700",children:"本地存储中没有发现任何数据。如果你之前有数据，可能是因为："}),e.jsxs("ul",{className:"list-disc list-inside text-sm text-yellow-700 mt-2 space-y-1",children:[e.jsx("li",{children:"浏览器缓存被清理"}),e.jsx("li",{children:"使用了隐私模式"}),e.jsx("li",{children:"更换了浏览器或设备"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("h5",{className:"font-medium text-blue-800 mb-2",children:"如果你有备份文件："}),e.jsx("p",{className:"text-sm text-blue-700 mb-2",children:'点击下面的"导入数据"按钮，选择之前导出的JSON文件'}),e.jsxs("button",{onClick:E,className:"w-full bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors flex items-center justify-center space-x-2",children:[e.jsx(Ue,{className:"w-4 h-4"}),e.jsx("span",{children:"导入备份数据"})]})]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"w-full bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors",children:"开始使用（创建新数据）"})]})]})]})})};let Ne="";const ke="https://api.jsonbin.io/v3",ne={SCHEDULE_DATA:"schedule_data",USER_ID:"user_id",SYNC_STATUS:"sync_status",LAST_SYNC:"last_sync"};class ks{constructor(){this.userId=this.getUserId(),this.binId=null}getUserId(){let s=localStorage.getItem(ne.USER_ID);return s||(s="user_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),localStorage.setItem(ne.USER_ID,s)),s}getLocalData(){const s=localStorage.getItem(ne.SCHEDULE_DATA);return s?JSON.parse(s):this.getDefaultData()}getDefaultData(){return{weeks:{},importantTasks:[],quickTasks:{},timeRecords:[],settings:{weekStart:1,timeTrackingEnabled:!0,theme:"light"}}}saveLocalData(s){localStorage.setItem(ne.SCHEDULE_DATA,JSON.stringify(s)),this.setSyncStatus("pending")}setSyncStatus(s){localStorage.setItem(ne.SYNC_STATUS,s),localStorage.setItem(ne.LAST_SYNC,new Date().toISOString())}getSyncStatus(){return{status:localStorage.getItem(ne.SYNC_STATUS)||"pending",lastSync:localStorage.getItem(ne.LAST_SYNC)}}getApiKey(){if(Ne)return Ne;const s=localStorage.getItem("jsonbin_api_key");if(s)return Ne=s,s;throw new Error("No API key configured")}async uploadToCloud(s){try{const a={"Content-Type":"application/json","X-Master-Key":this.getApiKey()};let n;if(this.binId?n=await fetch(`${ke}/b/${this.binId}`,{method:"PUT",headers:a,body:JSON.stringify(s)}):n=await fetch(`${ke}/b`,{method:"POST",headers:a,body:JSON.stringify({data:s,userId:this.userId})}),!n.ok)throw new Error("Failed to upload data to cloud");const i=await n.json();return this.binId||(this.binId=i.id,localStorage.setItem("bin_id",i.id)),this.setSyncStatus("success"),i}catch(r){throw console.error("Cloud upload failed:",r),this.setSyncStatus("error"),r}}async downloadFromCloud(){try{const s=this.getApiKey(),r=localStorage.getItem("bin_id");if(!r)throw new Error("No cloud data found");const a=await fetch(`${ke}/b/${r}/latest`,{headers:{"X-Master-Key":s}});if(!a.ok)throw new Error("Failed to download data from cloud");const n=await a.json();if(n.record&&n.record.userId===this.userId)return this.setSyncStatus("success"),n.record.data;throw new Error("Data does not belong to current user")}catch(s){throw console.error("Cloud download failed:",s),this.setSyncStatus("error"),s}}mergeData(s,r){const a={...s};if(Object.keys(r.weeks||{}).forEach(n=>{if(!s.weeks[n])a.weeks[n]=r.weeks[n];else{const i=s.weeks[n],p=r.weeks[n];Object.keys(p.days||{}).forEach(u=>{i.days[u]||(i.days[u]=p.days[u])})}}),r.importantTasks&&r.importantTasks.length>0){const n=s.importantTasks.map(p=>p.id),i=r.importantTasks.filter(p=>!n.includes(p.id));a.importantTasks=[...s.importantTasks,...i]}return Object.keys(r.quickTasks||{}).forEach(n=>{s.quickTasks[n]||(a.quickTasks[n]=r.quickTasks[n])}),a}async syncData(){try{const s=this.getLocalData();try{const r=await this.downloadFromCloud(),a=this.mergeData(s,r);return this.saveLocalData(a),await this.uploadToCloud(a),{success:!0,data:a,source:"merged"}}catch(r){return console.warn("Cloud sync failed, uploading local data:",r),await this.uploadToCloud(s),{success:!0,data:s,source:"local"}}}catch(s){return console.error("Sync failed completely:",s),{success:!1,error:s.message}}}needsSync(){const{lastSync:s}=this.getSyncStatus();if(!s)return!0;const r=new Date(s).getTime(),a=new Date().getTime(),n=5*60*1e3;return a-r>n}}const z=new ks,qe=()=>{const[l,s]=d.useState(navigator.onLine),[r,a]=d.useState("pending"),[n,i]=d.useState(null);return d.useEffect(()=>{const u=()=>s(!0),b=()=>s(!1);return window.addEventListener("online",u),window.addEventListener("offline",b),()=>{window.removeEventListener("online",u),window.removeEventListener("offline",b)}},[]),d.useEffect(()=>{if(!l)return;const u=setInterval(async()=>{if(z.needsSync()){a("syncing");try{await z.syncData(),a("success"),i(new Date)}catch{a("error")}}},6e4);return()=>clearInterval(u)},[l]),{isOnline:l,syncStatus:r,lastSync:n,manualSync:async()=>{if(!l){alert("请检查网络连接");return}a("syncing");try{const u=await z.syncData();return a("success"),i(new Date),u}catch(u){throw a("error"),u}},needsSync:z.needsSync()}},se={getAllData:()=>z.getLocalData(),saveData:l=>{z.saveLocalData(l),navigator.onLine&&z.uploadToCloud(l).catch(s=>{console.warn("Background sync failed, will retry later")})},getWeekData:l=>z.getLocalData().weeks[l]||{days:{},weekNumber:parseInt(l.split("-")[1]),year:parseInt(l.split("-")[0])},saveWeekData:(l,s)=>{const r=z.getLocalData();r.weeks[l]=s,z.saveLocalData(r),navigator.onLine&&z.uploadToCloud(r).catch(a=>{console.warn("Background sync failed, will retry later")})},addImportantTask:l=>{const s=z.getLocalData();s.importantTasks||(s.importantTasks=[]),s.importantTasks.push(l),z.saveLocalData(s),navigator.onLine&&z.uploadToCloud(s).catch(r=>{console.warn("Background sync failed, will retry later")})},updateImportantTask:(l,s)=>{const r=z.getLocalData(),a=r.importantTasks.findIndex(n=>n.id===l);a!==-1&&(r.importantTasks[a]={...r.importantTasks[a],...s},z.saveLocalData(r),navigator.onLine&&z.uploadToCloud(r).catch(n=>{console.warn("Background sync failed, will retry later")}))},deleteImportantTask:l=>{const s=z.getLocalData();s.importantTasks=s.importantTasks.filter(r=>r.id!==l),z.saveLocalData(s),navigator.onLine&&z.uploadToCloud(s).catch(r=>{console.warn("Background sync failed, will retry later")})}},Ke=()=>{const[l,s]=d.useState(null),[r,a]=d.useState(!0),{isOnline:n,syncStatus:i,manualSync:p}=qe(),u=d.useCallback(()=>{try{const x=se.getAllData();s(x),a(!1)}catch(x){console.error("Failed to load schedule data:",x),a(!1)}},[]),b=d.useCallback(x=>{try{se.saveData(x),s(x)}catch(v){console.error("Failed to save schedule data:",v)}},[]),c=d.useCallback(x=>l?se.getWeekData(x):null,[l]),h=d.useCallback((x,v)=>{const C={...l};C.weeks[x]=v,b(C)},[l,b]),D=d.useCallback(x=>{se.addImportantTask(x),u()},[u]),E=d.useCallback((x,v)=>{se.updateImportantTask(x,v),u()},[u]),y=d.useCallback(x=>{se.deleteImportantTask(x),u()},[u]);return d.useEffect(()=>{u()},[u]),d.useEffect(()=>{const x=()=>{n&&i!=="success"&&p().then(()=>{u()})};return window.addEventListener("online",x),()=>window.removeEventListener("online",x)},[n,i,p,u]),{data:l,loading:r,isOnline:n,syncStatus:i,manualSync:p,loadData:u,saveData:b,getWeekData:c,saveWeekData:h,addImportantTask:D,updateImportantTask:E,deleteImportantTask:y}},ze=({tasks:l,onAddTask:s,onUpdateTask:r,currentView:a,onViewChange:n})=>{Ke();const[i,p]=d.useState(new Date),[u,b]=d.useState({}),[c,h]=d.useState({}),[D,E]=d.useState(null),[y,x]=d.useState(null),[v,C]=d.useState(null),[k,O]=d.useState({}),[L,T]=d.useState(null),[_,B]=d.useState(!1),[Y,V]=d.useState(!1),[H,K]=d.useState(40),[G,ae]=d.useState(null),[ce,oe]=d.useState(!1),m=()=>{const t=Te(i,{weekStartsOn:1});return F(t,"yyyy-MM-dd")},$=()=>{const t=m();return!u[t]||u[t].length===0?[{id:"important-1",text:""},{id:"important-2",text:""},{id:"important-3",text:""}]:u[t]},P=t=>{K(t),localStorage.setItem("totalWorkingHours",t.toString())},J=t=>{t.weeklyImportantTasks&&b(t.weeklyImportantTasks),t.quickTasks&&h(t.quickTasks),t.totalWorkingHours&&K(t.totalWorkingHours)},q=(t,o=!1)=>({red:o?"rgba(239, 68, 68, 0.1)":"rgba(239, 68, 68, 0.2)",orange:o?"rgba(249, 115, 22, 0.1)":"rgba(249, 115, 22, 0.2)",pink:o?"rgba(236, 72, 153, 0.1)":"rgba(236, 72, 153, 0.2)",green:o?"rgba(34, 197, 94, 0.1)":"rgba(34, 197, 94, 0.2)",purple:o?"rgba(168, 85, 247, 0.1)":"rgba(168, 85, 247, 0.2)",blue:o?"rgba(59, 130, 246, 0.1)":"rgba(59, 130, 246, 0.2)",yellow:o?"rgba(234, 179, 8, 0.1)":"rgba(234, 179, 8, 0.2)",indigo:o?"rgba(99, 102, 241, 0.1)":"rgba(99, 102, 241, 0.2)",tencent:o?"rgba(0, 102, 255, 0.1)":"rgba(0, 102, 255, 0.2)"})[t]||"transparent",X=Te(i,{weekStartsOn:1}),Q=Array.from({length:7},(t,o)=>Ce(X,o)),W=[{id:"morning",name:"早上",time:"06:00-12:00",color:"bg-yellow-50 border-yellow-200"},{id:"noon",name:"中午",time:"12:00-14:00",color:"bg-orange-50 border-orange-200"},{id:"afternoon",name:"下午",time:"14:00-18:00",color:"bg-blue-50 border-blue-200"},{id:"evening",name:"晚上",time:"18:00-24:00",color:"bg-purple-50 border-purple-200"}];d.useEffect(()=>{const t=localStorage.getItem("weeklyImportantTasks");if(t)try{b(JSON.parse(t))}catch(j){console.error("Failed to parse weeklyImportantTasks:",j)}const o=localStorage.getItem("quickTasks");if(o)try{h(JSON.parse(o))}catch(j){console.error("Failed to parse quickTasks:",j)}const f=localStorage.getItem("taskTimeRecords");if(f)try{O(JSON.parse(f))}catch(j){console.error("Failed to parse taskTimeRecords:",j)}const w=localStorage.getItem("totalWorkingHours");w&&K(parseInt(w,10)),B(!0)},[]),d.useEffect(()=>{if(!_)return;const t={...c};Q.forEach(o=>{const f=F(o,"yyyy-MM-dd");t[f]||(t[f]={}),W.forEach(w=>{(!t[f][w.id]||t[f][w.id].length===0)&&(t[f][w.id]=[{id:`${f}-${w.id}-${Date.now()}-0`,text:"",time:"",color:"",completed:!1}])})}),JSON.stringify(t)!==JSON.stringify(c)&&h(t)},[i,_,c]),d.useEffect(()=>{const t=o=>{o.key==="Escape"&&(T(null),C(null))};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[]);const le=d.useRef(!1),A=d.useRef(null);d.useRef(null);const Ze=(t,o)=>{const f=m(),j=$().map((S,I)=>I===t?{...S,text:o}:S);b(S=>({...S,[f]:j})),localStorage.setItem("weeklyImportantTasks",JSON.stringify({...u,[f]:j}))},ve=(t,o,f,w,j)=>{const S={...c,[t]:{...c[t],[o]:c[t][o].map((R,M)=>M===f?{...R,[w]:j}:R)}},I=S[t][o],N=f===I.length-1,g=I[f],U=g.text||g.time;N&&U&&(S[t][o]=[...I,{id:`${t}-${o}-${Date.now()}`,text:"",time:"",color:"",completed:!1}]),h(S),localStorage.setItem("quickTasks",JSON.stringify(S)),localStorage.setItem("weeklyImportantTasks",JSON.stringify(u))},et=(t,o,f)=>{const j=c[t][o].filter((I,N)=>N!==f);(j.length===0||j.every(I=>I.text||I.time))&&j.push({id:`${t}-${o}-${Date.now()}`,text:"",time:"",color:"",completed:!1});const S={...c,[t]:{...c[t],[o]:j}};h(S),localStorage.setItem("quickTasks",JSON.stringify(S)),localStorage.setItem("weeklyImportantTasks",JSON.stringify(u))},tt=(t,o,f,w)=>{const j=c[t][o][f],S=j.completed,I={...c,[t]:{...c[t],[o]:c[t][o].map((N,g)=>g===f?{...N,completed:!N.completed}:N)}};if(h(I),localStorage.setItem("quickTasks",JSON.stringify(I)),!S&&w){const N=w.target.getBoundingClientRect(),g=o==="evening"?-35:25;C({taskId:j.id,x:N.left-10,y:N.top+g,dayKey:t,slotId:o,taskIndex:f,taskColor:j.color||"green"})}},st=(t,o,f,w)=>{const j=c[o][f][w];!j.text&&!j.time||(E({task:j,sourceDayKey:o,sourceSlotId:f,sourceTaskIndex:w}),t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",""),t.target.style.opacity="0.5")},at=t=>{t.target.style.opacity="1"},rt=(t,o,f)=>{t.preventDefault(),t.dataTransfer.dropEffect="move",x(`${o}-${f}`)},nt=()=>{x(null)},ot=(t,o,f)=>{var pe;if(t.preventDefault(),x(null),!D)return;const{task:w,sourceDayKey:j,sourceSlotId:S,sourceTaskIndex:I}=D;if(j===o&&S===f){E(null);return}const N={...w,id:`${o}-${f}-${Date.now()}`,completed:!1},g=c[j][S].filter((ie,mt)=>mt!==I);(g.length===0||g.every(ie=>ie.text||ie.time))&&g.push({id:`${j}-${S}-${Date.now()}-empty`,text:"",time:"",color:"",completed:!1});const U=((pe=c[o])==null?void 0:pe[f])||[],R=U.findLastIndex(ie=>ie.text||ie.time),M=R>=0?R+1:0,Z=[...U];Z.splice(M,0,N);const te={...c,[j]:{...c[j],[S]:g},[o]:{...c[o],[f]:Z}};h(te),localStorage.setItem("quickTasks",JSON.stringify(te)),E(null)},lt=(t,o)=>l.filter(f=>{if(!Pe(new Date(f.date),t))return!1;const w=f.time;if(!w)return!1;const j=parseInt(w.split(":")[0]);switch(o){case"morning":return j>=6&&j<12;case"noon":return j>=12&&j<14;case"afternoon":return j>=14&&j<18;case"evening":return j>=18||j<6;default:return!1}}),ge=(t,o)=>{const f={...k,[t]:(k[t]||0)+o};O(f),C(null),localStorage.setItem("taskTimeRecords",JSON.stringify(f))},it=t=>{const o={...k};delete o[t],O(o),C(null),localStorage.setItem("taskTimeRecords",JSON.stringify(o))},ct=(t,o,f)=>{const j={...c[t][o][f],id:`${t}-${o}-${Date.now()}-copy`,completed:!1},S={...c,[t]:{...c[t],[o]:[...c[t][o],j]}};h(S),localStorage.setItem("quickTasks",JSON.stringify(S)),T(null)},he=t=>{const o={red:{bg:"bg-red-500",border:"border-red-500",hover:"hover:bg-red-50",text:"text-red-500"},orange:{bg:"bg-orange-500",border:"border-orange-500",hover:"hover:bg-orange-50",text:"text-orange-500"},pink:{bg:"bg-pink-500",border:"border-pink-500",hover:"hover:bg-pink-50",text:"text-pink-500"},green:{bg:"bg-green-500",border:"border-green-500",hover:"hover:bg-green-50",text:"text-green-500"},purple:{bg:"bg-purple-500",border:"border-purple-500",hover:"hover:bg-purple-50",text:"text-purple-500"},blue:{bg:"bg-blue-500",border:"border-blue-500",hover:"hover:bg-blue-50",text:"text-blue-500"},yellow:{bg:"bg-yellow-500",border:"border-yellow-500",hover:"hover:bg-yellow-50",text:"text-yellow-500"},indigo:{bg:"bg-indigo-500",border:"border-indigo-500",hover:"hover:bg-indigo-50",text:"text-indigo-500"},tencent:{bg:"bg-[#0066FF]",border:"border-[#0066FF]",hover:"hover:bg-[#f0f7ff]",text:"text-[#0066FF]"}};return!t||typeof t!="string"?o.green:o[t]||o.green},ee=t=>k[t]||0,dt=t=>{if(t<60)return`${t}分钟`;const o=Math.floor(t/60),f=t%60;return f>0?`${o}小时${f}分钟`:`${o}小时`},ut=()=>{const t={},o={};Q.forEach(S=>{const I=F(S,"yyyy-MM-dd");W.forEach(N=>{var U;(((U=c[I])==null?void 0:U[N.id])||[]).forEach(R=>{if(R.color&&(R.text||R.time))if(R.completed){const M=ee(R.id),Z=M>0?M/60:.5;o[R.color]=(o[R.color]||0)+Z}else t[R.color]=(t[R.color]||0)+1})})});const f=["red","orange","pink","green","purple","blue","yellow","indigo","tencent"],w={},j={};return f.forEach(S=>{t[S]&&(w[S]=t[S]),o[S]&&(j[S]=o[S])}),{plannedColorStats:w,actualColorStats:j,totalWorkingHours:H}};return e.jsxs("div",{className:"space-y-3",onClick:()=>{T(null),ae(null)},children:[ce&&e.jsx(Ns,{onRecover:t=>{J(t),oe(!1)}}),e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"人生系统设计"}),e.jsxs("p",{className:"text-gray-500 text-sm",children:[F(X,"yyyy年MM月dd日",{locale:xe})," - ",F(Ce(X,6),"MM月dd日",{locale:xe})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[isOnline?isSyncing?e.jsxs("div",{className:"flex items-center space-x-1 text-blue-500",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-xs text-blue-500",children:"同步中"})]}):e.jsxs("div",{className:"flex items-center space-x-1 text-green-500",children:[e.jsx(wt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs text-green-500",children:lastSyncTime?`已同步 ${F(lastSyncTime,"HH:mm")}`:"已同步"})]}):e.jsxs("div",{className:"flex items-center space-x-1 text-gray-500",children:[e.jsx(Nt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs text-gray-500",children:"离线"})]}),syncError&&e.jsx("div",{className:"flex items-center space-x-1 text-red-500",title:syncError,children:e.jsx(fe,{className:"w-4 h-4"})})]}),e.jsx(De,{currentView:a,onViewChange:n}),e.jsx($e,{onImport:J}),e.jsx("button",{onClick:()=>oe(!0),className:"btn-secondary text-xs px-2 py-0.5 text-blue-600 hover:text-blue-700",title:"数据管理：备份、恢复、导入导出",children:"数据管理"}),e.jsx("button",{onClick:()=>p(new Date),className:"btn-secondary text-xs px-2 py-0.5",children:"本周"})]})]}),e.jsx(ws,{}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg px-4 py-2 border border-blue-200",children:e.jsx("div",{className:"flex items-center gap-3",children:$().map((t,o)=>e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex bg-white rounded border border-blue-200 focus-within:ring-1 focus-within:ring-blue-500 focus-within:border-transparent transition-all overflow-hidden",children:[e.jsxs("div",{className:"bg-yellow-400 text-white px-2 py-1.5 text-xs font-bold flex items-center justify-center min-w-10",children:["TOP",o+1]}),e.jsx("input",{type:"text",value:t.text,onChange:f=>Ze(o,f.target.value),className:"flex-1 px-2 py-1.5 text-sm bg-transparent border-none focus:outline-none"})]})},t.id))})}),e.jsxs("div",{className:"flex bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden w-full",children:[e.jsxs("div",{className:"flex-1 min-w-0 w-full",children:[e.jsxs("div",{className:"grid border-b border-gray-200",style:{gridTemplateColumns:"100px repeat(7, 1fr)"},children:[e.jsxs("div",{className:"p-2 bg-gray-50 font-medium text-gray-900 text-lg border-r border-gray-200 flex items-center justify-center h-full",children:[F(i,"MM"),"月"]}),Q.map((t,o)=>{const f=Pe(t,new Date),w=o===5||o===6;return e.jsx("div",{className:`p-2 text-center font-medium border-l border-gray-200 ${f?"bg-blue-50 text-blue-900":w?"bg-gray-100 text-gray-700":"bg-gray-50 text-gray-900"}`,children:e.jsxs("div",{className:"flex items-center justify-center space-x-1 text-sm",children:[e.jsx("span",{className:`text-lg font-bold ${f?"text-blue-600":""}`,children:F(t,"dd")}),e.jsx("span",{className:"text-gray-400 text-xs",children:"·"}),e.jsx("span",{className:"text-gray-600 text-xs",children:["一","二","三","四","五","六","日"][o]})]})},t.toString())})]}),W.map(t=>e.jsxs("div",{className:"grid border-b border-gray-200 min-h-24",style:{gridTemplateColumns:"100px repeat(7, 1fr)"},children:[e.jsx("div",{className:`p-2 ${t.color} border-r border-gray-200 flex flex-col justify-center items-center`,children:e.jsx("div",{className:"font-medium text-gray-900 text-sm",children:t.name})}),Q.map((o,f)=>{var N;const w=F(o,"yyyy-MM-dd"),j=lt(o,t.id),S=((N=c[w])==null?void 0:N[t.id])||[],I=f===5||f===6;return e.jsxs("div",{className:`p-2 border-l border-gray-200 space-y-1 min-h-24 overflow-hidden relative ${I?"bg-gray-25":""} ${y===`${w}-${t.id}`?"bg-blue-100 border-blue-400 border-2 border-dashed":""} ${D?"transition-all duration-200":""} ${D&&y!==`${w}-${t.id}`?"hover:bg-blue-50 hover:border-blue-200 hover:border-dashed":""}`,style:I?{backgroundColor:"#fafafa"}:{},onDragOver:g=>rt(g,w,t.id),onDragLeave:nt,onDrop:g=>ot(g,w,t.id),children:[j.map(g=>e.jsxs("div",{className:"text-xs p-2 bg-blue-100 text-blue-800 rounded border border-blue-200 cursor-pointer hover:bg-blue-200 transition-colors",onClick:()=>r(g.id,g),children:[e.jsx("div",{className:"font-medium break-words overflow-hidden text-ellipsis",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:g.title}),g.time&&e.jsx("div",{className:"text-blue-600 mt-0.5",children:g.time})]},g.id)),S.map((g,U)=>{const R=g.text||g.time;return e.jsxs("div",{className:`flex items-center mb-1 group rounded p-1 ${R?"cursor-move hover:shadow-sm hover:bg-gray-50":""} ${G&&g.color===G?`ring-2 ring-opacity-50 ${he(G).text.replace("text-","ring-")}`:g.completed?"opacity-60":""} ${D&&D.task.id===g.id?"opacity-50":""}`,draggable:R,onDragStart:M=>st(M,w,t.id,U),onDragEnd:at,title:R?"拖拽任务到其他时间段":"",onContextMenu:M=>{R&&(M.preventDefault(),T({taskId:g.id,x:M.clientX,y:M.clientY,dayKey:w,slotId:t.id,taskIndex:U,taskData:g}))},style:{backgroundColor:g.time&&g.color?q(g.color,G&&g.color===G?!1:g.completed):"transparent",position:"relative",transition:"all 0.2s ease"},children:[R&&e.jsx("div",{className:"relative mr-1 flex-shrink-0",children:e.jsx("input",{type:"checkbox",checked:g.completed||!1,onChange:M=>{M.stopPropagation(),T(null),tt(w,t.id,U,M)},onMouseEnter:M=>{if(g.completed){A.current&&(clearTimeout(A.current),A.current=null),le.current=!0;const Z=M.currentTarget.getBoundingClientRect(),te=t.id==="evening"?-35:25;C({taskId:g.id,x:Z.left-10,y:Z.top+te,dayKey:w,slotId:t.id,taskIndex:U,taskColor:g.color||"green"})}},onMouseLeave:()=>{le.current=!1,A.current=setTimeout(()=>{le.current||C(null)},300)},className:`w-3 h-3 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 cursor-pointer z-10 ${g.completed?"opacity-80":""}`,title:g.completed?"悬停记录用时":"点击完成任务"})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(vs,{value:g.time,color:g.color,completed:g.completed,onChange:M=>ve(w,t.id,U,"time",M),onColorChange:M=>ve(w,t.id,U,"color",M)})}),!g.time&&e.jsx("div",{className:`w-px h-4 ml-1 mr-2 flex-shrink-0 ${g.completed?"bg-gray-300":"bg-gray-200"}`}),e.jsx("div",{className:"flex-1 flex items-start overflow-hidden",children:e.jsx("textarea",{value:g.text,onChange:M=>{ve(w,t.id,U,"text",M.target.value)},className:`flex-1 text-xs p-1 border-none focus:outline-none bg-transparent resize-none overflow-hidden break-words ${G&&g.color===G?"text-gray-700":g.completed?"line-through text-gray-500":"text-gray-700"}`,onClick:M=>M.stopPropagation(),rows:1,style:{minHeight:"20px",maxHeight:"60px",width:"100%",boxSizing:"border-box"},onInput:M=>{M.target.style.height="auto",M.target.style.height=`${M.target.scrollHeight}px`}})}),G&&g.color===G&&ee(g.id)>0&&e.jsx("div",{className:"absolute right-1 top-1/2 transform -translate-y-1/2 text-xs font-medium text-gray-700 bg-white bg-opacity-80 px-1 rounded",children:ee(g.id)>=60?`${(ee(g.id)/60).toFixed(ee(g.id)%60===0?0:1)}h`:`${ee(g.id)}m`})]},g.id)})]},`${w}-${t.id}`)})]},t.id))]}),e.jsxs("div",{className:"w-8 border-l border-gray-200 flex flex-col",children:[e.jsx("div",{className:"flex-1 bg-gray-50 hover:bg-blue-50 cursor-pointer flex items-center justify-center group transition-colors border-b border-gray-200",onClick:()=>p(St(i,1)),title:"上一周",children:e.jsx(kt,{className:"w-4 h-4 text-gray-400 group-hover:text-blue-600"})}),e.jsx("div",{className:"flex-1 bg-gray-50 hover:bg-blue-50 cursor-pointer flex items-center justify-center group transition-colors",onClick:()=>p(Ye(i,1)),title:"下一周",children:e.jsx(Tt,{className:"w-4 h-4 text-gray-400 group-hover:text-blue-600"})})]})]}),v&&(()=>{const t=he(v.taskColor),o=240,f=100,w=typeof window<"u"?window.innerWidth:1920,j=typeof window<"u"?window.innerHeight:1080,S=Math.max(10,Math.min(v.x,w-o-10)),I=Math.max(10,Math.min(v.y,j-f-10));return e.jsxs("div",{className:"time-tracking-popup fixed bg-white border border-gray-200 rounded shadow-lg p-2 z-[9999]",style:{left:`${S}px`,top:`${I}px`},onMouseEnter:()=>{A.current&&(clearTimeout(A.current),A.current=null),le.current=!0},onMouseLeave:()=>{le.current=!1,A.current=setTimeout(()=>{le.current||C(null)},200)},children:[e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{onClick:N=>{N.preventDefault(),N.stopPropagation(),A.current&&(clearTimeout(A.current),A.current=null),ge(v.taskId,30)},className:`flex items-center justify-center w-6 h-6 ${t.hover} rounded`,title:"30分钟",children:e.jsx("div",{className:`w-3 h-3 border ${t.border} rounded-full relative`,children:e.jsx("div",{className:`absolute inset-0 ${t.bg} rounded-full`,style:{clipPath:"polygon(50% 0%, 100% 0%, 100% 100%, 50% 100%)"}})})}),e.jsx("button",{onClick:N=>{N.preventDefault(),N.stopPropagation(),A.current&&(clearTimeout(A.current),A.current=null),ge(v.taskId,60)},className:`flex items-center justify-center w-6 h-6 ${t.hover} rounded`,title:"1小时",children:e.jsx("div",{className:`w-3 h-3 ${t.bg} rounded-full`})}),e.jsx("button",{onClick:N=>{N.preventDefault(),N.stopPropagation(),A.current&&(clearTimeout(A.current),A.current=null),ge(v.taskId,120)},className:`flex items-center justify-center w-6 h-6 ${t.hover} rounded`,title:"2小时",children:e.jsxs("div",{className:"flex space-x-0.5",children:[e.jsx("div",{className:`w-2 h-2 ${t.bg} rounded-full`}),e.jsx("div",{className:`w-2 h-2 ${t.bg} rounded-full`})]})}),e.jsx("button",{onClick:N=>{N.preventDefault(),N.stopPropagation(),A.current&&(clearTimeout(A.current),A.current=null),ge(v.taskId,180)},className:`flex items-center justify-center w-6 h-6 ${t.hover} rounded`,title:"3小时",children:e.jsxs("div",{className:"flex space-x-0.5",children:[e.jsx("div",{className:`w-1.5 h-1.5 ${t.bg} rounded-full`}),e.jsx("div",{className:`w-1.5 h-1.5 ${t.bg} rounded-full`}),e.jsx("div",{className:`w-1.5 h-1.5 ${t.bg} rounded-full`})]})}),ee(v.taskId)>0&&e.jsx("button",{onClick:N=>{N.preventDefault(),N.stopPropagation(),A.current&&(clearTimeout(A.current),A.current=null),it(v.taskId)},className:"flex items-center justify-center w-6 h-6 hover:bg-red-50 rounded border border-red-200",title:"清空时间记录",children:e.jsx("svg",{className:"w-3 h-3 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),ee(v.taskId)>0&&e.jsx("div",{className:"mt-1 pt-1 border-t border-gray-200 text-xs text-gray-500 text-center",children:dt(ee(v.taskId))})]})})(),L&&(()=>{const f=typeof window<"u"?window.innerWidth:1920,w=typeof window<"u"?window.innerHeight:1080,j=f-120,S=w-60,I=Math.min(L.x,j),N=Math.min(L.y,S);return e.jsx("div",{className:"fixed bg-white border border-gray-200 rounded shadow-lg p-2 z-50",style:{left:`${I}px`,top:`${N}px`},onClick:g=>g.stopPropagation(),children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>ct(L.dayKey,L.slotId,L.taskIndex),className:"flex items-center space-x-1 px-2 py-1 text-xs bg-blue-50 text-blue-600 rounded hover:bg-blue-100 transition-colors",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),e.jsx("span",{children:"复制"})]}),e.jsxs("button",{onClick:()=>{et(L.dayKey,L.slotId,L.taskIndex),T(null)},className:"flex items-center space-x-1 px-2 py-1 text-xs bg-red-50 text-red-600 rounded hover:bg-red-100 transition-colors",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),e.jsx("span",{children:"删除"})]})]})})})(),(()=>{const{plannedColorStats:t,actualColorStats:o}=ut(),f=new Set([...Object.keys(t),...Object.keys(o)]),w=Object.values(t).reduce((I,N)=>I+N,0),j=Object.values(o).reduce((I,N)=>I+N,0),S=w+j;return e.jsxs("div",{className:"mt-4 bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"本周时间分配"}),e.jsxs("div",{className:"text-xs text-gray-500 cursor-pointer hover:text-blue-600 hover:underline",onClick:()=>V(!0),title:"点击修改总工作时间",children:["计划: ",w.toFixed(1),"h | 完成: ",j.toFixed(1),"h | 总计: ",H,"h (",(S/H*100).toFixed(1),"%)"]})]}),e.jsxs("div",{className:"flex h-6 bg-gray-100 rounded overflow-hidden",children:[Array.from(f).map(I=>{const N=t[I]||0,g=o[I]||0,U=N+g,R=U/H*100,M=g/H*100,Z=N/H*100,te=he(I||"gray"),pe={red:"Meeting",orange:"Think",pink:"Interview",green:"Run",purple:"Coach",blue:"English",yellow:"XinLi",indigo:"Book",tencent:"Free"};return e.jsxs("div",{className:"relative flex items-center justify-center text-white text-xs font-medium cursor-pointer hover:opacity-80 transition-opacity",style:{width:`${R}%`},title:`${pe[I]}: 计划${N.toFixed(1)}h + 完成${g.toFixed(1)}h = ${U.toFixed(1)}h (${R.toFixed(1)}%)`,onMouseEnter:()=>ae(I),onMouseLeave:()=>ae(null),children:[g>0&&e.jsx("div",{className:`absolute left-0 top-0 h-full ${te.bg}`,style:{width:`${M/R*100}%`}}),N>0&&e.jsx("div",{className:`absolute right-0 top-0 h-full ${te.bg} opacity-40`,style:{width:`${Z/R*100}%`}}),e.jsx("span",{className:"relative z-10",children:R>=5?`${U.toFixed(1)}h`:""})]},I)}),S<H&&e.jsx("div",{className:"bg-gray-200 flex items-center justify-center text-gray-500 text-xs",style:{width:`${(H-S)/H*100}%`},title:`剩余: ${(H-S).toFixed(1)}小时 (${((H-S)/H*100).toFixed(1)}%)`,children:(H-S)/H>=.05?`${(H-S).toFixed(1)}h`:""})]}),e.jsx("div",{className:"flex flex-wrap gap-3 mt-3 text-xs",children:Array.from(f).map(I=>{const N=t[I]||0,g=o[I]||0,R=(N+g)/H*100,M=he(I),Z=I?M.text.replace("bg-","text-"):"text-gray-600",te={red:"Meeting",orange:"Think",pink:"Interview",green:"Run",purple:"Coach",blue:"English",yellow:"XinLi",indigo:"Book",tencent:"Free"};return e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-3 h-3 ${M.bg} rounded`}),N>0&&e.jsx("div",{className:`w-3 h-3 ${M.bg} opacity-40 rounded ml-0.5`})]}),e.jsxs("span",{className:"text-gray-600",children:[te[I],":",g>0&&e.jsxs("span",{className:"font-medium",children:[" 完成",g.toFixed(1),"h"]}),N>0&&e.jsxs("span",{className:"text-gray-500",children:[" 计划",N.toFixed(1),"h"]}),e.jsxs("span",{className:`font-bold ${Z}`,children:[" (",R.toFixed(1),"%)"]})]})]},I)})})]})})(),D&&e.jsxs("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-blue-500 text-white px-4 py-2 rounded-lg text-sm z-50 shadow-lg flex items-center space-x-2",children:[e.jsx("span",{children:"🚀"}),e.jsxs("span",{children:["正在移动任务: ",D.task.text||D.task.time||"未命名任务"]}),e.jsx("span",{className:"text-blue-200 text-xs",children:"拖拽到目标时间段"})]}),e.jsx(js,{isOpen:Y,onClose:()=>V(!1),totalTime:H,onSave:P})]})},Ss=({currentView:l,onViewChange:s})=>{const{data:r,saveData:a}=Ke(),[n,i]=d.useState(new Date),p=new Date,[u,b]=d.useState([p.getMonth()]),[c,h]=d.useState({});d.useEffect(()=>{r&&r.importantTasks&&h(r.importantTasks)},[r]);const D=T=>{T.importantTasks&&(h(T.importantTasks),a({...r,importantTasks:T.importantTasks}))},E=T=>{const _=new Date(T,0,1),B=new Date(T,11,31),Y=[];let V=Te(_,{weekStartsOn:1});for(;V<=B;)Y.push(new Date(V)),V=Ye(V,1);return Y},y=T=>{const _=E(T),B=[];for(let Y=0;Y<12;Y++){const V=new Date(T,Y,1),H=$t(V),K=_.filter(G=>Ce(G,6)>=V&&G<=H);B.push({month:Y,monthName:F(V,"MMMM",{locale:xe}),weeks:K})}return B},x=T=>{const _=F(T,"yyyy-MM-dd");return c[_]||[{id:"important-1",text:""},{id:"important-2",text:""},{id:"important-3",text:""}]},v=T=>{b(_=>_.includes(T)?_.filter(B=>B!==T):[..._,T])},C=()=>{const T=y(n.getFullYear());b(T.map((_,B)=>B))},k=()=>{b([])},O=y(n.getFullYear()),L=new Date().getMonth();return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"人生系统设计"}),e.jsxs("p",{className:"text-gray-500 text-sm",children:[n.getFullYear(),"年全年视图"]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(De,{currentView:l,onViewChange:s}),e.jsx($e,{onImport:D})]})]}),e.jsxs("div",{className:"p-4 bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>i(T=>new Date(T.getFullYear()-1,0,1)),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(Ct,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:[n.getFullYear(),"年"]}),e.jsx("button",{onClick:()=>i(T=>new Date(T.getFullYear()+1,0,1)),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(We,{className:"w-5 h-5 text-gray-600"})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:C,className:"px-3 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:"展开所有"}),e.jsx("button",{onClick:k,className:"px-3 py-1 text-sm bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition-colors",children:"收起所有"})]})]}),e.jsx("div",{className:"space-y-4",children:O.map((T,_)=>{const B=u.includes(_),Y=_===L;return e.jsxs("div",{className:`border rounded-lg overflow-hidden ${Y?"border-blue-300 bg-blue-50":"border-gray-200"}`,children:[e.jsxs("div",{className:`flex items-center justify-between p-3 cursor-pointer ${Y?"bg-blue-100":"bg-gray-50"} hover:bg-opacity-80 transition-colors`,onClick:()=>v(_),children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(be,{className:`w-5 h-5 ${Y?"text-blue-600":"text-gray-600"}`}),e.jsx("h2",{className:`text-lg font-semibold ${Y?"text-blue-900":"text-gray-900"}`,children:T.monthName}),e.jsxs("span",{className:`text-sm px-2 py-1 rounded ${Y?"bg-blue-200 text-blue-800":"bg-gray-200 text-gray-700"}`,children:[T.weeks.length,"周"]})]}),e.jsx("div",{className:`transform transition-transform ${B?"rotate-90":""}`,children:e.jsx(We,{className:"w-5 h-5 text-gray-600"})})]}),B&&e.jsx("div",{className:"p-4 bg-white",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 2xl:grid-cols-6 gap-4",children:T.weeks.map((V,H)=>{const K=F(V,"yyyy-MM-dd"),G=x(V),ae=It(V),ce=Dt(V,new Date,{weekStartsOn:1});return e.jsxs("div",{className:`border rounded-lg p-3 ${ce?"border-blue-300 bg-blue-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["第",ae,"周"]}),e.jsx("span",{className:"text-xs text-gray-500",children:F(V,"MM/dd")})]}),e.jsx("div",{className:"space-y-1",children:G.map((oe,m)=>e.jsxs("div",{className:"flex items-start space-x-1",children:[e.jsxs("div",{className:`text-xs font-bold ${m===0?"text-yellow-600":m===1?"text-gray-500":"text-orange-600"}`,children:["TOP",m+1]}),e.jsx("div",{className:"flex-1 text-xs text-gray-700 truncate",children:oe.text||e.jsx("span",{className:"text-gray-400 italic",children:"未填写"})})]},oe.id))})]},K)})})})]},_)})})]})]})},Ts=({currentView:l,onViewChange:s})=>{const[r,a]=d.useState("overview"),n=u=>{console.log("数据已导入:",u)},i=[{id:"overview",name:"总览",icon:Re},{id:"goals",name:"目标管理",icon:Le},{id:"schedule",name:"日程设置",icon:be},{id:"profile",name:"个人资料",icon:Mt},{id:"notifications",name:"通知设置",icon:Ot},{id:"settings",name:"系统设置",icon:Et}],p=()=>{var u;switch(r){case"overview":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-blue-50 p-6 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-600 text-sm font-medium",children:"本周完成任务"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:"12/18"})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(be,{className:"w-6 h-6 text-white"})})]})}),e.jsx("div",{className:"bg-green-50 p-6 rounded-lg border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-600 text-sm font-medium",children:"年度目标进度"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:"3/5"})]}),e.jsx("div",{className:"w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center",children:e.jsx(Le,{className:"w-6 h-6 text-white"})})]})}),e.jsx("div",{className:"bg-purple-50 p-6 rounded-lg border border-purple-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-600 text-sm font-medium",children:"系统使用天数"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:"45天"})]}),e.jsx("div",{className:"w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center",children:e.jsx(Re,{className:"w-6 h-6 text-white"})})]})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"最近活动"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-700",children:'完成了"团队会议"任务'}),e.jsx("span",{className:"text-xs text-gray-500 ml-auto",children:"2小时前"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-700",children:"更新了年度健康目标"}),e.jsx("span",{className:"text-xs text-gray-500 ml-auto",children:"1天前"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-700",children:"创建了新的周计划"}),e.jsx("span",{className:"text-xs text-gray-500 ml-auto",children:"3天前"})]})]})]})]});case"goals":return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"目标类别管理"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"事业发展权重"}),e.jsx("input",{type:"range",min:"0",max:"100",defaultValue:"30",className:"w-full"}),e.jsx("span",{className:"text-sm text-gray-500",children:"30%"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"健康管理权重"}),e.jsx("input",{type:"range",min:"0",max:"100",defaultValue:"25",className:"w-full"}),e.jsx("span",{className:"text-sm text-gray-500",children:"25%"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"人际关系权重"}),e.jsx("input",{type:"range",min:"0",max:"100",defaultValue:"20",className:"w-full"}),e.jsx("span",{className:"text-sm text-gray-500",children:"20%"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"学习成长权重"}),e.jsx("input",{type:"range",min:"0",max:"100",defaultValue:"25",className:"w-full"}),e.jsx("span",{className:"text-sm text-gray-500",children:"25%"})]})]})]})});case"schedule":return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"时间段设置"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-yellow-50 rounded-lg border border-yellow-200",children:[e.jsx("span",{className:"font-medium",children:"早上时段"}),e.jsx("input",{type:"text",defaultValue:"06:00-12:00",className:"px-3 py-1 border border-gray-300 rounded text-sm"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-orange-50 rounded-lg border border-orange-200",children:[e.jsx("span",{className:"font-medium",children:"中午时段"}),e.jsx("input",{type:"text",defaultValue:"12:00-14:00",className:"px-3 py-1 border border-gray-300 rounded text-sm"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("span",{className:"font-medium",children:"下午时段"}),e.jsx("input",{type:"text",defaultValue:"14:00-18:00",className:"px-3 py-1 border border-gray-300 rounded text-sm"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsx("span",{className:"font-medium",children:"晚上时段"}),e.jsx("input",{type:"text",defaultValue:"18:00-24:00",className:"px-3 py-1 border border-gray-300 rounded text-sm"})]})]})]})});default:return e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:(u=i.find(b=>b.id===r))==null?void 0:u.name}),e.jsx("p",{className:"text-gray-600",children:"此功能正在开发中..."})]})}};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"人生系统设计"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"系统管理与配置中心"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(De,{currentView:l,onViewChange:s}),e.jsx($e,{onImport:n})]})]}),e.jsx("div",{className:"flex space-x-1 bg-gray-100 rounded-lg p-1",children:i.map(u=>{const b=u.icon;return e.jsxs("button",{onClick:()=>a(u.id),className:`flex items-center space-x-2 px-3 py-2 text-sm font-medium rounded-md transition-colors ${r===u.id?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(b,{className:"w-4 h-4"}),e.jsx("span",{children:u.name})]},u.id)})}),e.jsx("div",{className:"min-h-96",children:p()})]})},Cs=({onClose:l,onAddTask:s,selectedDate:r})=>{const[a,n]=d.useState({title:"",description:"",date:r?F(r,"yyyy-MM-dd"):F(new Date,"yyyy-MM-dd"),time:"",priority:"medium",category:"work"}),[i,p]=d.useState({}),u=c=>{c.preventDefault();const h={};if(a.title.trim()||(h.title="请输入任务标题"),a.date||(h.date="请选择日期"),Object.keys(h).length>0){p(h);return}const D={...a,date:new Date(a.date),title:a.title.trim(),description:a.description.trim()};s(D),l()},b=(c,h)=>{n(D=>({...D,[c]:h})),i[c]&&p(D=>({...D,[c]:""}))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"添加新任务"}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(me,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:u,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"任务标题 *"}),e.jsx("input",{type:"text",value:a.title,onChange:c=>b("title",c.target.value),className:`input ${i.title?"border-red-500 focus:ring-red-500":""}`,placeholder:"输入任务标题..."}),i.title&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"任务描述"}),e.jsx("textarea",{value:a.description,onChange:c=>b("description",c.target.value),rows:3,className:"input resize-none",placeholder:"输入任务描述..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(be,{className:"w-4 h-4 inline mr-1"}),"日期 *"]}),e.jsx("input",{type:"date",value:a.date,onChange:c=>b("date",c.target.value),className:`input ${i.date?"border-red-500 focus:ring-red-500":""}`}),i.date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.date})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Pt,{className:"w-4 h-4 inline mr-1"}),"时间"]}),e.jsx("input",{type:"time",value:a.time,onChange:c=>b("time",c.target.value),className:"input"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Wt,{className:"w-4 h-4 inline mr-1"}),"优先级"]}),e.jsxs("select",{value:a.priority,onChange:c=>b("priority",c.target.value),className:"input",children:[e.jsx("option",{value:"low",children:"低优先级"}),e.jsx("option",{value:"medium",children:"中优先级"}),e.jsx("option",{value:"high",children:"高优先级"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Rt,{className:"w-4 h-4 inline mr-1"}),"分类"]}),e.jsxs("select",{value:a.category,onChange:c=>b("category",c.target.value),className:"input",children:[e.jsx("option",{value:"work",children:"工作"}),e.jsx("option",{value:"personal",children:"个人"}),e.jsx("option",{value:"health",children:"健康"}),e.jsx("option",{value:"study",children:"学习"})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:l,className:"btn-secondary",children:"取消"}),e.jsx("button",{type:"submit",className:"btn-primary",children:"添加任务"})]})]})]})})},Is=({className:l=""})=>{const{isOnline:s,syncStatus:r,lastSync:a,manualSync:n}=qe(),[i,p]=d.useState(!1),u=()=>{switch(r){case"syncing":return e.jsx(Be,{className:"animate-spin",size:16});case"success":return e.jsx(Se,{size:16});case"error":return e.jsx(fe,{size:16});default:return s?e.jsx(Ae,{size:16}):e.jsx(Fe,{size:16})}},b=()=>{if(!s)return"离线";switch(r){case"syncing":return"同步中...";case"success":return"已同步";case"error":return"同步失败";default:return"等待同步"}},c=()=>{if(!s)return"text-gray-500";switch(r){case"syncing":return"text-blue-500";case"success":return"text-green-500";case"error":return"text-red-500";default:return"text-gray-500"}},h=()=>{if(!a)return"从未同步";const y=new Date-new Date(a),x=Math.floor(y/6e4);if(x<1)return"刚刚";if(x<60)return`${x}分钟前`;const v=Math.floor(x/60);return v<24?`${v}小时前`:`${Math.floor(v/24)}天前`},D=async()=>{if(r!=="syncing")try{await n(),setTimeout(()=>p(!1),2e3)}catch(E){console.error("手动同步失败:",E)}};return e.jsxs("div",{className:`relative ${l}`,children:[e.jsxs("button",{className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${c()} bg-gray-100 dark:bg-gray-800`,onClick:()=>p(!i),children:[u(),e.jsx("span",{children:b()})]}),i&&e.jsx("div",{className:"absolute right-0 mt-2 w-64 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 p-4 z-10",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"网络状态:"}),e.jsxs("div",{className:`flex items-center gap-1 ${s?"text-green-500":"text-red-500"}`,children:[s?e.jsx(Ae,{size:14}):e.jsx(Fe,{size:14}),e.jsx("span",{className:"text-sm",children:s?"在线":"离线"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"同步状态:"}),e.jsxs("div",{className:`flex items-center gap-1 ${c()}`,children:[u(),e.jsx("span",{className:"text-sm",children:b()})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"上次同步:"}),e.jsx("span",{className:"text-sm text-gray-500",children:h()})]}),s&&e.jsx("button",{onClick:D,disabled:r==="syncing",className:"w-full py-2 px-4 bg-blue-500 text-white rounded-lg font-medium text-sm hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:r==="syncing"?"同步中...":"立即同步"}),e.jsx("div",{className:"pt-2 border-t border-gray-200 dark:border-gray-700",children:e.jsx("p",{className:"text-xs text-gray-500",children:"数据会自动同步到云端，确保在不同设备上访问时保持一致。"})})]})})]})},Ds=({isOpen:l,onClose:s})=>{const[r,a]=d.useState(""),[n,i]=d.useState(!1),[p,u]=d.useState(!1),[b,c]=d.useState("");d.useEffect(()=>{const E=localStorage.getItem("jsonbin_api_key");E&&(a(E),u(!0))},[]);const h=async()=>{if(!r.trim()){c("请输入API密钥");return}i(!0),c("");try{const E=await fetch("https://api.jsonbin.io/v3/b",{method:"POST",headers:{"Content-Type":"application/json","X-Master-Key":r},body:JSON.stringify({test:!0})});if(!E.ok)throw new Error("API密钥无效");localStorage.setItem("jsonbin_api_key",r);const y=await E.json();localStorage.setItem("bin_id",y.id),u(!0);try{await z.syncData()}catch(x){console.warn("Initial sync failed:",x)}}catch(E){c(E.message||"验证API密钥时出错")}finally{i(!1)}},D=()=>{localStorage.setItem("cloud_sync_enabled","false"),s()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-md mx-4 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{size:24,className:"text-blue-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"数据同步设置"})]}),e.jsx("button",{onClick:s,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:e.jsx(me,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-100 dark:bg-blue-900/30 rounded-full",children:e.jsx(_e,{size:32,className:"text-blue-600 dark:text-blue-400"})}),e.jsx("h3",{className:"text-lg font-medium",children:"启用云端同步"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"设置JSONBin.io API密钥，在不同设备间同步数据"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(fe,{size:18,className:"text-blue-600 dark:text-blue-400 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-blue-900 dark:text-blue-100",children:"如何获取API密钥:"}),e.jsxs("ol",{className:"mt-1 space-y-1 text-blue-800 dark:text-blue-200 list-decimal list-inside",children:[e.jsxs("li",{children:["访问 ",e.jsx("a",{href:"https://jsonbin.io",target:"_blank",rel:"noopener noreferrer",className:"underline",children:"jsonbin.io"})]}),e.jsx("li",{children:"注册免费账户"}),e.jsx("li",{children:"在控制台中复制API密钥"}),e.jsx("li",{children:"将密钥粘贴到下方输入框"})]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"api-key",className:"block text-sm font-medium",children:"JSONBin.io API密钥"}),e.jsx("input",{id:"api-key",type:"password",value:r,onChange:E=>a(E.target.value),placeholder:"输入你的API密钥",className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:outline-none ${b?"border-red-500 focus:ring-red-500":p?"border-green-500 focus:ring-green-500":"border-gray-300 focus:ring-blue-500 dark:border-gray-700 dark:focus:ring-blue-500"} bg-white dark:bg-gray-800`}),b&&e.jsxs("p",{className:"text-sm text-red-600 dark:text-red-400 flex items-center gap-1",children:[e.jsx(fe,{size:14}),b]}),p&&e.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400 flex items-center gap-1",children:[e.jsx(Ve,{size:14}),"API密钥已验证"]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:D,className:"flex-1 py-2 px-4 border border-gray-300 dark:border-gray-700 rounded-lg font-medium hover:bg-gray-50 dark:hover:bg-gray-700",children:"跳过（离线模式）"}),e.jsx("button",{onClick:h,disabled:n,className:"flex-1 py-2 px-4 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:n?"验证中...":"保存密钥"})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center pt-2 border-t border-gray-200 dark:border-gray-700",children:"数据将安全地存储在云端，你可以随时在设置中更改"})]})]})})};function $s(){const[l,s]=d.useState([]),[r,a]=d.useState(!1),[n,i]=d.useState(new Date),[p,u]=d.useState("week"),[b,c]=d.useState(!1);d.useEffect(()=>{const y=localStorage.getItem("jsonbin_api_key"),x=localStorage.getItem("cloud_sync_enabled")==="false";!y&&!x&&c(!0);const v=se.getAllData();if(!v.weeks||Object.keys(v.weeks).length===0){const C=se.getAllData();se.saveData(C)}},[]);const h=y=>{const x={...y,id:Date.now(),completed:!1};s(v=>[...v,x])},D=(y,x)=>{s(v=>v.map(C=>C.id===y?{...C,...x}:C))},E=()=>{switch(p){case"test":return e.jsx(zt,{});case"week":return e.jsx(ze,{tasks:l,onAddTask:h,onUpdateTask:D,currentView:p,onViewChange:u});case"year":return e.jsx(Ss,{currentView:p,onViewChange:u});case"management":return e.jsx(Ts,{currentView:p,onViewChange:u});default:return e.jsx(ze,{tasks:l,onAddTask:h,onUpdateTask:D,currentView:p,onViewChange:u})}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200 px-4 py-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"生活管理系统"}),e.jsx(Is,{})]})}),e.jsx("main",{className:"p-3",children:e.jsx("div",{className:"w-full max-w-full mx-auto px-4",children:E()})}),r&&e.jsx(Cs,{onClose:()=>a(!1),onAddTask:h,selectedDate:n})]}),b&&e.jsx(Ds,{isOpen:b,onClose:()=>c(!1)})]})}Ie.createRoot(document.getElementById("root")).render(e.jsx(gt.StrictMode,{children:e.jsx($s,{})}));
