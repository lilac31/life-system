import{r as c,a as at,R as nt}from"./react-wGySg1uH.js";import{r as ot,s as Ie,b as ve,a as ce,c as de,d as lt,D as Le,U as _e,f as J,e as $e,p as se,P as it,X as he,C as ct,g as dt,i as Oe,h as je,j as ut,F as mt,R as xt,k as Me,A as gt,l as Ne,m as ke,n as ht,o as De,q as pt,t as ft,u as bt,v as He,w as yt,x as Re,y as pe,z as vt,B as jt,E as wt,G as Ee,T as Pe,H as Nt,I as kt,S as St,J as Tt,K as Ct,L as It}from"./utils-CY1kTWih.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))s(u);new MutationObserver(u=>{for(const m of u)if(m.type==="childList")for(const h of m.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function g(u){const m={};return u.integrity&&(m.integrity=u.integrity),u.referrerPolicy&&(m.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?m.credentials="include":u.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function s(u){if(u.ep)return;u.ep=!0;const m=g(u);fetch(u.href,m)}})();var Je={exports:{}},fe={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $t=c,Ot=Symbol.for("react.element"),Mt=Symbol.for("react.fragment"),Dt=Object.prototype.hasOwnProperty,Rt=$t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Et={key:!0,ref:!0,__self:!0,__source:!0};function Ge(o,i,g){var s,u={},m=null,h=null;g!==void 0&&(m=""+g),i.key!==void 0&&(m=""+i.key),i.ref!==void 0&&(h=i.ref);for(s in i)Dt.call(i,s)&&!Et.hasOwnProperty(s)&&(u[s]=i[s]);if(o&&o.defaultProps)for(s in i=o.defaultProps,i)u[s]===void 0&&(u[s]=i[s]);return{$$typeof:Ot,type:o,key:m,ref:h,props:u,_owner:Rt.current}}fe.Fragment=Mt;fe.jsx=Ge;fe.jsxs=Ge;Je.exports=fe;var e=Je.exports,Se={},We=at;Se.createRoot=We.createRoot,Se.hydrateRoot=We.hydrateRoot;const Pt=()=>e.jsxs("div",{className:"p-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"测试页面"}),e.jsx("p",{children:"如果您能看到这个页面，说明基本设置是正常的。"})]});function Wt(o,i,g){ot(2,arguments);var s=Ie(o,g),u=Ie(i,g);return s.getTime()===u.getTime()}var Ft={lessThanXSeconds:{one:"不到 1 秒",other:"不到 {{count}} 秒"},xSeconds:{one:"1 秒",other:"{{count}} 秒"},halfAMinute:"半分钟",lessThanXMinutes:{one:"不到 1 分钟",other:"不到 {{count}} 分钟"},xMinutes:{one:"1 分钟",other:"{{count}} 分钟"},xHours:{one:"1 小时",other:"{{count}} 小时"},aboutXHours:{one:"大约 1 小时",other:"大约 {{count}} 小时"},xDays:{one:"1 天",other:"{{count}} 天"},aboutXWeeks:{one:"大约 1 个星期",other:"大约 {{count}} 个星期"},xWeeks:{one:"1 个星期",other:"{{count}} 个星期"},aboutXMonths:{one:"大约 1 个月",other:"大约 {{count}} 个月"},xMonths:{one:"1 个月",other:"{{count}} 个月"},aboutXYears:{one:"大约 1 年",other:"大约 {{count}} 年"},xYears:{one:"1 年",other:"{{count}} 年"},overXYears:{one:"超过 1 年",other:"超过 {{count}} 年"},almostXYears:{one:"将近 1 年",other:"将近 {{count}} 年"}},At=function(i,g,s){var u,m=Ft[i];return typeof m=="string"?u=m:g===1?u=m.one:u=m.other.replace("{{count}}",String(g)),s!=null&&s.addSuffix?s.comparison&&s.comparison>0?u+"内":u+"前":u},Lt={full:"y'年'M'月'd'日' EEEE",long:"y'年'M'月'd'日'",medium:"yyyy-MM-dd",short:"yy-MM-dd"},_t={full:"zzzz a h:mm:ss",long:"z a h:mm:ss",medium:"a h:mm:ss",short:"a h:mm"},Ht={full:"{{date}} {{time}}",long:"{{date}} {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},Jt={date:ve({formats:Lt,defaultWidth:"full"}),time:ve({formats:_t,defaultWidth:"full"}),dateTime:ve({formats:Ht,defaultWidth:"full"})};function Fe(o,i,g){var s="eeee p";return Wt(o,i,g)?s:o.getTime()>i.getTime()?"'下个'"+s:"'上个'"+s}var Gt={lastWeek:Fe,yesterday:"'昨天' p",today:"'今天' p",tomorrow:"'明天' p",nextWeek:Fe,other:"PP p"},Ut=function(i,g,s,u){var m=Gt[i];return typeof m=="function"?m(g,s,u):m},Vt={narrow:["前","公元"],abbreviated:["前","公元"],wide:["公元前","公元"]},zt={narrow:["1","2","3","4"],abbreviated:["第一季","第二季","第三季","第四季"],wide:["第一季度","第二季度","第三季度","第四季度"]},Yt={narrow:["一","二","三","四","五","六","七","八","九","十","十一","十二"],abbreviated:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],wide:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]},Bt={narrow:["日","一","二","三","四","五","六"],short:["日","一","二","三","四","五","六"],abbreviated:["周日","周一","周二","周三","周四","周五","周六"],wide:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"]},Qt={narrow:{am:"上",pm:"下",midnight:"凌晨",noon:"午",morning:"早",afternoon:"下午",evening:"晚",night:"夜"},abbreviated:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"},wide:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"}},Kt={narrow:{am:"上",pm:"下",midnight:"凌晨",noon:"午",morning:"早",afternoon:"下午",evening:"晚",night:"夜"},abbreviated:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"},wide:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"}},Xt=function(i,g){var s=Number(i);switch(g==null?void 0:g.unit){case"date":return s.toString()+"日";case"hour":return s.toString()+"时";case"minute":return s.toString()+"分";case"second":return s.toString()+"秒";default:return"第 "+s.toString()}},qt={ordinalNumber:Xt,era:ce({values:Vt,defaultWidth:"wide"}),quarter:ce({values:zt,defaultWidth:"wide",argumentCallback:function(i){return i-1}}),month:ce({values:Yt,defaultWidth:"wide"}),day:ce({values:Bt,defaultWidth:"wide"}),dayPeriod:ce({values:Qt,defaultWidth:"wide",formattingValues:Kt,defaultFormattingWidth:"wide"})},Zt=/^(第\s*)?\d+(日|时|分|秒)?/i,es=/\d+/i,ts={narrow:/^(前)/i,abbreviated:/^(前)/i,wide:/^(公元前|公元)/i},ss={any:[/^(前)/i,/^(公元)/i]},rs={narrow:/^[1234]/i,abbreviated:/^第[一二三四]刻/i,wide:/^第[一二三四]刻钟/i},as={any:[/(1|一)/i,/(2|二)/i,/(3|三)/i,/(4|四)/i]},ns={narrow:/^(一|二|三|四|五|六|七|八|九|十[二一])/i,abbreviated:/^(一|二|三|四|五|六|七|八|九|十[二一]|\d|1[12])月/i,wide:/^(一|二|三|四|五|六|七|八|九|十[二一])月/i},os={narrow:[/^一/i,/^二/i,/^三/i,/^四/i,/^五/i,/^六/i,/^七/i,/^八/i,/^九/i,/^十(?!(一|二))/i,/^十一/i,/^十二/i],any:[/^一|1/i,/^二|2/i,/^三|3/i,/^四|4/i,/^五|5/i,/^六|6/i,/^七|7/i,/^八|8/i,/^九|9/i,/^十(?!(一|二))|10/i,/^十一|11/i,/^十二|12/i]},ls={narrow:/^[一二三四五六日]/i,short:/^[一二三四五六日]/i,abbreviated:/^周[一二三四五六日]/i,wide:/^星期[一二三四五六日]/i},is={any:[/日/i,/一/i,/二/i,/三/i,/四/i,/五/i,/六/i]},cs={any:/^(上午?|下午?|午夜|[中正]午|早上?|下午|晚上?|凌晨|)/i},ds={any:{am:/^上午?/i,pm:/^下午?/i,midnight:/^午夜/i,noon:/^[中正]午/i,morning:/^早上/i,afternoon:/^下午/i,evening:/^晚上?/i,night:/^凌晨/i}},us={ordinalNumber:lt({matchPattern:Zt,parsePattern:es,valueCallback:function(i){return parseInt(i,10)}}),era:de({matchPatterns:ts,defaultMatchWidth:"wide",parsePatterns:ss,defaultParseWidth:"any"}),quarter:de({matchPatterns:rs,defaultMatchWidth:"wide",parsePatterns:as,defaultParseWidth:"any",valueCallback:function(i){return i+1}}),month:de({matchPatterns:ns,defaultMatchWidth:"wide",parsePatterns:os,defaultParseWidth:"any"}),day:de({matchPatterns:ls,defaultMatchWidth:"wide",parsePatterns:is,defaultParseWidth:"any"}),dayPeriod:de({matchPatterns:cs,defaultMatchWidth:"any",parsePatterns:ds,defaultParseWidth:"any"})},ue={code:"zh-CN",formatDistance:At,formatLong:Jt,formatRelative:Ut,localize:qt,match:us,options:{weekStartsOn:1,firstWeekContainsDate:4}};const ms=({value:o,color:i,completed:g=!1,onChange:s,onColorChange:u,className:m=""})=>{const[h,j]=c.useState(!1),b=c.useRef(null),p=c.useRef(null),n=[{name:"红色",value:"red",bg:"bg-red-500",text:"text-red-600",letter:"M"},{name:"橙色",value:"orange",bg:"bg-orange-500",text:"text-orange-600",letter:"T"},{name:"粉色",value:"pink",bg:"bg-pink-500",text:"text-pink-600",letter:"I"},{name:"绿色",value:"green",bg:"bg-green-500",text:"text-green-600",letter:"R"},{name:"紫色",value:"purple",bg:"bg-purple-500",text:"text-purple-600",letter:"C"},{name:"蓝色",value:"blue",bg:"bg-blue-500",text:"text-blue-600",letter:"E"},{name:"黄色",value:"yellow",bg:"bg-yellow-500",text:"text-yellow-600",letter:"X"},{name:"靛蓝色",value:"indigo",bg:"bg-indigo-500",text:"text-indigo-600",letter:"B"},{name:"腾讯蓝",value:"tencent",bg:"bg-[#0066FF]",text:"text-[#0066FF]",letter:"F"}],$=n.find(a=>a.value===i)||n[0],y=(()=>{const a=[];for(let f=0;f<24;f++)for(let L=0;L<60;L+=15){const N=`${f.toString().padStart(2,"0")}:${L.toString().padStart(2,"0")}`;a.push(N)}return a})();c.useEffect(()=>{const a=f=>{b.current&&!b.current.contains(f.target)&&p.current&&!p.current.contains(f.target)&&j(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]),c.useEffect(()=>{if(h&&b.current){const a=setTimeout(()=>{if(b.current){const f=b.current.querySelector('button[data-time="10:00"]');if(f)f.scrollIntoView({behavior:"instant",block:"center"});else{const L=y.findIndex(N=>N==="10:00");L!==-1&&(b.current.scrollTop=L*28-80)}}},50);return()=>clearTimeout(a)}},[h,y]);const S=a=>{s(a),setTimeout(()=>j(!1),100)},W=()=>{s(""),u(""),j(!1)},I=a=>{u(a)};return e.jsxs("div",{className:`relative ${m}`,children:[e.jsx("button",{ref:p,onClick:()=>j(!h),className:`w-12 h-6 text-left text-xs px-1 py-0.5 hover:bg-gray-100 focus:outline-none transition-colors ${o?i?g?`${$.text} font-medium opacity-70 line-through`:`${$.text} font-medium`:g?"text-gray-600 font-bold opacity-70 line-through":"text-gray-900 font-bold":g?"text-gray-500":"text-gray-400"}`,title:o?`${o}`:"点击选择时间",children:o||""}),h&&e.jsxs("div",{ref:b,className:"fixed bg-white border border-gray-200 rounded-md shadow-lg z-[9999] flex",style:{top:p.current?Math.min(p.current.getBoundingClientRect().bottom+4,window.innerHeight-280):"auto",left:p.current?Math.max(4,Math.min(p.current.getBoundingClientRect().left,window.innerWidth-100)):"auto"},children:[e.jsxs("div",{className:"w-20 p-2 border-r border-gray-200",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1.5 text-center",children:"颜色"}),e.jsx("div",{className:"flex flex-col gap-1.5 items-center",children:n.map(a=>e.jsx("button",{onClick:()=>I(a.value),className:`w-6 h-4 rounded-sm ${a.bg} hover:scale-105 transition-transform flex items-center justify-center text-white text-xs font-bold ${i===a.value?"ring-1 ring-gray-400 ring-offset-0":""}`,title:`${a.name} (${a.letter})`,children:e.jsx("span",{className:"text-[10px] font-bold",children:a.letter})},a.value))})]}),e.jsxs("div",{className:"w-20 max-h-56 overflow-y-auto",children:[e.jsx("button",{onClick:W,className:"w-full text-left px-2 py-1 text-xs text-gray-400 hover:bg-gray-50 border-b border-gray-100",children:"清除"}),y.map(a=>e.jsx("button",{"data-time":a,onClick:()=>S(a),className:`w-full text-left px-2 py-1 text-xs hover:bg-blue-50 transition-colors ${o===a?"bg-blue-50 text-blue-600":"text-gray-700"}`,children:a},a))]})]})]})},Te=({currentView:o,onViewChange:i})=>{const g=[{id:"week",name:"周视图"},{id:"year",name:"年视图"},{id:"management",name:"管理界面"}];return e.jsx("nav",{className:"flex items-center space-x-1 bg-gray-100 rounded-lg p-1",children:g.map(s=>e.jsx("button",{onClick:()=>i(s.id),className:`px-3 py-1 text-sm font-medium rounded-md transition-colors ${o===s.id?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:s.name},s.id))})},xs=({isOpen:o,onClose:i,totalTime:g,onSave:s})=>{const[u,m]=c.useState(0),[h,j]=c.useState("");c.useEffect(()=>{if(o){const n=Math.floor(g);m(n),j(n.toString())}},[o,g]);const b=()=>{const n=parseInt(h,10);!isNaN(n)&&n>0&&(s(n),i())},p=n=>{n.key==="Enter"?b():n.key==="Escape"&&i()};return o?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-80",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"修改每周工作时间"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"每周工作时间（小时）"}),e.jsx("input",{type:"number",value:h,onChange:n=>j(n.target.value),onKeyDown:p,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"1",max:"168",placeholder:"输入每周工作时间",autoFocus:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:i,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"取消"}),e.jsx("button",{onClick:b,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"保存"})]})]})}):null},Ce=({onImport:o,className:i=""})=>{const g=c.useRef(null),s=()=>{const h=JSON.parse(localStorage.getItem("weeklyImportantTasks")||"{}"),j=JSON.parse(localStorage.getItem("quickTasks")||"{}"),b=JSON.parse(localStorage.getItem("taskTimeRecords")||"{}"),p=localStorage.getItem("totalWorkingHours")||"40",n={weeklyImportantTasks:h,quickTasks:j,taskTimeRecords:b,totalWorkingHours:parseInt(p,10),exportDate:new Date().toISOString(),version:"1.0"},$=JSON.stringify(n,null,2),F=new Blob([$],{type:"application/json"}),y=document.createElement("a");y.href=URL.createObjectURL(F),y.download=`life-system-data-${J(new Date,"yyyy-MM-dd-HHmm")}.json`,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(y.href)},u=h=>{const j=h.target.files[0];if(!j)return;const b=new FileReader;b.onload=p=>{try{const n=JSON.parse(p.target.result);if(!n.version){alert("无效的数据文件格式");return}n.weeklyImportantTasks&&localStorage.setItem("weeklyImportantTasks",JSON.stringify(n.weeklyImportantTasks)),n.quickTasks&&localStorage.setItem("quickTasks",JSON.stringify(n.quickTasks)),n.taskTimeRecords&&localStorage.setItem("taskTimeRecords",JSON.stringify(n.taskTimeRecords)),n.totalWorkingHours&&localStorage.setItem("totalWorkingHours",n.totalWorkingHours.toString()),o&&o(n),alert("数据导入成功！页面将刷新以加载新数据。"),window.location.reload()}catch(n){console.error("导入数据失败:",n),alert("导入数据失败，请检查文件格式是否正确")}},b.readAsText(j),h.target.value=""},m=()=>{var h;(h=g.current)==null||h.click()};return e.jsxs("div",{className:`flex items-center space-x-2 ${i}`,children:[e.jsxs("button",{onClick:s,className:"btn-secondary text-xs px-2 py-0.5 flex items-center space-x-1",title:"导出数据",children:[e.jsx(Le,{className:"w-3 h-3"}),e.jsx("span",{children:"导出"})]}),e.jsxs("button",{onClick:m,className:"btn-secondary text-xs px-2 py-0.5 flex items-center space-x-1",title:"导入数据",children:[e.jsx(_e,{className:"w-3 h-3"}),e.jsx("span",{children:"导入"})]}),e.jsx("input",{ref:g,type:"file",accept:".json",onChange:u,className:"hidden"})]})},gs=()=>{const[o,i]=c.useState([]),[g,s]=c.useState(!1),[u,m]=c.useState({title:"",date:"",color:"red"}),[h,j]=c.useState(null),[b,p]=c.useState([]),[n,$]=c.useState(!1),[F,y]=c.useState(null),[S,W]=c.useState({title:"",date:"",color:"red"});new Date().getFullYear();const I=new Date(2025,9,1),a=new Date,f=Array.from({length:13},(l,O)=>{const R=$e(I,O);return{date:R,name:J(R,"M月",{locale:ue}),fullName:J(R,"yyyy年M月",{locale:ue})}}),L=[{value:"red",name:"红色",class:"bg-red-500"},{value:"orange",name:"橙色",class:"bg-orange-500"},{value:"pink",name:"粉色",class:"bg-pink-500"},{value:"green",name:"绿色",class:"bg-green-500"},{value:"purple",name:"紫色",class:"bg-purple-500"},{value:"blue",name:"蓝色",class:"bg-blue-500"},{value:"yellow",name:"黄色",class:"bg-yellow-500"},{value:"indigo",name:"靛蓝色",class:"bg-indigo-500"}];c.useEffect(()=>{const l=localStorage.getItem("yearGoals");if(l)try{i(JSON.parse(l))}catch(O){console.error("Failed to parse yearGoals:",O)}},[]);const N=l=>{i(l),localStorage.setItem("yearGoals",JSON.stringify(l))},D=()=>{if(!u.title||!u.date)return;const l=se(u.date);if(!Oe(l))return;l<a&&($(!0),setTimeout(()=>$(!1),3e3));const R={id:Date.now().toString(),title:u.title,date:u.date,color:u.color},U=[...o,R].sort((Q,q)=>new Date(Q.date)-new Date(q.date));N(U),m({title:"",date:"",color:"red"}),s(!1)},H=(l,O)=>{O.stopPropagation(),N(o.filter(R=>R.id!==l))},z=(l,O)=>{O.stopPropagation(),y(l.id),W({title:l.title,date:l.date,color:l.color})},V=()=>{if(!S.title||!S.date)return;const l=se(S.date);if(!Oe(l))return;const O=o.map(R=>R.id===F?{...R,title:S.title,date:S.date,color:S.color}:R).sort((R,U)=>new Date(R.date)-new Date(U.date));N(O),y(null),W({title:"",date:"",color:"red"})},re=()=>{y(null),W({title:"",date:"",color:"red"})},A=l=>{const O=se(l),R=je(O,I),U=je($e(I,13),I);return R/U*100},Y=l=>{const O=se(l);return je(O,a)},B=l=>{const O=se(l);return ut(O,a)},ae=()=>o.filter(O=>Y(O.date)>0).sort((O,R)=>Y(O.date)-Y(R.date))[0],ne=l=>{const O=l.currentTarget.getBoundingClientRect(),R=l.clientX-O.left,U=R/O.width*100,Q=o.filter(q=>{const K=A(q.date);return Math.abs(K-U)<=3});Q.length>0?(j({x:R,goals:Q}),p(Q)):(j(null),p([]))};return ae(),e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg p-4 border border-purple-200 mb-4",children:[g&&e.jsxs("div",{className:"bg-white rounded border border-gray-200 p-3 mb-3",children:[n&&e.jsx("div",{className:"mb-2 p-2 bg-yellow-50 border border-yellow-200 rounded text-xs text-yellow-800",children:"⚠️ 注意：您选择的是过去的日期，目标已添加但显示为已过期状态"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsx("input",{type:"text",placeholder:"目标名称",value:u.title,onChange:l=>m({...u,title:l.target.value}),className:"col-span-2 text-xs px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-purple-500"}),e.jsx("input",{type:"date",value:u.date,onChange:l=>m({...u,date:l.target.value}),min:"1900-01-01",max:"2099-12-31",className:"text-xs px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-purple-500"}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("select",{value:u.color,onChange:l=>m({...u,color:l.target.value}),className:"flex-1 text-xs px-1 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-purple-500",children:L.map(l=>e.jsx("option",{value:l.value,children:l.name},l.value))}),e.jsx("button",{onClick:D,className:"text-xs bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600",children:"✓"}),e.jsx("button",{onClick:()=>s(!1),className:"text-xs bg-gray-500 text-white px-2 py-1 rounded hover:bg-gray-600",children:"✕"})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex justify-between items-center mb-2",children:f.map((l,O)=>e.jsx("div",{className:"text-xs text-gray-600 text-center",children:l.name},O))}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative h-6 bg-gray-100 rounded-full mb-2 cursor-pointer flex-1",onMouseMove:ne,onMouseLeave:()=>{j(null),p([])},children:[e.jsx("div",{className:"absolute top-0 w-0.5 h-full bg-red-500 rounded-full z-10",style:{left:`${A(J(a,"yyyy-MM-dd"))}%`},title:`今天 ${J(a,"M月d日")}`}),o.map(l=>{var K;const O=A(l.date),R=((K=L.find(E=>E.value===l.color))==null?void 0:K.class)||"bg-blue-500",U=Y(l.date),Q=U<0,q=b.some(E=>E.id===l.id);return e.jsx("div",{className:"absolute top-0 h-full flex items-center z-20",style:{left:`${O}%`},children:e.jsx("div",{className:`w-3 h-3 ${R} border-2 border-white cursor-pointer transition-all duration-200 ${Q?"opacity-50":""} ${q?"scale-125 shadow-lg":"hover:scale-110"}`,title:`${l.title} - ${J(se(l.date),"M月d日")} ${Q?"(已过期)":`(还有${U}天)`}`})},l.id)})]}),e.jsx("button",{onClick:()=>s(!g),className:"w-6 h-6 bg-purple-500 text-white rounded-full hover:bg-purple-600 transition-colors flex items-center justify-center flex-shrink-0 mb-2",title:"添加目标",children:e.jsx(it,{className:"w-3 h-3"})})]}),h&&b.length>0&&e.jsxs("div",{className:"absolute z-30 bg-white border border-gray-300 rounded-lg shadow-lg p-3 min-w-64",style:{left:`${Math.min(Math.max(h.x-128,0),400)}px`,top:"-120px"},children:[e.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-full",children:e.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-300"})}),e.jsx("div",{className:"space-y-2",children:b.map((l,O)=>{var K;const R=((K=L.find(E=>E.value===l.color))==null?void 0:K.class)||"bg-blue-500",U=Y(l.date),Q=B(l.date),q=U<0;return e.jsxs("div",{className:"flex items-center justify-between group",children:[e.jsxs("div",{className:"flex items-center space-x-2 flex-1",children:[e.jsx("div",{className:`w-2 h-2 ${R} flex-shrink-0`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:l.title}),e.jsxs("div",{className:"text-xs text-gray-500",children:[J(se(l.date),"yyyy年M月d日"),!q&&e.jsxs("span",{className:"ml-2 text-purple-600 font-medium",children:["还有 ",U," 天 (",Q," 周)"]}),q&&e.jsxs("span",{className:"ml-2 text-red-500",children:["已过期 ",Math.abs(U)," 天"]})]})]})]}),e.jsx("button",{onClick:E=>H(l.id,E),className:"opacity-0 group-hover:opacity-100 text-gray-400 hover:text-red-500 ml-2 transition-opacity",children:e.jsx(he,{className:"w-3 h-3"})})]},l.id)})})]}),o.length>0&&e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:o.sort((l,O)=>new Date(l.date)-new Date(O.date)).map(l=>{var q,K;const O=((q=L.find(E=>E.value===l.color))==null?void 0:q.class)||"bg-red-500",R=Y(l.date),U=R<0;return F===l.id?e.jsxs("div",{className:"flex items-center space-x-2 bg-blue-50 border border-blue-200 rounded px-2 py-1",children:[e.jsx("div",{className:`w-3 h-3 ${((K=L.find(E=>E.value===S.color))==null?void 0:K.class)||"bg-red-500"} flex-shrink-0`}),e.jsx("input",{type:"text",value:S.title,onChange:E=>W({...S,title:E.target.value}),className:"text-xs px-1 py-0.5 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 w-20",placeholder:"目标名称"}),e.jsx("input",{type:"date",value:S.date,onChange:E=>W({...S,date:E.target.value}),min:"1900-01-01",max:"2099-12-31",className:"text-xs px-1 py-0.5 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"}),e.jsx("select",{value:S.color,onChange:E=>W({...S,color:E.target.value}),className:"text-xs px-1 py-0.5 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",children:L.map(E=>e.jsx("option",{value:E.value,children:E.name},E.value))}),e.jsx("button",{onClick:V,className:"text-green-600 hover:text-green-800 transition-colors",title:"保存",children:e.jsx(ct,{className:"w-3 h-3"})}),e.jsx("button",{onClick:re,className:"text-gray-400 hover:text-red-500 transition-colors",title:"取消",children:e.jsx(he,{className:"w-3 h-3"})})]},l.id):e.jsxs("div",{className:`group flex items-center space-x-2 text-xs ${U?"opacity-50":""} hover:bg-gray-50 rounded px-2 py-1 transition-colors`,children:[e.jsx("div",{className:`w-3 h-3 ${O} flex-shrink-0`}),e.jsx("span",{className:"text-gray-700 font-medium",children:l.title}),e.jsx("span",{className:"text-gray-500",children:J(se(l.date),"M/d")}),!U&&e.jsxs("span",{className:"text-purple-600 font-medium",children:["(",R,"天)"]}),e.jsx("button",{onClick:E=>z(l,E),className:"opacity-0 group-hover:opacity-100 text-gray-400 hover:text-blue-500 ml-1 transition-opacity",title:"编辑目标",children:e.jsx(dt,{className:"w-3 h-3"})}),e.jsx("button",{onClick:E=>H(l.id,E),className:"opacity-0 group-hover:opacity-100 text-gray-400 hover:text-red-500 ml-1 transition-opacity",title:"删除目标",children:e.jsx(he,{className:"w-3 h-3"})})]},l.id)})})})]})]})},hs=({onRecover:o})=>{const[i,g]=c.useState("checking"),[s,u]=c.useState({}),[m,h]=c.useState(!1);c.useEffect(()=>{j()},[]);const j=()=>{g("checking");const y=localStorage.getItem("weeklyImportantTasks"),S=localStorage.getItem("quickTasks"),W=localStorage.getItem("taskTimeRecords"),I=localStorage.getItem("totalWorkingHours"),a=localStorage.getItem("yearGoals"),f={weeklyImportantTasks:y?JSON.parse(y):null,quickTasks:S?JSON.parse(S):null,taskTimeRecords:W?JSON.parse(W):null,totalWorkingHours:I?parseInt(I):null,yearGoals:a?JSON.parse(a):null};u(f);const L=f.weeklyImportantTasks&&Object.keys(f.weeklyImportantTasks).length>0,N=f.quickTasks&&Object.keys(f.quickTasks).length>0,D=f.taskTimeRecords&&Object.keys(f.taskTimeRecords).length>0,H=f.yearGoals&&f.yearGoals.length>0;g(L||N||D||H?"found":"empty")},b=()=>{let y=[];if(s.weeklyImportantTasks){const S=Object.keys(s.weeklyImportantTasks).length;S>0&&y.push(`${S}周的重要任务`)}if(s.quickTasks){const S=Object.keys(s.quickTasks).length;let W=0;Object.values(s.quickTasks).forEach(I=>{Object.values(I).forEach(a=>{W+=a.filter(f=>f.text||f.time).length})}),W>0&&y.push(`${S}天共${W}个任务`)}if(s.taskTimeRecords){const S=Object.keys(s.taskTimeRecords).length;S>0&&y.push(`${S}个时间记录`)}return s.yearGoals&&s.yearGoals.length>0&&y.push(`${s.yearGoals.length}个年度目标`),y},p=()=>{try{o&&o(s),alert("数据恢复成功！"),window.location.reload()}catch(y){console.error("恢复数据失败:",y),alert("恢复数据失败，请重试。")}},n=()=>{confirm("确定要清空所有数据重新开始吗？此操作不可恢复！")&&(localStorage.clear(),window.location.reload())},$=()=>{const y={...s,exportDate:new Date().toISOString(),version:"1.0"},S=JSON.stringify(y,null,2),W=new Blob([S],{type:"application/json"}),I=document.createElement("a");I.href=URL.createObjectURL(W),I.download=`backup-data-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(I.href)},F=()=>{const y=document.createElement("input");y.type="file",y.accept=".json",y.onchange=S=>{const W=S.target.files[0];if(W){const I=new FileReader;I.onload=a=>{try{const f=JSON.parse(a.target.result);o&&o(f),alert("数据导入成功！"),window.location.reload()}catch{alert("文件格式错误，请选择正确的备份文件")}},I.readAsText(W)}},y.click()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(mt,{className:"w-5 h-5 text-blue-500"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"数据管理中心"})]}),i==="checking"&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx(xt,{className:"w-8 h-8 animate-spin mx-auto mb-2 text-blue-500"}),e.jsx("p",{children:"正在扫描本地数据..."})]}),i==="found"&&e.jsxs("div",{children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Me,{className:"w-5 h-5 text-green-600"}),e.jsx("h4",{className:"font-medium text-green-800",children:"找到你的数据了！"})]}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("p",{className:"mb-2",children:"在本地存储中发现以下数据："}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:b().map((y,S)=>e.jsx("li",{children:y},S))})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:p,className:"w-full bg-blue-500 text-white px-4 py-3 rounded-lg hover:bg-blue-600 transition-colors flex items-center justify-center space-x-2 font-medium",children:[e.jsx(Me,{className:"w-4 h-4"}),e.jsx("span",{children:"恢复我的数据"})]}),e.jsxs("button",{onClick:$,className:"w-full bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors flex items-center justify-center space-x-2",children:[e.jsx(Le,{className:"w-4 h-4"}),e.jsx("span",{children:"先备份数据到文件"})]}),e.jsxs("button",{onClick:()=>h(!m),className:"w-full bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors",children:[m?"隐藏":"查看","数据详情"]}),m&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-xs space-y-2",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"重要任务:"})," ",s.weeklyImportantTasks?Object.keys(s.weeklyImportantTasks).length+"周":"无"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"日常任务:"})," ",s.quickTasks?Object.keys(s.quickTasks).length+"天":"无"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"时间记录:"})," ",s.taskTimeRecords?Object.keys(s.taskTimeRecords).length+"条":"无"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"年度目标:"})," ",s.yearGoals?s.yearGoals.length+"个":"无"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"工作时间设置:"})," ",s.totalWorkingHours||40,"小时/周"]})]}),e.jsx("div",{className:"border-t pt-3",children:e.jsx("button",{onClick:n,className:"w-full bg-red-100 text-red-600 px-4 py-2 rounded-lg hover:bg-red-200 transition-colors text-sm",children:"清空所有数据重新开始"})})]})]}),i==="empty"&&e.jsxs("div",{children:[e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(gt,{className:"w-5 h-5 text-yellow-600"}),e.jsx("h4",{className:"font-medium text-yellow-800",children:"没有找到数据"})]}),e.jsx("p",{className:"text-sm text-yellow-700",children:"本地存储中没有发现任何数据。如果你之前有数据，可能是因为："}),e.jsxs("ul",{className:"list-disc list-inside text-sm text-yellow-700 mt-2 space-y-1",children:[e.jsx("li",{children:"浏览器缓存被清理"}),e.jsx("li",{children:"使用了隐私模式"}),e.jsx("li",{children:"更换了浏览器或设备"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("h5",{className:"font-medium text-blue-800 mb-2",children:"如果你有备份文件："}),e.jsx("p",{className:"text-sm text-blue-700 mb-2",children:'点击下面的"导入数据"按钮，选择之前导出的JSON文件'}),e.jsxs("button",{onClick:F,className:"w-full bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors flex items-center justify-center space-x-2",children:[e.jsx(_e,{className:"w-4 h-4"}),e.jsx("span",{children:"导入备份数据"})]})]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"w-full bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors",children:"开始使用（创建新数据）"})]})]})]})})},ps="https://your-tencent-cloud-api.com/api",ie=async(o,i={})=>{try{const g=`${ps}${o}`,s=localStorage.getItem("schedule_token"),u={headers:{"Content-Type":"application/json",...s&&{Authorization:`Bearer ${s}`},...i.headers}},m=await fetch(g,{...u,...i});if(m.status===401){localStorage.removeItem("schedule_token"),window.location.href="/login";return}if(!m.ok){const h=await m.json().catch(()=>({message:"Unknown error"}));throw new Error(h.message||`API error: ${m.status}`)}return await m.json()}catch(g){throw console.error("API request failed:",g),g}},we={getAllData:async()=>ie("/schedule"),saveAllData:async o=>ie("/schedule",{method:"POST",body:JSON.stringify(o)}),updateDayTasks:async(o,i)=>ie(`/schedule/day/${o}`,{method:"PUT",body:JSON.stringify({tasks:i})}),updateImportantTasks:async o=>ie("/schedule/important",{method:"PUT",body:JSON.stringify({tasks:o})}),updateQuickTasks:async(o,i)=>ie(`/schedule/quick/${o}`,{method:"PUT",body:JSON.stringify({quickTasks:i})}),updateTimeRecords:async o=>ie("/schedule/time-records",{method:"PUT",body:JSON.stringify({timeRecords:o})})},X={TASKS:"schedule_tasks",WEEKLY_IMPORTANT_TASKS:"schedule_weekly_important_tasks",QUICK_TASKS:"schedule_quick_tasks",TIME_RECORDS:"schedule_time_records",TOTAL_WORKING_HOURS:"schedule_total_working_hours",LAST_SYNC:"schedule_last_sync"},fs=()=>{const[o,i]=c.useState(navigator.onLine),[g,s]=c.useState(!1),[u,m]=c.useState(()=>{const a=localStorage.getItem(X.LAST_SYNC);return a?new Date(parseInt(a)):null}),[h,j]=c.useState(null),b=c.useRef(null),p=c.useRef(!1);c.useEffect(()=>{const a=()=>{i(!0),p.current&&y()},f=()=>{i(!1)};return window.addEventListener("online",a),window.addEventListener("offline",f),()=>{window.removeEventListener("online",a),window.removeEventListener("offline",f)}},[]);const n=c.useCallback(()=>{try{const a=JSON.parse(localStorage.getItem(X.TASKS)||"[]"),f=JSON.parse(localStorage.getItem(X.WEEKLY_IMPORTANT_TASKS)||"{}"),L=JSON.parse(localStorage.getItem(X.QUICK_TASKS)||"{}"),N=JSON.parse(localStorage.getItem(X.TIME_RECORDS)||"{}");return{tasks:a,weeklyImportantTasks:f,quickTasks:L,timeRecords:N}}catch(a){return console.error("Failed to load data from localStorage:",a),{tasks:[],weeklyImportantTasks:{},quickTasks:{},timeRecords:{}}}},[]),$=c.useCallback(a=>{try{a.tasks&&localStorage.setItem(X.TASKS,JSON.stringify(a.tasks)),a.weeklyImportantTasks&&localStorage.setItem(X.WEEKLY_IMPORTANT_TASKS,JSON.stringify(a.weeklyImportantTasks)),a.quickTasks&&localStorage.setItem(X.QUICK_TASKS,JSON.stringify(a.quickTasks)),a.timeRecords&&localStorage.setItem(X.TIME_RECORDS,JSON.stringify(a.timeRecords)),a.totalWorkingHours!==void 0&&localStorage.setItem(X.TOTAL_WORKING_HOURS,a.totalWorkingHours.toString())}catch(f){console.error("Failed to save data to localStorage:",f)}},[]),F=c.useCallback(async()=>{if(!o)return n();try{s(!0),j(null);const a=await we.getAllData();$(a);const f=new Date;return m(f),localStorage.setItem(X.LAST_SYNC,f.getTime().toString()),a}catch(a){return console.error("Failed to load data from server:",a),j(a.message),n()}finally{s(!1)}},[o,n,$]),y=c.useCallback(async(a=null)=>{if(!o)return p.current=!0,a&&$(a),!1;try{s(!0),j(null),a||(a=n()),await we.saveAllData(a);const f=new Date;return m(f),localStorage.setItem(X.LAST_SYNC,f.getTime().toString()),p.current=!1,!0}catch(f){return console.error("Failed to sync data to server:",f),j(f.message),p.current=!0,a&&$(a),!1}finally{s(!1)}},[o,n,$]),S=c.useCallback(()=>{b.current&&clearTimeout(b.current),b.current=setTimeout(()=>{y(),S()},5*60*1e3)},[y]);c.useEffect(()=>(S(),()=>{b.current&&clearTimeout(b.current)}),[S]);const W=c.useCallback(async a=>{if(!o)return p.current=!0,localStorage.setItem(X.TASKS,JSON.stringify(a)),!1;try{return await we.saveAllData({tasks:a}),!0}catch(f){return console.error("Failed to sync tasks:",f),j(f.message),p.current=!0,localStorage.setItem(X.TASKS,JSON.stringify(a)),!1}},[o]),I=c.useCallback(()=>y(),[y]);return{isOnline:o,isSyncing:g,lastSyncTime:u,syncError:h,loadFromServer:F,loadFromLocalStorage:n,saveToLocalStorage:$,syncToServer:y,syncTasks:W,forceSync:I}},Ae=({tasks:o,onAddTask:i,onUpdateTask:g,currentView:s,onViewChange:u})=>{const[h,j]=c.useState(new Date),[b,p]=c.useState({}),[n,$]=c.useState({}),[F,y]=c.useState(null),[S,W]=c.useState(null),[I,a]=c.useState(null),[f,L]=c.useState({}),[N,D]=c.useState(null),[H,z]=c.useState(!1),[V,re]=c.useState(!1),[A,Y]=c.useState(40),[B,ae]=c.useState(null),[ne,l]=c.useState(!1),O=()=>{const t=Ne(h,{weekStartsOn:1});return J(t,"yyyy-MM-dd")},R=()=>{const t=O();return!b[t]||b[t].length===0?[{id:"important-1",text:""},{id:"important-2",text:""},{id:"important-3",text:""}]:b[t]},U=t=>{Y(t),localStorage.setItem("totalWorkingHours",t.toString())},Q=t=>{t.weeklyImportantTasks&&p(t.weeklyImportantTasks),t.quickTasks&&$(t.quickTasks),t.totalWorkingHours&&Y(t.totalWorkingHours)},q=(t,r=!1)=>({red:r?"rgba(239, 68, 68, 0.1)":"rgba(239, 68, 68, 0.2)",orange:r?"rgba(249, 115, 22, 0.1)":"rgba(249, 115, 22, 0.2)",pink:r?"rgba(236, 72, 153, 0.1)":"rgba(236, 72, 153, 0.2)",green:r?"rgba(34, 197, 94, 0.1)":"rgba(34, 197, 94, 0.2)",purple:r?"rgba(168, 85, 247, 0.1)":"rgba(168, 85, 247, 0.2)",blue:r?"rgba(59, 130, 246, 0.1)":"rgba(59, 130, 246, 0.2)",yellow:r?"rgba(234, 179, 8, 0.1)":"rgba(234, 179, 8, 0.2)",indigo:r?"rgba(99, 102, 241, 0.1)":"rgba(99, 102, 241, 0.2)",tencent:r?"rgba(0, 102, 255, 0.1)":"rgba(0, 102, 255, 0.2)"})[t]||"transparent",K=Ne(h,{weekStartsOn:1}),E=Array.from({length:7},(t,r)=>ke(K,r)),be=[{id:"morning",name:"早上",time:"06:00-12:00",color:"bg-yellow-50 border-yellow-200"},{id:"noon",name:"中午",time:"12:00-14:00",color:"bg-orange-50 border-orange-200"},{id:"afternoon",name:"下午",time:"14:00-18:00",color:"bg-blue-50 border-blue-200"},{id:"evening",name:"晚上",time:"18:00-24:00",color:"bg-purple-50 border-purple-200"}];c.useEffect(()=>{const t=localStorage.getItem("weeklyImportantTasks");if(t)try{p(JSON.parse(t))}catch(v){console.error("Failed to parse weeklyImportantTasks:",v)}const r=localStorage.getItem("quickTasks");if(r)try{$(JSON.parse(r))}catch(v){console.error("Failed to parse quickTasks:",v)}const x=localStorage.getItem("taskTimeRecords");if(x)try{L(JSON.parse(x))}catch(v){console.error("Failed to parse taskTimeRecords:",v)}const w=localStorage.getItem("totalWorkingHours");w&&Y(parseInt(w,10)),z(!0)},[]),c.useEffect(()=>{if(!H)return;const t={...n};E.forEach(r=>{const x=J(r,"yyyy-MM-dd");t[x]||(t[x]={}),be.forEach(w=>{(!t[x][w.id]||t[x][w.id].length===0)&&(t[x][w.id]=[{id:`${x}-${w.id}-${Date.now()}-0`,text:"",time:"",color:"",completed:!1}])})}),JSON.stringify(t)!==JSON.stringify(n)&&$(t)},[h,H,n]),c.useEffect(()=>{const t=r=>{r.key==="Escape"&&(D(null),a(null))};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[]);const oe=c.useRef(!1),_=c.useRef(null);c.useRef(null);const Ue=(t,r)=>{const x=O(),v=R().map((T,C)=>C===t?{...T,text:r}:T);p(T=>({...T,[x]:v})),localStorage.setItem("weeklyImportantTasks",JSON.stringify({...b,[x]:v}))},ye=(t,r,x,w,v)=>{const T={...n,[t]:{...n[t],[r]:n[t][r].map((P,M)=>M===x?{...P,[w]:v}:P)}},C=T[t][r],k=x===C.length-1,d=C[x],G=d.text||d.time;k&&G&&(T[t][r]=[...C,{id:`${t}-${r}-${Date.now()}`,text:"",time:"",color:"",completed:!1}]),$(T),localStorage.setItem("quickTasks",JSON.stringify(T)),localStorage.setItem("weeklyImportantTasks",JSON.stringify(b))},Ve=(t,r,x)=>{const v=n[t][r].filter((C,k)=>k!==x);(v.length===0||v.every(C=>C.text||C.time))&&v.push({id:`${t}-${r}-${Date.now()}`,text:"",time:"",color:"",completed:!1});const T={...n,[t]:{...n[t],[r]:v}};$(T),localStorage.setItem("quickTasks",JSON.stringify(T)),localStorage.setItem("weeklyImportantTasks",JSON.stringify(b))},ze=(t,r,x,w)=>{const v=n[t][r][x],T=v.completed,C={...n,[t]:{...n[t],[r]:n[t][r].map((k,d)=>d===x?{...k,completed:!k.completed}:k)}};if($(C),localStorage.setItem("quickTasks",JSON.stringify(C)),!T&&w){const k=w.target.getBoundingClientRect(),d=r==="evening"?-35:25;a({taskId:v.id,x:k.left-10,y:k.top+d,dayKey:t,slotId:r,taskIndex:x,taskColor:v.color||"green"})}},Ye=(t,r,x,w)=>{const v=n[r][x][w];!v.text&&!v.time||(y({task:v,sourceDayKey:r,sourceSlotId:x,sourceTaskIndex:w}),t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",""),t.target.style.opacity="0.5")},Be=t=>{t.target.style.opacity="1"},Qe=(t,r,x)=>{t.preventDefault(),t.dataTransfer.dropEffect="move",W(`${r}-${x}`)},Ke=()=>{W(null)},Xe=(t,r,x)=>{var ge;if(t.preventDefault(),W(null),!F)return;const{task:w,sourceDayKey:v,sourceSlotId:T,sourceTaskIndex:C}=F;if(v===r&&T===x){y(null);return}const k={...w,id:`${r}-${x}-${Date.now()}`,completed:!1},d=n[v][T].filter((le,rt)=>rt!==C);(d.length===0||d.every(le=>le.text||le.time))&&d.push({id:`${v}-${T}-${Date.now()}-empty`,text:"",time:"",color:"",completed:!1});const G=((ge=n[r])==null?void 0:ge[x])||[],P=G.findLastIndex(le=>le.text||le.time),M=P>=0?P+1:0,Z=[...G];Z.splice(M,0,k);const te={...n,[v]:{...n[v],[T]:d},[r]:{...n[r],[x]:Z}};$(te),localStorage.setItem("quickTasks",JSON.stringify(te)),y(null)},qe=(t,r)=>o.filter(x=>{if(!De(new Date(x.date),t))return!1;const w=x.time;if(!w)return!1;const v=parseInt(w.split(":")[0]);switch(r){case"morning":return v>=6&&v<12;case"noon":return v>=12&&v<14;case"afternoon":return v>=14&&v<18;case"evening":return v>=18||v<6;default:return!1}}),me=(t,r)=>{const x={...f,[t]:(f[t]||0)+r};L(x),a(null),localStorage.setItem("taskTimeRecords",JSON.stringify(x))},Ze=t=>{const r={...f};delete r[t],L(r),a(null),localStorage.setItem("taskTimeRecords",JSON.stringify(r))},et=(t,r,x)=>{const v={...n[t][r][x],id:`${t}-${r}-${Date.now()}-copy`,completed:!1},T={...n,[t]:{...n[t],[r]:[...n[t][r],v]}};$(T),localStorage.setItem("quickTasks",JSON.stringify(T)),D(null)},xe=t=>{const r={red:{bg:"bg-red-500",border:"border-red-500",hover:"hover:bg-red-50",text:"text-red-500"},orange:{bg:"bg-orange-500",border:"border-orange-500",hover:"hover:bg-orange-50",text:"text-orange-500"},pink:{bg:"bg-pink-500",border:"border-pink-500",hover:"hover:bg-pink-50",text:"text-pink-500"},green:{bg:"bg-green-500",border:"border-green-500",hover:"hover:bg-green-50",text:"text-green-500"},purple:{bg:"bg-purple-500",border:"border-purple-500",hover:"hover:bg-purple-50",text:"text-purple-500"},blue:{bg:"bg-blue-500",border:"border-blue-500",hover:"hover:bg-blue-50",text:"text-blue-500"},yellow:{bg:"bg-yellow-500",border:"border-yellow-500",hover:"hover:bg-yellow-50",text:"text-yellow-500"},indigo:{bg:"bg-indigo-500",border:"border-indigo-500",hover:"hover:bg-indigo-50",text:"text-indigo-500"},tencent:{bg:"bg-[#0066FF]",border:"border-[#0066FF]",hover:"hover:bg-[#f0f7ff]",text:"text-[#0066FF]"}};return!t||typeof t!="string"?r.green:r[t]||r.green},ee=t=>f[t]||0,tt=t=>{if(t<60)return`${t}分钟`;const r=Math.floor(t/60),x=t%60;return x>0?`${r}小时${x}分钟`:`${r}小时`},st=()=>{const t={},r={};E.forEach(T=>{const C=J(T,"yyyy-MM-dd");be.forEach(k=>{var G;(((G=n[C])==null?void 0:G[k.id])||[]).forEach(P=>{if(P.color&&(P.text||P.time))if(P.completed){const M=ee(P.id),Z=M>0?M/60:.5;r[P.color]=(r[P.color]||0)+Z}else t[P.color]=(t[P.color]||0)+1})})});const x=["red","orange","pink","green","purple","blue","yellow","indigo","tencent"],w={},v={};return x.forEach(T=>{t[T]&&(w[T]=t[T]),r[T]&&(v[T]=r[T])}),{plannedColorStats:w,actualColorStats:v,totalWorkingHours:A}};return e.jsxs("div",{className:"space-y-3",onClick:()=>{D(null),ae(null)},children:[ne&&e.jsx(hs,{onRecover:t=>{Q(t),l(!1)}}),e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"人生系统设计"}),e.jsxs("p",{className:"text-gray-500 text-sm",children:[J(K,"yyyy年MM月dd日",{locale:ue})," - ",J(ke(K,6),"MM月dd日",{locale:ue})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center space-x-1 text-green-500",children:[e.jsx(ht,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs text-green-500",children:"已同步"})]}),null]}),e.jsx(Te,{currentView:s,onViewChange:u}),e.jsx(Ce,{onImport:Q}),e.jsx("button",{onClick:()=>l(!0),className:"btn-secondary text-xs px-2 py-0.5 text-blue-600 hover:text-blue-700",title:"数据管理：备份、恢复、导入导出",children:"数据管理"}),e.jsx("button",{onClick:()=>j(new Date),className:"btn-secondary text-xs px-2 py-0.5",children:"本周"})]})]}),e.jsx(gs,{}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg px-4 py-2 border border-blue-200",children:e.jsx("div",{className:"flex items-center gap-3",children:R().map((t,r)=>e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex bg-white rounded border border-blue-200 focus-within:ring-1 focus-within:ring-blue-500 focus-within:border-transparent transition-all overflow-hidden",children:[e.jsxs("div",{className:"bg-yellow-400 text-white px-2 py-1.5 text-xs font-bold flex items-center justify-center min-w-10",children:["TOP",r+1]}),e.jsx("input",{type:"text",value:t.text,onChange:x=>Ue(r,x.target.value),className:"flex-1 px-2 py-1.5 text-sm bg-transparent border-none focus:outline-none"})]})},t.id))})}),e.jsxs("div",{className:"flex bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden w-full",children:[e.jsxs("div",{className:"flex-1 min-w-0 w-full",children:[e.jsxs("div",{className:"grid border-b border-gray-200",style:{gridTemplateColumns:"100px repeat(7, 1fr)"},children:[e.jsxs("div",{className:"p-2 bg-gray-50 font-medium text-gray-900 text-lg border-r border-gray-200 flex items-center justify-center h-full",children:[J(h,"MM"),"月"]}),E.map((t,r)=>{const x=De(t,new Date),w=r===5||r===6;return e.jsx("div",{className:`p-2 text-center font-medium border-l border-gray-200 ${x?"bg-blue-50 text-blue-900":w?"bg-gray-100 text-gray-700":"bg-gray-50 text-gray-900"}`,children:e.jsxs("div",{className:"flex items-center justify-center space-x-1 text-sm",children:[e.jsx("span",{className:`text-lg font-bold ${x?"text-blue-600":""}`,children:J(t,"dd")}),e.jsx("span",{className:"text-gray-400 text-xs",children:"·"}),e.jsx("span",{className:"text-gray-600 text-xs",children:["一","二","三","四","五","六","日"][r]})]})},t.toString())})]}),be.map(t=>e.jsxs("div",{className:"grid border-b border-gray-200 min-h-24",style:{gridTemplateColumns:"100px repeat(7, 1fr)"},children:[e.jsx("div",{className:`p-2 ${t.color} border-r border-gray-200 flex flex-col justify-center items-center`,children:e.jsx("div",{className:"font-medium text-gray-900 text-sm",children:t.name})}),E.map((r,x)=>{var k;const w=J(r,"yyyy-MM-dd"),v=qe(r,t.id),T=((k=n[w])==null?void 0:k[t.id])||[],C=x===5||x===6;return e.jsxs("div",{className:`p-2 border-l border-gray-200 space-y-1 min-h-24 overflow-hidden relative ${C?"bg-gray-25":""} ${S===`${w}-${t.id}`?"bg-blue-100 border-blue-400 border-2 border-dashed":""} ${F?"transition-all duration-200":""} ${F&&S!==`${w}-${t.id}`?"hover:bg-blue-50 hover:border-blue-200 hover:border-dashed":""}`,style:C?{backgroundColor:"#fafafa"}:{},onDragOver:d=>Qe(d,w,t.id),onDragLeave:Ke,onDrop:d=>Xe(d,w,t.id),children:[v.map(d=>e.jsxs("div",{className:"text-xs p-2 bg-blue-100 text-blue-800 rounded border border-blue-200 cursor-pointer hover:bg-blue-200 transition-colors",onClick:()=>g(d.id,d),children:[e.jsx("div",{className:"font-medium break-words overflow-hidden text-ellipsis",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:d.title}),d.time&&e.jsx("div",{className:"text-blue-600 mt-0.5",children:d.time})]},d.id)),T.map((d,G)=>{const P=d.text||d.time;return e.jsxs("div",{className:`flex items-center mb-1 group rounded p-1 ${P?"cursor-move hover:shadow-sm hover:bg-gray-50":""} ${B&&d.color===B?`ring-2 ring-opacity-50 ${xe(B).text.replace("text-","ring-")}`:d.completed?"opacity-60":""} ${F&&F.task.id===d.id?"opacity-50":""}`,draggable:P,onDragStart:M=>Ye(M,w,t.id,G),onDragEnd:Be,title:P?"拖拽任务到其他时间段":"",onContextMenu:M=>{P&&(M.preventDefault(),D({taskId:d.id,x:M.clientX,y:M.clientY,dayKey:w,slotId:t.id,taskIndex:G,taskData:d}))},style:{backgroundColor:d.time&&d.color?q(d.color,B&&d.color===B?!1:d.completed):"transparent",position:"relative",transition:"all 0.2s ease"},children:[P&&e.jsx("div",{className:"relative mr-1 flex-shrink-0",children:e.jsx("input",{type:"checkbox",checked:d.completed||!1,onChange:M=>{M.stopPropagation(),D(null),ze(w,t.id,G,M)},onMouseEnter:M=>{if(d.completed){_.current&&(clearTimeout(_.current),_.current=null),oe.current=!0;const Z=M.currentTarget.getBoundingClientRect(),te=t.id==="evening"?-35:25;a({taskId:d.id,x:Z.left-10,y:Z.top+te,dayKey:w,slotId:t.id,taskIndex:G,taskColor:d.color||"green"})}},onMouseLeave:()=>{oe.current=!1,_.current=setTimeout(()=>{oe.current||a(null)},300)},className:`w-3 h-3 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 cursor-pointer z-10 ${d.completed?"opacity-80":""}`,title:d.completed?"悬停记录用时":"点击完成任务"})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ms,{value:d.time,color:d.color,completed:d.completed,onChange:M=>ye(w,t.id,G,"time",M),onColorChange:M=>ye(w,t.id,G,"color",M)})}),!d.time&&e.jsx("div",{className:`w-px h-4 ml-1 mr-2 flex-shrink-0 ${d.completed?"bg-gray-300":"bg-gray-200"}`}),e.jsx("div",{className:"flex-1 flex items-start overflow-hidden",children:e.jsx("textarea",{value:d.text,onChange:M=>{ye(w,t.id,G,"text",M.target.value)},className:`flex-1 text-xs p-1 border-none focus:outline-none bg-transparent resize-none overflow-hidden break-words ${B&&d.color===B?"text-gray-700":d.completed?"line-through text-gray-500":"text-gray-700"}`,onClick:M=>M.stopPropagation(),rows:1,style:{minHeight:"20px",maxHeight:"60px",width:"100%",boxSizing:"border-box"},onInput:M=>{M.target.style.height="auto",M.target.style.height=`${M.target.scrollHeight}px`}})}),B&&d.color===B&&ee(d.id)>0&&e.jsx("div",{className:"absolute right-1 top-1/2 transform -translate-y-1/2 text-xs font-medium text-gray-700 bg-white bg-opacity-80 px-1 rounded",children:ee(d.id)>=60?`${(ee(d.id)/60).toFixed(ee(d.id)%60===0?0:1)}h`:`${ee(d.id)}m`})]},d.id)})]},`${w}-${t.id}`)})]},t.id))]}),e.jsxs("div",{className:"w-8 border-l border-gray-200 flex flex-col",children:[e.jsx("div",{className:"flex-1 bg-gray-50 hover:bg-blue-50 cursor-pointer flex items-center justify-center group transition-colors border-b border-gray-200",onClick:()=>j(ft(h,1)),title:"上一周",children:e.jsx(pt,{className:"w-4 h-4 text-gray-400 group-hover:text-blue-600"})}),e.jsx("div",{className:"flex-1 bg-gray-50 hover:bg-blue-50 cursor-pointer flex items-center justify-center group transition-colors",onClick:()=>j(He(h,1)),title:"下一周",children:e.jsx(bt,{className:"w-4 h-4 text-gray-400 group-hover:text-blue-600"})})]})]}),I&&(()=>{const t=xe(I.taskColor),r=240,x=100,w=typeof window<"u"?window.innerWidth:1920,v=typeof window<"u"?window.innerHeight:1080,T=Math.max(10,Math.min(I.x,w-r-10)),C=Math.max(10,Math.min(I.y,v-x-10));return e.jsxs("div",{className:"time-tracking-popup fixed bg-white border border-gray-200 rounded shadow-lg p-2 z-[9999]",style:{left:`${T}px`,top:`${C}px`},onMouseEnter:()=>{_.current&&(clearTimeout(_.current),_.current=null),oe.current=!0},onMouseLeave:()=>{oe.current=!1,_.current=setTimeout(()=>{oe.current||a(null)},200)},children:[e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{onClick:k=>{k.preventDefault(),k.stopPropagation(),_.current&&(clearTimeout(_.current),_.current=null),me(I.taskId,30)},className:`flex items-center justify-center w-6 h-6 ${t.hover} rounded`,title:"30分钟",children:e.jsx("div",{className:`w-3 h-3 border ${t.border} rounded-full relative`,children:e.jsx("div",{className:`absolute inset-0 ${t.bg} rounded-full`,style:{clipPath:"polygon(50% 0%, 100% 0%, 100% 100%, 50% 100%)"}})})}),e.jsx("button",{onClick:k=>{k.preventDefault(),k.stopPropagation(),_.current&&(clearTimeout(_.current),_.current=null),me(I.taskId,60)},className:`flex items-center justify-center w-6 h-6 ${t.hover} rounded`,title:"1小时",children:e.jsx("div",{className:`w-3 h-3 ${t.bg} rounded-full`})}),e.jsx("button",{onClick:k=>{k.preventDefault(),k.stopPropagation(),_.current&&(clearTimeout(_.current),_.current=null),me(I.taskId,120)},className:`flex items-center justify-center w-6 h-6 ${t.hover} rounded`,title:"2小时",children:e.jsxs("div",{className:"flex space-x-0.5",children:[e.jsx("div",{className:`w-2 h-2 ${t.bg} rounded-full`}),e.jsx("div",{className:`w-2 h-2 ${t.bg} rounded-full`})]})}),e.jsx("button",{onClick:k=>{k.preventDefault(),k.stopPropagation(),_.current&&(clearTimeout(_.current),_.current=null),me(I.taskId,180)},className:`flex items-center justify-center w-6 h-6 ${t.hover} rounded`,title:"3小时",children:e.jsxs("div",{className:"flex space-x-0.5",children:[e.jsx("div",{className:`w-1.5 h-1.5 ${t.bg} rounded-full`}),e.jsx("div",{className:`w-1.5 h-1.5 ${t.bg} rounded-full`}),e.jsx("div",{className:`w-1.5 h-1.5 ${t.bg} rounded-full`})]})}),ee(I.taskId)>0&&e.jsx("button",{onClick:k=>{k.preventDefault(),k.stopPropagation(),_.current&&(clearTimeout(_.current),_.current=null),Ze(I.taskId)},className:"flex items-center justify-center w-6 h-6 hover:bg-red-50 rounded border border-red-200",title:"清空时间记录",children:e.jsx("svg",{className:"w-3 h-3 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),ee(I.taskId)>0&&e.jsx("div",{className:"mt-1 pt-1 border-t border-gray-200 text-xs text-gray-500 text-center",children:tt(ee(I.taskId))})]})})(),N&&(()=>{const x=typeof window<"u"?window.innerWidth:1920,w=typeof window<"u"?window.innerHeight:1080,v=x-120,T=w-60,C=Math.min(N.x,v),k=Math.min(N.y,T);return e.jsx("div",{className:"fixed bg-white border border-gray-200 rounded shadow-lg p-2 z-50",style:{left:`${C}px`,top:`${k}px`},onClick:d=>d.stopPropagation(),children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>et(N.dayKey,N.slotId,N.taskIndex),className:"flex items-center space-x-1 px-2 py-1 text-xs bg-blue-50 text-blue-600 rounded hover:bg-blue-100 transition-colors",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),e.jsx("span",{children:"复制"})]}),e.jsxs("button",{onClick:()=>{Ve(N.dayKey,N.slotId,N.taskIndex),D(null)},className:"flex items-center space-x-1 px-2 py-1 text-xs bg-red-50 text-red-600 rounded hover:bg-red-100 transition-colors",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),e.jsx("span",{children:"删除"})]})]})})})(),(()=>{const{plannedColorStats:t,actualColorStats:r}=st(),x=new Set([...Object.keys(t),...Object.keys(r)]),w=Object.values(t).reduce((C,k)=>C+k,0),v=Object.values(r).reduce((C,k)=>C+k,0),T=w+v;return e.jsxs("div",{className:"mt-4 bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"本周时间分配"}),e.jsxs("div",{className:"text-xs text-gray-500 cursor-pointer hover:text-blue-600 hover:underline",onClick:()=>re(!0),title:"点击修改总工作时间",children:["计划: ",w.toFixed(1),"h | 完成: ",v.toFixed(1),"h | 总计: ",A,"h (",(T/A*100).toFixed(1),"%)"]})]}),e.jsxs("div",{className:"flex h-6 bg-gray-100 rounded overflow-hidden",children:[Array.from(x).map(C=>{const k=t[C]||0,d=r[C]||0,G=k+d,P=G/A*100,M=d/A*100,Z=k/A*100,te=xe(C||"gray"),ge={red:"Meeting",orange:"Think",pink:"Interview",green:"Run",purple:"Coach",blue:"English",yellow:"XinLi",indigo:"Book",tencent:"Free"};return e.jsxs("div",{className:"relative flex items-center justify-center text-white text-xs font-medium cursor-pointer hover:opacity-80 transition-opacity",style:{width:`${P}%`},title:`${ge[C]}: 计划${k.toFixed(1)}h + 完成${d.toFixed(1)}h = ${G.toFixed(1)}h (${P.toFixed(1)}%)`,onMouseEnter:()=>ae(C),onMouseLeave:()=>ae(null),children:[d>0&&e.jsx("div",{className:`absolute left-0 top-0 h-full ${te.bg}`,style:{width:`${M/P*100}%`}}),k>0&&e.jsx("div",{className:`absolute right-0 top-0 h-full ${te.bg} opacity-40`,style:{width:`${Z/P*100}%`}}),e.jsx("span",{className:"relative z-10",children:P>=5?`${G.toFixed(1)}h`:""})]},C)}),T<A&&e.jsx("div",{className:"bg-gray-200 flex items-center justify-center text-gray-500 text-xs",style:{width:`${(A-T)/A*100}%`},title:`剩余: ${(A-T).toFixed(1)}小时 (${((A-T)/A*100).toFixed(1)}%)`,children:(A-T)/A>=.05?`${(A-T).toFixed(1)}h`:""})]}),e.jsx("div",{className:"flex flex-wrap gap-3 mt-3 text-xs",children:Array.from(x).map(C=>{const k=t[C]||0,d=r[C]||0,P=(k+d)/A*100,M=xe(C),Z=C?M.text.replace("bg-","text-"):"text-gray-600",te={red:"Meeting",orange:"Think",pink:"Interview",green:"Run",purple:"Coach",blue:"English",yellow:"XinLi",indigo:"Book",tencent:"Free"};return e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-3 h-3 ${M.bg} rounded`}),k>0&&e.jsx("div",{className:`w-3 h-3 ${M.bg} opacity-40 rounded ml-0.5`})]}),e.jsxs("span",{className:"text-gray-600",children:[te[C],":",d>0&&e.jsxs("span",{className:"font-medium",children:[" 完成",d.toFixed(1),"h"]}),k>0&&e.jsxs("span",{className:"text-gray-500",children:[" 计划",k.toFixed(1),"h"]}),e.jsxs("span",{className:`font-bold ${Z}`,children:[" (",P.toFixed(1),"%)"]})]})]},C)})})]})})(),F&&e.jsxs("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-blue-500 text-white px-4 py-2 rounded-lg text-sm z-50 shadow-lg flex items-center space-x-2",children:[e.jsx("span",{children:"🚀"}),e.jsxs("span",{children:["正在移动任务: ",F.task.text||F.task.time||"未命名任务"]}),e.jsx("span",{className:"text-blue-200 text-xs",children:"拖拽到目标时间段"})]}),e.jsx(xs,{isOpen:V,onClose:()=>re(!1),totalTime:A,onSave:U})]})},bs=({currentView:o,onViewChange:i})=>{const[g,s]=c.useState(new Date),u=new Date,[m,h]=c.useState([u.getMonth()]),{loadFromServer:j,loadFromLocalStorage:b}=fs(),[p,n]=c.useState({});c.useEffect(()=>{(async()=>{try{const D=await j();D.weeklyImportantTasks&&n(D.weeklyImportantTasks)}catch(D){console.error("Failed to initialize data:",D);const H=b();H.weeklyImportantTasks&&n(H.weeklyImportantTasks)}})()},[j,b]);const $=N=>{N.weeklyImportantTasks&&n(N.weeklyImportantTasks)},F=N=>{const D=new Date(N,0,1),H=new Date(N,11,31),z=[];let V=Ne(D,{weekStartsOn:1});for(;V<=H;)z.push(new Date(V)),V=He(V,1);return z},y=N=>{const D=F(N),H=[];for(let z=0;z<12;z++){const V=new Date(N,z,1),re=wt(V),A=D.filter(Y=>ke(Y,6)>=V&&Y<=re);H.push({month:z,monthName:J(V,"MMMM",{locale:ue}),weeks:A})}return H},S=N=>{const D=J(N,"yyyy-MM-dd");return p[D]||[{id:"important-1",text:""},{id:"important-2",text:""},{id:"important-3",text:""}]},W=N=>{h(D=>D.includes(N)?D.filter(H=>H!==N):[...D,N])},I=()=>{const N=y(g.getFullYear());h(N.map((D,H)=>H))},a=()=>{h([])},f=y(g.getFullYear()),L=new Date().getMonth();return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"人生系统设计"}),e.jsxs("p",{className:"text-gray-500 text-sm",children:[g.getFullYear(),"年全年视图"]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Te,{currentView:o,onViewChange:i}),e.jsx(Ce,{onImport:$})]})]}),e.jsxs("div",{className:"p-4 bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>s(N=>new Date(N.getFullYear()-1,0,1)),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(yt,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:[g.getFullYear(),"年"]}),e.jsx("button",{onClick:()=>s(N=>new Date(N.getFullYear()+1,0,1)),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(Re,{className:"w-5 h-5 text-gray-600"})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:I,className:"px-3 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:"展开所有"}),e.jsx("button",{onClick:a,className:"px-3 py-1 text-sm bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition-colors",children:"收起所有"})]})]}),e.jsx("div",{className:"space-y-4",children:f.map((N,D)=>{const H=m.includes(D),z=D===L;return e.jsxs("div",{className:`border rounded-lg overflow-hidden ${z?"border-blue-300 bg-blue-50":"border-gray-200"}`,children:[e.jsxs("div",{className:`flex items-center justify-between p-3 cursor-pointer ${z?"bg-blue-100":"bg-gray-50"} hover:bg-opacity-80 transition-colors`,onClick:()=>W(D),children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{className:`w-5 h-5 ${z?"text-blue-600":"text-gray-600"}`}),e.jsx("h2",{className:`text-lg font-semibold ${z?"text-blue-900":"text-gray-900"}`,children:N.monthName}),e.jsxs("span",{className:`text-sm px-2 py-1 rounded ${z?"bg-blue-200 text-blue-800":"bg-gray-200 text-gray-700"}`,children:[N.weeks.length,"周"]})]}),e.jsx("div",{className:`transform transition-transform ${H?"rotate-90":""}`,children:e.jsx(Re,{className:"w-5 h-5 text-gray-600"})})]}),H&&e.jsx("div",{className:"p-4 bg-white",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 2xl:grid-cols-6 gap-4",children:N.weeks.map((V,re)=>{const A=J(V,"yyyy-MM-dd"),Y=S(V),B=vt(V),ae=jt(V,new Date,{weekStartsOn:1});return e.jsxs("div",{className:`border rounded-lg p-3 ${ae?"border-blue-300 bg-blue-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["第",B,"周"]}),e.jsx("span",{className:"text-xs text-gray-500",children:J(V,"MM/dd")})]}),e.jsx("div",{className:"space-y-1",children:Y.map((ne,l)=>e.jsxs("div",{className:"flex items-start space-x-1",children:[e.jsxs("div",{className:`text-xs font-bold ${l===0?"text-yellow-600":l===1?"text-gray-500":"text-orange-600"}`,children:["TOP",l+1]}),e.jsx("div",{className:"flex-1 text-xs text-gray-700 truncate",children:ne.text||e.jsx("span",{className:"text-gray-400 italic",children:"未填写"})})]},ne.id))})]},A)})})})]},D)})})]})]})},ys=({currentView:o,onViewChange:i})=>{const[g,s]=c.useState("overview"),u=j=>{console.log("数据已导入:",j)},m=[{id:"overview",name:"总览",icon:Ee},{id:"goals",name:"目标管理",icon:Pe},{id:"schedule",name:"日程设置",icon:pe},{id:"profile",name:"个人资料",icon:Nt},{id:"notifications",name:"通知设置",icon:kt},{id:"settings",name:"系统设置",icon:St}],h=()=>{var j;switch(g){case"overview":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-blue-50 p-6 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-600 text-sm font-medium",children:"本周完成任务"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:"12/18"})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(pe,{className:"w-6 h-6 text-white"})})]})}),e.jsx("div",{className:"bg-green-50 p-6 rounded-lg border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-600 text-sm font-medium",children:"年度目标进度"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:"3/5"})]}),e.jsx("div",{className:"w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center",children:e.jsx(Pe,{className:"w-6 h-6 text-white"})})]})}),e.jsx("div",{className:"bg-purple-50 p-6 rounded-lg border border-purple-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-600 text-sm font-medium",children:"系统使用天数"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:"45天"})]}),e.jsx("div",{className:"w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center",children:e.jsx(Ee,{className:"w-6 h-6 text-white"})})]})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"最近活动"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-700",children:'完成了"团队会议"任务'}),e.jsx("span",{className:"text-xs text-gray-500 ml-auto",children:"2小时前"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-700",children:"更新了年度健康目标"}),e.jsx("span",{className:"text-xs text-gray-500 ml-auto",children:"1天前"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-700",children:"创建了新的周计划"}),e.jsx("span",{className:"text-xs text-gray-500 ml-auto",children:"3天前"})]})]})]})]});case"goals":return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"目标类别管理"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"事业发展权重"}),e.jsx("input",{type:"range",min:"0",max:"100",defaultValue:"30",className:"w-full"}),e.jsx("span",{className:"text-sm text-gray-500",children:"30%"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"健康管理权重"}),e.jsx("input",{type:"range",min:"0",max:"100",defaultValue:"25",className:"w-full"}),e.jsx("span",{className:"text-sm text-gray-500",children:"25%"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"人际关系权重"}),e.jsx("input",{type:"range",min:"0",max:"100",defaultValue:"20",className:"w-full"}),e.jsx("span",{className:"text-sm text-gray-500",children:"20%"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"学习成长权重"}),e.jsx("input",{type:"range",min:"0",max:"100",defaultValue:"25",className:"w-full"}),e.jsx("span",{className:"text-sm text-gray-500",children:"25%"})]})]})]})});case"schedule":return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"时间段设置"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-yellow-50 rounded-lg border border-yellow-200",children:[e.jsx("span",{className:"font-medium",children:"早上时段"}),e.jsx("input",{type:"text",defaultValue:"06:00-12:00",className:"px-3 py-1 border border-gray-300 rounded text-sm"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-orange-50 rounded-lg border border-orange-200",children:[e.jsx("span",{className:"font-medium",children:"中午时段"}),e.jsx("input",{type:"text",defaultValue:"12:00-14:00",className:"px-3 py-1 border border-gray-300 rounded text-sm"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("span",{className:"font-medium",children:"下午时段"}),e.jsx("input",{type:"text",defaultValue:"14:00-18:00",className:"px-3 py-1 border border-gray-300 rounded text-sm"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsx("span",{className:"font-medium",children:"晚上时段"}),e.jsx("input",{type:"text",defaultValue:"18:00-24:00",className:"px-3 py-1 border border-gray-300 rounded text-sm"})]})]})]})});default:return e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:(j=m.find(b=>b.id===g))==null?void 0:j.name}),e.jsx("p",{className:"text-gray-600",children:"此功能正在开发中..."})]})}};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"人生系统设计"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"系统管理与配置中心"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Te,{currentView:o,onViewChange:i}),e.jsx(Ce,{onImport:u})]})]}),e.jsx("div",{className:"flex space-x-1 bg-gray-100 rounded-lg p-1",children:m.map(j=>{const b=j.icon;return e.jsxs("button",{onClick:()=>s(j.id),className:`flex items-center space-x-2 px-3 py-2 text-sm font-medium rounded-md transition-colors ${g===j.id?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(b,{className:"w-4 h-4"}),e.jsx("span",{children:j.name})]},j.id)})}),e.jsx("div",{className:"min-h-96",children:h()})]})},vs=({onClose:o,onAddTask:i,selectedDate:g})=>{const[s,u]=c.useState({title:"",description:"",date:g?J(g,"yyyy-MM-dd"):J(new Date,"yyyy-MM-dd"),time:"",priority:"medium",category:"work"}),[m,h]=c.useState({}),j=p=>{p.preventDefault();const n={};if(s.title.trim()||(n.title="请输入任务标题"),s.date||(n.date="请选择日期"),Object.keys(n).length>0){h(n);return}const $={...s,date:new Date(s.date),title:s.title.trim(),description:s.description.trim()};i($),o()},b=(p,n)=>{u($=>({...$,[p]:n})),m[p]&&h($=>({...$,[p]:""}))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"添加新任务"}),e.jsx("button",{onClick:o,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(he,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"任务标题 *"}),e.jsx("input",{type:"text",value:s.title,onChange:p=>b("title",p.target.value),className:`input ${m.title?"border-red-500 focus:ring-red-500":""}`,placeholder:"输入任务标题..."}),m.title&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"任务描述"}),e.jsx("textarea",{value:s.description,onChange:p=>b("description",p.target.value),rows:3,className:"input resize-none",placeholder:"输入任务描述..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(pe,{className:"w-4 h-4 inline mr-1"}),"日期 *"]}),e.jsx("input",{type:"date",value:s.date,onChange:p=>b("date",p.target.value),className:`input ${m.date?"border-red-500 focus:ring-red-500":""}`}),m.date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.date})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Tt,{className:"w-4 h-4 inline mr-1"}),"时间"]}),e.jsx("input",{type:"time",value:s.time,onChange:p=>b("time",p.target.value),className:"input"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Ct,{className:"w-4 h-4 inline mr-1"}),"优先级"]}),e.jsxs("select",{value:s.priority,onChange:p=>b("priority",p.target.value),className:"input",children:[e.jsx("option",{value:"low",children:"低优先级"}),e.jsx("option",{value:"medium",children:"中优先级"}),e.jsx("option",{value:"high",children:"高优先级"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(It,{className:"w-4 h-4 inline mr-1"}),"分类"]}),e.jsxs("select",{value:s.category,onChange:p=>b("category",p.target.value),className:"input",children:[e.jsx("option",{value:"work",children:"工作"}),e.jsx("option",{value:"personal",children:"个人"}),e.jsx("option",{value:"health",children:"健康"}),e.jsx("option",{value:"study",children:"学习"})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:o,className:"btn-secondary",children:"取消"}),e.jsx("button",{type:"submit",className:"btn-primary",children:"添加任务"})]})]})]})})};function js(){const[o,i]=c.useState([]),[g,s]=c.useState(!1),[u,m]=c.useState(new Date),[h,j]=c.useState("week");c.useEffect(()=>{i([])},[]);const b=$=>{const F={...$,id:Date.now(),completed:!1};i(y=>[...y,F])},p=($,F)=>{i(y=>y.map(S=>S.id===$?{...S,...F}:S))},n=()=>{switch(h){case"test":return e.jsx(Pt,{});case"week":return e.jsx(Ae,{tasks:o,onAddTask:b,onUpdateTask:p,currentView:h,onViewChange:j});case"year":return e.jsx(bs,{currentView:h,onViewChange:j});case"management":return e.jsx(ys,{currentView:h,onViewChange:j});default:return e.jsx(Ae,{tasks:o,onAddTask:b,onUpdateTask:p,currentView:h,onViewChange:j})}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("main",{className:"p-3",children:e.jsx("div",{className:"w-full max-w-full mx-auto px-4",children:n()})}),g&&e.jsx(vs,{onClose:()=>s(!1),onAddTask:b,selectedDate:u})]})}Se.createRoot(document.getElementById("root")).render(e.jsx(nt.StrictMode,{children:e.jsx(js,{})}));
